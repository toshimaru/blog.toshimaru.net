<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.1">Jekyll</generator><link href="https://blog.toshimaru.net/feed/by_tag/video.xml" rel="self" type="application/atom+xml" /><link href="https://blog.toshimaru.net/" rel="alternate" type="text/html" /><updated>2022-10-31T09:41:08+09:00</updated><id>https://blog.toshimaru.net/feed/by_tag/video.xml</id><title type="html">Hack Your Design!</title><subtitle>toshimaruの技術系なブログ</subtitle><author><name>Toshimaru</name></author><entry><title type="html">video.js で m3u8 形式の動画ファイルをブラウザで再生する</title><link href="https://blog.toshimaru.net/play-m3u8-video-in-browser/" rel="alternate" type="text/html" title="video.js で m3u8 形式の動画ファイルをブラウザで再生する" /><published>2015-05-03T00:00:00+09:00</published><updated>2015-05-03T00:00:00+09:00</updated><id>https://blog.toshimaru.net/play-m3u8-video-in-browser</id><content type="html" xml:base="https://blog.toshimaru.net/play-m3u8-video-in-browser/"><![CDATA[<p><a href="https://github.com/videojs/video.js">video.js</a>を使ってm3u8形式の動画ファイルをSafari以外のブラウザでも再生する方法を紹介します。デモページは下のボタンから。</p>

<p><a href="http://toshimaru.net/demo/videojs-m3u8/" class="btn btn-primary">Demo</a></p>

<h2 id="動作環境">動作環境</h2>

<p>下記環境で（現時点の最新版での）動作を確認しています。</p>

<ul>
  <li>Chrome</li>
  <li>Safari</li>
  <li>Opera</li>
  <li>Safari</li>
</ul>

<p><strong>※要Flash</strong></p>

<h2 id="使うjsライブラリ">使うJSライブラリ</h2>
<ol>
  <li><a href="https://github.com/videojs/video.js">videojs/video.js</a>
    <ul>
      <li>基本素材。動画ファイルを様々なブラウザで再生できるようにする。</li>
    </ul>
  </li>
  <li><a href="https://github.com/videojs/videojs-contrib-media-sources">videojs/videojs-contrib-media-sources</a>
    <ul>
      <li>videoタグに動画ソースを流し込めるようにするvideo.jsプラグイン。</li>
      <li>W3Cのドラフト仕様<a href="https://w3c.github.io/media-source/">Media Source Extensions</a>が元のよう。</li>
    </ul>
  </li>
  <li><a href="https://github.com/videojs/videojs-contrib-hls">videojs/videojs-contrib-hls</a>
    <ul>
      <li>HLS(<code class="language-plaintext highlighter-rouge">m3u8</code>)形式の動画ファイルを再生可能にするvideo.jsプラグイン。</li>
      <li>HLSに対応していないブラウザでもFlash技術を通すことで再生可能にしているよう。</li>
    </ul>
  </li>
</ol>

<h2 id="usage">Usage</h2>

<p>全体HTMLファイルはこんな感じ。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Video.js m3u8<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"css/video-js.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"//cdnjs.cloudflare.com/ajax/libs/video.js/4.12.5/video.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/videojs-media-sources.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/videojs.hls.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;h1&gt;</span>Video.js m3u8 demo page<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"test"</span> <span class="na">class=</span><span class="s">"video-js vjs-default-skin"</span> <span class="na">height=</span><span class="s">"300"</span> <span class="na">width=</span><span class="s">"600"</span> <span class="na">controls</span><span class="nt">&gt;</span>
      <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">"//solutions.brightcove.com/jwhisenant/hls/apple/bipbop/bipbopall.m3u8"</span> <span class="na">type=</span><span class="s">"application/x-mpegURL"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/video&gt;</span>

    <span class="nt">&lt;script&gt;</span>
      <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">videojs</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">player</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
    <span class="nt">&lt;/script&gt;</span>

  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<h3 id="cssjs読み込み">CSS/JS読み込み</h3>

<p>video.js, videojs-media-sources.js, videojs.hls.js 以外にもCSSを読み込まないとエラーが出て再生できなかったのでCSSも読み込むこと。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"css/video-js.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"//cdnjs.cloudflare.com/ajax/libs/video.js/4.12.5/video.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/videojs-media-sources.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/videojs.hls.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></figure>

<h3 id="videoタグ">videoタグ</h3>

<p>適当なクラスを持った<code class="language-plaintext highlighter-rouge">&lt;video&gt;</code>をタグに<code class="language-plaintext highlighter-rouge">height</code>, <code class="language-plaintext highlighter-rouge">width</code>を定義してやって、中に<code class="language-plaintext highlighter-rouge">type="application/x-mpegURL"</code>と<code class="language-plaintext highlighter-rouge">src</code>を持った<code class="language-plaintext highlighter-rouge">&lt;source&gt;</code>タグを入れてやる。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"test"</span> <span class="na">class=</span><span class="s">"video-js vjs-default-skin"</span> <span class="na">height=</span><span class="s">"300"</span> <span class="na">width=</span><span class="s">"600"</span> <span class="na">controls</span><span class="nt">&gt;</span>
  <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">"//solutions.brightcove.com/jwhisenant/hls/apple/bipbop/bipbopall.m3u8"</span> <span class="na">type=</span><span class="s">"application/x-mpegURL"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/video&gt;</span></code></pre></figure>

<h3 id="javascript">JavaScript</h3>

<p><code class="language-plaintext highlighter-rouge">videojs()</code>内にvideoタグのIDでplayerを生成してplay。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">videojs</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">player</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span></code></pre></figure>

<h2 id="最後に">最後に</h2>

<p>クロスオリジンな動画リソースを読み込むときは CORS(Cross-Origin Resource Sharing) の設定を適切にしてやる必要があることに注意！</p>

<hr />

<h2 id="追記">追記</h2>

<p>本記事を参考に書かれた下記の記事も参考になるかもしれません。</p>

<p><a href="http://akiyoko.hatenablog.jp/entry/2015/08/11/015852">Video.js を使って HLS形式の動画をストリーミング再生する - akiyoko blog</a></p>]]></content><author><name>Toshimaru</name></author><category term="video" /><category term="javascript" /><summary type="html"><![CDATA[video.jsを使ってm3u8形式の動画ファイルをSafari以外のブラウザでも再生する方法を紹介します。]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/videojs.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/videojs.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>