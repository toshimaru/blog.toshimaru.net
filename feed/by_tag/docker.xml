<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="https://blog.toshimaru.net/feed/by_tag/docker.xml" rel="self" type="application/atom+xml" /><link href="https://blog.toshimaru.net/" rel="alternate" type="text/html" /><updated>2022-07-22T14:29:02+09:00</updated><id>https://blog.toshimaru.net/feed/by_tag/docker.xml</id><title type="html">Hack Your Design!</title><subtitle>toshimaruã®æŠ€è¡“ç³»ãªãƒ–ãƒ­ã‚°</subtitle><author><name>Toshimaru</name></author><entry><title type="html">Dockerãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã®ä¸¦åˆ—å®Ÿè¡Œ</title><link href="https://blog.toshimaru.net/docker-concurrent-build/" rel="alternate" type="text/html" title="Dockerãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã®ä¸¦åˆ—å®Ÿè¡Œ" /><published>2021-03-15T00:00:00+09:00</published><updated>2021-03-28T00:00:00+09:00</updated><id>https://blog.toshimaru.net/docker-concurrent-build</id><content type="html" xml:base="https://blog.toshimaru.net/docker-concurrent-build/"><![CDATA[<p>æœ¬è¨˜äº‹ã§ã¯ã€ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰æ§‹æˆã®<code class="language-plaintext highlighter-rouge">Dockerfile</code>ã®ãƒ“ãƒ«ãƒ‰ã®ä¸¦åˆ—å®Ÿè¡Œã«ã¤ã„ã¦ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h2 id="å‰æ">å‰æ</h2>

<ul>
  <li>Docker Desktop v3.2.1
    <ul>
      <li>Docker v20.10</li>
      <li>Docker Compose v1.28</li>
    </ul>
  </li>
</ul>

<p><img src="/images/posts/docker/desktop1.png" alt="" /></p>

<h2 id="dockerfile">Dockerfile</h2>

<p>ä»Šå›ãƒ†ã‚¹ãƒˆã§ä½¿ã†ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã®ã‚µãƒ³ãƒ—ãƒ«ã¨ãªã‚‹<code class="language-plaintext highlighter-rouge">Dockerfile</code>ã¯ä¸‹è¨˜ã§ã™ã€‚</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="w"> </span><span class="s">alpine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">test1</span>
<span class="k">RUN </span><span class="nb">sleep </span>10.1 <span class="c"># sleep from test1</span>

<span class="k">FROM</span><span class="w"> </span><span class="s">alpine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">test2</span>
<span class="k">RUN </span><span class="nb">sleep </span>10.2 <span class="c"># sleep from test2</span>

<span class="k">FROM</span><span class="w"> </span><span class="s">alpine</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">test3</span>
<span class="k">RUN </span><span class="nb">sleep </span>10.3 <span class="c"># sleep from test3</span>


<span class="k">FROM</span><span class="s"> alpine</span>
<span class="k">RUN </span><span class="nb">echo</span> <span class="s2">"build start"</span>
<span class="k">RUN </span><span class="nb">sleep </span>10.0 <span class="c"># sleep from main</span>

<span class="k">COPY</span><span class="s"> --from=test1 /tmp /tmp</span>
<span class="k">COPY</span><span class="s"> --from=test2 /tmp /tmp</span>
<span class="k">COPY</span><span class="s"> --from=test3 /tmp /tmp</span>

<span class="k">RUN </span><span class="nb">echo</span> <span class="s2">"build finished"</span>
</code></pre></div></div>

<h2 id="ç›´åˆ—å®Ÿè¡Œ-vs-ä¸¦åˆ—å®Ÿè¡Œ">ç›´åˆ—å®Ÿè¡Œ vs ä¸¦åˆ—å®Ÿè¡Œ</h2>

<p>å®Ÿéš›ã«ä¸Šè¿°ã® <code class="language-plaintext highlighter-rouge">Dockerfile</code> ã®ãƒ“ãƒ«ãƒ‰ã‚’ä¸¦åˆ—å®Ÿè¡Œã—ãªã„å ´åˆï¼ˆç›´åˆ—å®Ÿè¡Œï¼‰ã¨ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹å ´åˆã®çµæœã‚’æ¯”è¼ƒã—ã¦ã¿ã¾ã™ã€‚</p>

<h3 id="ä¸¦åˆ—å®Ÿè¡Œã—ãªã„å ´åˆ">ä¸¦åˆ—å®Ÿè¡Œã—ãªã„å ´åˆ</h3>

<p>ä¸¦åˆ—å®Ÿè¡Œã‚’OFFã«ã—ã¦å®Ÿè¡Œã™ã‚‹ã«ã¯ <code class="language-plaintext highlighter-rouge">DOCKER_BUILDKIT=0</code> ã®ç’°å¢ƒå¤‰æ•°ã‚’ã‚»ãƒƒãƒˆã—ã¦ <code class="language-plaintext highlighter-rouge">docker build</code>ã‚’è¡Œã„ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span>0 docker build <span class="nt">--no-cache</span> <span class="nb">.</span>
<span class="go">Sending build context to Docker daemon  331.1MB
Step 1/13 : FROM alpine as test1
</span><span class="gp"> ---&gt;</span><span class="w"> </span>b7b28af77ffe
<span class="gp">Step 2/13 : RUN sleep 10.1 #</span><span class="w"> </span><span class="nb">sleep </span>from test1
<span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>11b4518313de
<span class="go">Step 3/13 : FROM alpine as test2
</span><span class="gp"> ---&gt;</span><span class="w"> </span>b7b28af77ffe
<span class="gp">Step 4/13 : RUN sleep 10.2 #</span><span class="w"> </span><span class="nb">sleep </span>from test2
<span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>c61101646517
<span class="go">Step 5/13 : FROM alpine as test3
</span><span class="gp"> ---&gt;</span><span class="w"> </span>b7b28af77ffe
<span class="gp">Step 6/13 : RUN sleep 10.3 #</span><span class="w"> </span><span class="nb">sleep </span>from test3
<span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>1aa97a170923
<span class="go">Step 7/13 : FROM alpine
</span><span class="gp"> ---&gt;</span><span class="w"> </span>b7b28af77ffe
<span class="go">Step 8/13 : RUN echo "build start"
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>8b2b09749321
<span class="gp">Step 9/13 : RUN sleep 10.0 #</span><span class="w"> </span><span class="nb">sleep </span>from main
<span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>bc3f772d3fb1
<span class="go">Step 10/13 : COPY --from=test1 /tmp /tmp
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>0f861020f1c0
<span class="go">Step 11/13 : COPY --from=test2 /tmp /tmp
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>eea3d212c0b7
<span class="go">Step 12/13 : COPY --from=test3 /tmp /tmp
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>9beba31a0ff6
<span class="go">Step 13/13 : RUN echo "build finished"
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>0986bef3d18f
<span class="go">Successfully built 0986bef3d18f
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">sleep 10</code> Ã— 4 ãŒç›´åˆ—ã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ãƒ“ãƒ«ãƒ‰ã« <strong>æœ€ä½ã§ã‚‚40ç§’</strong> ã‹ã‹ã£ã¦ã„ã¾ã—ãŸã€‚</p>

<h3 id="ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹å ´åˆ">ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹å ´åˆ</h3>

<p>ã§ã¯æ¬¡ã«ä¸¦åˆ—å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>

<p>ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹ã«ã¯ <code class="language-plaintext highlighter-rouge">DOCKER_BUILDKIT=1</code> ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã‹ã€ç§ã®ç’°å¢ƒã®å ´åˆ <code class="language-plaintext highlighter-rouge">DOCKER_BUILDKIT</code> ã®ç’°å¢ƒå¤‰æ•°ã®ã‚»ãƒƒãƒˆã—ãªãã¦ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¸¦åˆ—å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚</p>

<p class="info"><strong>Docker Desktop v3.2</strong> ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ <code class="language-plaintext highlighter-rouge">DOCKER_BUILDKIT=1</code> ã®ç’°å¢ƒå¤‰æ•°ãŒä¸è¦ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä¸¦åˆ—å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€ä¸€æ–¹ã€<strong>Docker Desktop v3.1</strong>ã®å ´åˆã¯ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã¯<code class="language-plaintext highlighter-rouge">DOCKER_BUILDKIT=1</code> ã®ç’°å¢ƒå¤‰æ•°ã®æŒ‡å®šãŒå¿…è¦ã§ã—ãŸã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker build <span class="nt">--no-cache</span> <span class="nb">.</span>
<span class="go">[+] Building 13.9s (14/14) FINISHED
</span><span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>internal] load build definition from Dockerfile                                            0.1s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> transferring dockerfile: 37B                                                             0.0s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>internal] load .dockerignore                                                               0.1s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> transferring context: 2B                                                                 0.0s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>internal] load metadata <span class="k">for </span>docker.io/library/alpine:latest                                0.0s
<span class="gp"> =&gt;</span><span class="w"> </span>CACHED <span class="o">[</span>test3 1/2] FROM docker.io/library/alpine                                            0.0s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>test2 2/2] RUN <span class="nb">sleep </span>10.2 <span class="c"># sleep from test2                                              12.4s</span>
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>stage-3 2/7] RUN <span class="nb">echo</span> <span class="s2">"build start"</span>                                                        2.3s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>test3 2/2] RUN <span class="nb">sleep </span>10.3 <span class="c"># sleep from test3                                              12.5s</span>
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>test1 2/2] RUN <span class="nb">sleep </span>10.1 <span class="c"># sleep from test1                                              12.3s</span>
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>stage-3 3/7] RUN <span class="nb">sleep </span>10.0 <span class="c"># sleep from main                                             10.6s</span>
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>stage-3 4/7] COPY <span class="nt">--from</span><span class="o">=</span>test1 /tmp /tmp                                                   0.1s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>stage-3 5/7] COPY <span class="nt">--from</span><span class="o">=</span>test2 /tmp /tmp                                                   0.1s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>stage-3 6/7] COPY <span class="nt">--from</span><span class="o">=</span>test3 /tmp /tmp                                                   0.1s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">[</span>stage-3 7/7] RUN <span class="nb">echo</span> <span class="s2">"build finished"</span>                                                     0.4s
<span class="gp"> =&gt;</span><span class="w"> </span>exporting to image                                                                          0.2s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> exporting layers                                                                         0.2s
<span class="gp"> =&gt;</span><span class="w"> </span><span class="o">=&gt;</span> writing image sha256:2dfb39f0fbed99a19fee51b23db685a0878eed7291bce08e88c3226e8fea271d    0.0s
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">sleep 10</code> Ã— 4 ãŒä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€å…¨ä½“ã¨ã—ã¦10ç§’ç¨‹åº¦ã§ãƒ“ãƒ«ãƒ‰ãŒçµ‚äº†ã—ã¦ã„ã¾ã™ã€‚</p>

<h2 id="æ¯”è¼ƒçµæœ">æ¯”è¼ƒçµæœ</h2>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th>ãƒ“ãƒ«ãƒ‰æ™‚é–“</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ä¸¦åˆ—å®Ÿè¡Œã—ãªã„å ´åˆ</td>
      <td><strong>50ç§’</strong></td>
    </tr>
    <tr>
      <td>ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹å ´åˆ</td>
      <td><strong>15ç§’</strong></td>
    </tr>
  </tbody>
</table>

<p>ä»Šå›ã‚µãƒ³ãƒ—ãƒ«ã¨ãªã£ãŸ <code class="language-plaintext highlighter-rouge">Dockerfile</code> ã®å ´åˆã€<strong>3å€ã®é«˜é€ŸåŒ–</strong> ã«æˆåŠŸã—ã¾ã—ãŸã€‚</p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<ul>
  <li><a href="https://kotaroooo0-dev.hatenablog.com/entry/2020/06/10/225333">Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ã‚’BuildKitã§ä¸¦åˆ—å®Ÿè¡Œã—é«˜é€ŸåŒ–ã™ã‚‹ - ğŸ¤–</a></li>
  <li><a href="https://matsuand.github.io/docs.docker.jp.onthefly/develop/develop-images/multistage-build/">ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã®åˆ©ç”¨ | Docker ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="docker" /><summary type="html"><![CDATA[æœ¬è¨˜äº‹ã§ã¯ã€ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰æ§‹æˆã®Dockerfileã®ãƒ“ãƒ«ãƒ‰ã®ä¸¦åˆ—å®Ÿè¡Œã«ã¤ã„ã¦ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/docker/desktop1.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/docker/desktop1.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">docker-compose ã§ Rails6 + MySQL ãªç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹</title><link href="https://blog.toshimaru.net/rails-on-docker-compose/" rel="alternate" type="text/html" title="docker-compose ã§ Rails6 + MySQL ãªç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹" /><published>2019-12-31T00:00:00+09:00</published><updated>2020-01-02T00:00:00+09:00</updated><id>https://blog.toshimaru.net/rails-on-docker-compose</id><content type="html" xml:base="https://blog.toshimaru.net/rails-on-docker-compose/"><![CDATA[<p>docker-compose ã‚’ä½¿ã£ã¦ Ruby 2.7 + Rails 6.0 + MySQL 8.0 ã®ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h2 id="ã‚´ãƒ¼ãƒ«">ã‚´ãƒ¼ãƒ«</h2>

<p>ã‚´ãƒ¼ãƒ«ã¯Railsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ›ãƒ¼ãƒ ç”»é¢ã‚’è¡¨ç¤ºã•ã›ã‚‹ã¨ã“ã‚ã¾ã§ã§ã™ã€‚</p>

<h2 id="æ‰‹é †">æ‰‹é †</h2>

<p>ä¸‹è¨˜ã®æ‰‹é †ã‚’ãƒ™ãƒ¼ã‚¹ã«é€²ã‚ã¦ã„ãã¾ã™â€¥</p>

<p><a href="https://docs.docker.com/compose/rails/">Quickstart: Compose and Rails | Docker Documentation</a></p>

<h3 id="dockerfile">Dockerfile</h3>

<p>é©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”¨æ„ã—ã¦ã€<code class="language-plaintext highlighter-rouge">Dockerfile</code>ã‚’ä¸‹è¨˜ã®é€šã‚Šç”¨æ„ã—ã¾ã™ã€‚</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> ruby:2.7</span>
<span class="k">RUN </span>apt-get update <span class="nt">-qq</span> <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> nodejs yarnpkg
<span class="k">RUN </span><span class="nb">ln</span> <span class="nt">-s</span> /usr/bin/yarnpkg /usr/bin/yarn
<span class="k">RUN </span><span class="nb">mkdir</span> /app
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> Gemfile /app/Gemfile</span>
<span class="k">COPY</span><span class="s"> Gemfile.lock /app/Gemfile.lock</span>
<span class="k">RUN </span>bundle <span class="nb">install</span>
<span class="k">COPY</span><span class="s"> . /app</span>

<span class="c"># Add a script to be executed every time the container starts.</span>
<span class="k">COPY</span><span class="s"> entrypoint.sh /usr/bin/</span>
<span class="k">RUN </span><span class="nb">chmod</span> +x /usr/bin/entrypoint.sh
<span class="k">ENTRYPOINT</span><span class="s"> ["entrypoint.sh"]</span>
<span class="k">EXPOSE</span><span class="s"> 3000</span>

<span class="c"># Start the main process.</span>
<span class="k">CMD</span><span class="s"> ["rails", "server", "-b", "0.0.0.0"]</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">yarnpkg</code>ã§yarnã‚’å…¥ã‚Œã‚‹ã¨ã€yarn ã¨ã„ã†å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãªã <code class="language-plaintext highlighter-rouge">yarnpkg</code> ã¨ã„ã†å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½œæˆã—ã¦ã„ã‚‹ç‚¹ã«ç•™æ„ã€‚</li>
</ul>

<h3 id="åˆæœŸgemfile">åˆæœŸGemfile</h3>

<p>ä¸‹è¨˜ã®é€šã‚Š<code class="language-plaintext highlighter-rouge">Gemfile</code>ã¨<code class="language-plaintext highlighter-rouge">Gemfile.lock</code>ã‚’ç”¨æ„ã—ã¾ã™ã€‚</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>
<span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span> <span class="s1">'~&gt;6'</span>
</code></pre></div></div>

<ul>
  <li>ä»Šå›ã¯ Rails v6 ï¼ˆç¾æ™‚ç‚¹ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ã‚’ä½¿ã„ã¾ã™</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">touch </span>Gemfile.lock
</code></pre></div></div>

<ul>
  <li>ç¾æ®µéšã§ã¯ <code class="language-plaintext highlighter-rouge">Gemfile.lock</code> ã¯ç©ºã§OK</li>
</ul>

<h3 id="entrypointsh">entrypoint.sh</h3>

<p><code class="language-plaintext highlighter-rouge">Dockerfile</code>ã§<code class="language-plaintext highlighter-rouge">ENTRYPOINT</code>ã¨ã—ã¦å®šç¾©ã—ã¦ã„ã‚‹ <code class="language-plaintext highlighter-rouge">entrypoint.sh</code> ã§ã™ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-e</span>

<span class="c"># Remove a potentially pre-existing server.pid for Rails.</span>
<span class="nb">rm</span> <span class="nt">-f</span> /app/tmp/pids/server.pid

<span class="c"># Then exec the container's main process (what's set as CMD in the Dockerfile).</span>
<span class="nb">exec</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="docker-composeyml">docker-compose.yml</h3>

<p><code class="language-plaintext highlighter-rouge">docker-compose.yml</code>ã‚’ä¸‹è¨˜ã®é€šã‚Šç”¨æ„ã—ã¾ã™ã€‚</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3'</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:8.0</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./tmp/db:/var/lib/mysql</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">MYSQL_ALLOW_EMPTY_PASSWORD=1</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">bash -c "rm -f tmp/pids/server.pid &amp;&amp; bundle exec rails s -p 3000 -b '0.0.0.0'"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.:/app</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db</span>
</code></pre></div></div>

<ul>
  <li>MySQL ã¯ 8.0 ï¼ˆç¾æ™‚ç‚¹ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰ã‚’ä½¿ç”¨</li>
  <li><code class="language-plaintext highlighter-rouge">MYSQL_ALLOW_EMPTY_PASSWORD</code> ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ <code class="language-plaintext highlighter-rouge">password</code> ãŒç©ºã§ã‚‚rootã§æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠã</li>
</ul>

<h3 id="rails-new">rails new</h3>

<p><code class="language-plaintext highlighter-rouge">rails new</code> ã®ã‚³ãƒãƒ³ãƒ‰ã‚’webã‚³ãƒ³ãƒ†ãƒŠä¸Šã§å®Ÿè¡Œã—ã¦Railsã®ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-compose run web bundle <span class="nb">exec </span>rails new <span class="nb">.</span> <span class="nt">--force</span> <span class="nt">--database</span><span class="o">=</span>mysql
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--force</code> ã§æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ã</li>
  <li>DBã¯mysqlã‚’æŒ‡å®š</li>
</ul>

<p>Railsã®ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ãŒ <code class="language-plaintext highlighter-rouge">rails new</code> ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã£ã¦å‡ºæ¥ä¸ŠãŒã£ãŸã®ã§ build ã—ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-compose build
</code></pre></div></div>

<h3 id="dbãƒ›ã‚¹ãƒˆåå¤‰æ›´">DBãƒ›ã‚¹ãƒˆåå¤‰æ›´</h3>

<p>ã“ã®ã¾ã¾ã§ã¯DBã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã° host åã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚</p>

<p>ä¸‹è¨˜ã®é€šã‚Š <code class="language-plaintext highlighter-rouge">config/database.yml</code> ã®hostã®éƒ¨åˆ†ã‚’ <code class="language-plaintext highlighter-rouge">db</code> ã«ç½®ãæ›ãˆã¾ã—ã‚‡ã†ã€‚</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">default</span><span class="pi">:</span> <span class="nl">&amp;default</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="na">encoding</span><span class="pi">:</span> <span class="s">utf8mb4</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="s">&lt;%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %&gt;</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>
  <span class="na">password</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">db</span>
<span class="na">development</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">app_development</span>
<span class="na">test</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">app_test</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">host</code> ã« <code class="language-plaintext highlighter-rouge">db</code> ã‚’è¨­å®š
    <ul>
      <li><code class="language-plaintext highlighter-rouge">db</code> ã¯ã‚³ãƒ³ãƒ†ãƒŠåã«ãªã‚Šã¾ã™</li>
    </ul>
  </li>
</ul>

<p>buildå¾Œã« docker-compose up ã—ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-compose up
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">localhost:3000</code> ã§RailsãŒç«‹ã¡ä¸ŠãŒã‚‹ã®ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>

<h2 id="error-caching_sha2_password-could-not-be-loaded">Error: caching_sha2_password could not be loaded</h2>

<p>ã—ã‹ã—ã“ã“ã§Railsã«æ¥ç¶šã™ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ActiveRecord::NoDatabaseError

Plugin caching_sha2_password could not be loaded: /usr//usr/lib/x86_64-linux-gnu/mariadb19/plugin/caching_sha2_password.so: cannot open shared object file: No such file or directory
</code></pre></div></div>

<p>ã“ã‚Œã¯webã‚³ãƒ³ãƒ†ãƒŠãŒ mysql 8.0 ã®<code class="language-plaintext highlighter-rouge">caching_sha2_password</code>èªè¨¼æ–¹å¼ã«å¯¾å¿œã—ã¦ã„ãªã„ãŸã‚ã§ã™ã€‚</p>

<p>ä¸‹è¨˜ã®æ‰‹é †ã§ <code class="language-plaintext highlighter-rouge">caching_sha2_password</code> ã‚’ <code class="language-plaintext highlighter-rouge">mysql_native_password</code>ï¼ˆæ—§æ¥ã®èªè¨¼æ–¹å¼ï¼‰ã«å¤‰æ›´ã—ã¾ã—ã‚‡ã†ã€‚</p>

<h3 id="dbã‚³ãƒ³ãƒ†ãƒŠã§mysqlã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèµ·å‹•">DBã‚³ãƒ³ãƒ†ãƒŠã§mysqlã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèµ·å‹•</h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-compose <span class="nb">exec </span>db bash
</code></pre></div></div>

<p>dbã‚³ãƒ³ãƒ†ãƒŠã®bashã‚’èµ·å‹•å¾Œã«mysqlã‚³ãƒãƒ³ãƒ‰ã§æ¥ç¶šã—ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>mysql <span class="nt">-u</span> root
<span class="gp">Welcome to the MySQL monitor.  Commands end with ;</span><span class="w"> </span>or <span class="se">\g</span><span class="nb">.</span>
<span class="go">Your MySQL connection id is 9
Server version: 8.0.18 MySQL Community Server - GPL

</span><span class="c">...
</span></code></pre></div></div>

<h3 id="èªè¨¼æ–¹å¼å¤‰æ›´sql">èªè¨¼æ–¹å¼å¤‰æ›´SQL</h3>

<p>ä¸‹è¨˜ã®ã‚¯ã‚¨ãƒªã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã¨ãã®èªè¨¼æ–¹å¼ãŒé–²è¦§ã§ãã¾ã™ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; select User,Host,plugin from mysql.user;
+------------------+-----------+-----------------------+
| User             | Host      | plugin                |
+------------------+-----------+-----------------------+
| root             | %         | caching_sha2_password |
| mysql.infoschema | localhost | caching_sha2_password |
| mysql.session    | localhost | caching_sha2_password |
| mysql.sys        | localhost | caching_sha2_password |
| root             | localhost | caching_sha2_password |
+------------------+-----------+-----------------------+
5 rows in set (0.00 sec)
</code></pre></div></div>

<p>å…¨ã¦ <code class="language-plaintext highlighter-rouge">caching_sha2_password</code> ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’<code class="language-plaintext highlighter-rouge">mysql_native_password</code>ã«å¤‰æ›´ã—ã¾ã™ã€‚</p>

<p>ä»Šå›å¯¾è±¡ã¨ãªã‚‹ <code class="language-plaintext highlighter-rouge">root@%</code> ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚’ <code class="language-plaintext highlighter-rouge">ALTER USER</code> ã‚’ä½¿ã£ã¦å¤‰æ›´ã—ã¾ã—ã‚‡ã†ã€‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">USER</span> <span class="s1">'root'</span><span class="o">@</span><span class="s1">'%'</span> <span class="n">IDENTIFIED</span> <span class="k">WITH</span> <span class="n">mysql_native_password</span> <span class="k">BY</span> <span class="s1">''</span><span class="p">;</span>
<span class="c1">-- Query OK, 0 rows affected (0.02 sec)</span>
</code></pre></div></div>

<p>å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; select User,Host,plugin from mysql.user;
+------------------+-----------+-----------------------+
| User             | Host      | plugin                |
+------------------+-----------+-----------------------+
| root             | %         | mysql_native_password |
| mysql.infoschema | localhost | caching_sha2_password |
| mysql.session    | localhost | caching_sha2_password |
| mysql.sys        | localhost | caching_sha2_password |
| root             | localhost | caching_sha2_password |
+------------------+-----------+-----------------------+
5 rows in set (0.00 sec)
</code></pre></div></div>

<h2 id="yay-youre-on-rails">â€œYay! Youâ€™re on Rails!â€</h2>

<p>DBãŒä½œæˆã•ã‚Œã¦ã„ãªã„ã‚ˆã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã®ã§ <code class="language-plaintext highlighter-rouge">db:prepare</code> ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-compose <span class="nb">exec </span>web bundle <span class="nb">exec </span>rails db:prepare
</code></pre></div></div>

<p>ã“ã‚Œã§Railsã®ãƒ›ãƒ¼ãƒ ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>

<p><img src="/images/posts/docker/railshome.png" alt="rails home" /></p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<ul>
  <li>éå»ã«åŒã˜ã“ã¨ã‚’ã‚„ã£ãŸã¨ãã®ã‚¨ãƒ³ãƒˆãƒª: <a href="docker-compose-rails/">docker-compose ã§ Rails ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="docker" /><category term="mysql" /><category term="rails" /><summary type="html"><![CDATA[docker-compose ã‚’ä½¿ã£ã¦ Ruby 2.7 + Rails 6.0 + MySQL 8.0 ã®ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã‚´ãƒ¼ãƒ«ã¯Railsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ›ãƒ¼ãƒ ç”»é¢ã‚’è¡¨ç¤ºã•ã›ã‚‹ã¨ã“ã‚ã¾ã§ã§ã™ã€‚]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/docker/yaml.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/docker/yaml.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Rails on Docker ç’°å¢ƒã§ã® SystemSpec ç’°å¢ƒæ§‹ç¯‰</title><link href="https://blog.toshimaru.net/rails-on-docker-system-spec/" rel="alternate" type="text/html" title="Rails on Docker ç’°å¢ƒã§ã® SystemSpec ç’°å¢ƒæ§‹ç¯‰" /><published>2019-09-18T00:00:00+09:00</published><updated>2019-09-18T00:00:00+09:00</updated><id>https://blog.toshimaru.net/rails-on-docker-system-spec</id><content type="html" xml:base="https://blog.toshimaru.net/rails-on-docker-system-spec/"><![CDATA[<p>Rails on Docker ãªç’°å¢ƒä¸Šã« SystemSpec(System Test + RSpec) ã‚’å°å…¥ã—ã¾ã—ãŸã€‚</p>

<h2 id="ç’°å¢ƒ">ç’°å¢ƒ</h2>

<p>ä»Šå›SystemSpecã‚’å°å…¥ã—ãŸã®ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªç’°å¢ƒã§ã™ã€‚</p>

<ul>
  <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: <a href="https://github.com/toshimaru/RailsTwitterClone/">RailsTwitterClone</a></li>
  <li>docker-compose</li>
  <li>Ruby 2.6</li>
  <li>chromium-driver</li>
  <li>gem
    <ul>
      <li>rails (5.2)</li>
      <li>rspec-rails</li>
      <li>selenium-webdriver</li>
      <li>capybara</li>
    </ul>
  </li>
</ul>

<h2 id="å¯¾å¿œpull-request">å¯¾å¿œPull Request</h2>

<p><a href="https://github.com/toshimaru/RailsTwitterClone/pull/506/files">Re-try System Spec by toshimaru Â· Pull Request #506 Â· toshimaru/RailsTwitterClone</a></p>

<h2 id="ç§ã®systemspecé…ã™ã">ç§ã®SystemSpecã€é…ã™ãâ€¦ï¼Ÿ</h2>

<p>å®Ÿã¯ SystemSpec ã‚’å°å…¥ã—ã‚ˆã†ã¨è©¦ã¿ãŸã®ã¯ä»Šå›ã§äºŒå›ç›®ã§ã™ã€‚ä¸€å›ç›®ã¯ SystemTest ãŒ Rails ã®æ©Ÿèƒ½ã®ä¸€ã¤ã¨ã—ã¦ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦é–“ã‚‚ãªã„é ƒã«è©¦ã—ãŸã®ã§ã™ãŒã€ãƒ†ã‚¹ãƒˆå…¨ä½“ã«ã‹ã‹ã‚‹æ™‚é–“ãŒåŠ‡çš„ã«é…ããªã£ãŸãŸã‚ã€å°å…¥ã‚’æ–­å¿µã—ãŸã¨ã„ã†çµŒç·¯ãŒã‚ã‚Šã¾ã™ã€‚</p>

<p>å½“æ™‚ã®Pull RequestãŒã“ã¡ã‚‰: <a href="https://github.com/toshimaru/RailsTwitterClone/pull/216">Try System Spec by toshimaru Â· Pull Request #216 Â· toshimaru/RailsTwitterClone</a></p>

<blockquote>
  <p>Before</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Finished in 15.74 seconds (files took 7.65 seconds to load)
152 examples, 0 failures
</code></pre></div>  </div>

  <p>After</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Finished in 58.46 seconds (files took 7.64 seconds to load)
152 examples, 3 failures
</code></pre></div>  </div>
</blockquote>

<p>ã—ã‹ã—ã“ã‚Œã¯çµæœã‹ã‚‰ã„ã†ã¨è¨­å®šãŒæ‚ªã‹ã£ãŸã®ã§ã—ãŸã€‚ä¸‹è¨˜ã®ã‚ˆã†ã« system ãƒ†ã‚¹ãƒˆã‚’ Headless Chrome ã§èµ°ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã—ãŸãŒã€ã“ã‚Œã ã¨ã™ã¹ã¦ã® System ãƒ†ã‚¹ãƒˆãŒ Headless Chrome ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã—ã¦ã—ã¾ã„ã€çµæœçš„ã«é…ããªã‚Šã¾ã™ã€‚</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="o">...</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">,</span> <span class="ss">type: :system</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">driven_by</span> <span class="ss">:selenium_chrome_headless</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>ä¸‹è¨˜ã®ã‚ˆã†ã«JSã‚’èµ·å‹•ã•ã›ã‚‹å¿…è¦ã®ãªã„ System ãƒ†ã‚¹ãƒˆã¯å¾“æ¥é€šã‚Šã®<code class="language-plaintext highlighter-rouge">rack_test</code>ã€<code class="language-plaintext highlighter-rouge">js: true</code>ãªãƒ†ã‚¹ãƒˆã¯<code class="language-plaintext highlighter-rouge">selenium_chrome_headless</code>ã«è¨­å®šã—ã¦ã‚„ã‚Œã°ãƒ†ã‚¹ãƒˆå…¨ä½“ãŒé«˜é€Ÿã«å®Ÿè¡Œå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="o">...</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">,</span> <span class="ss">type: :system</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">driven_by</span> <span class="ss">:rack_test</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">,</span> <span class="ss">type: :system</span><span class="p">,</span> <span class="ss">js: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">driven_by</span> <span class="ss">:selenium_chrome_headless</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="dockerfile">Dockerfile</h2>

<p>ä»Šå›åˆ©ç”¨ã—ãŸ <code class="language-plaintext highlighter-rouge">Dockerfile</code> ã¯ Ruby 2.6 ã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã« <code class="language-plaintext highlighter-rouge">chromium-driver</code> ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚³ãƒ³ãƒ†ãƒŠã¨ãªã‚Šã¾ã™ã€‚</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> ruby:2.6</span>

<span class="k">RUN </span>apt-get update <span class="nt">-qq</span> <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> nodejs chromium-driver 
</code></pre></div></div>

<h3 id="chrome-failed-to-start-exited-abnormally">Chrome failed to start: exited abnormally</h3>

<p>ã—ã‹ã—ã€ä¸Šè¿°ã®ç’°å¢ƒã«ãŠã„ã¦<code class="language-plaintext highlighter-rouge">rspec</code>ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Failure/Error: Unable to infer file and line number from backtrace

  Selenium::WebDriver::Error::UnknownError:
      unknown error: Chrome failed to start: exited abnormally
      (unknown error: DevToolsActivePort file doesn't exist)
      (The process started from chrome location /usr/bin/chromium is no longer running, so ChromeDriver is assuming that Chrome has crashed.)
</code></pre></div></div>

<p>ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ Chrome ãŒ<code class="language-plaintext highlighter-rouge">sandbox</code>ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã«èµ·å› ã—ã¾ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ãª<code class="language-plaintext highlighter-rouge">no-sandbox</code>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãã® Headless Chrome ã‚’ Capybara ã« driver ã¨ã—ã¦ç™»éŒ²ã—ã¦ã‚„ã‚‹ã“ã¨ã§å›é¿ã—ã¾ã™ã€‚</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Capybara</span><span class="p">.</span><span class="nf">register_driver</span> <span class="ss">:headless_chrome</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>
  <span class="n">browser_options</span> <span class="o">=</span> <span class="o">::</span><span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Chrome</span><span class="o">::</span><span class="no">Options</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">opts</span><span class="o">|</span>
    <span class="n">opts</span><span class="p">.</span><span class="nf">args</span> <span class="o">&lt;&lt;</span> <span class="s2">"--headless"</span>
    <span class="n">opts</span><span class="p">.</span><span class="nf">args</span> <span class="o">&lt;&lt;</span> <span class="s2">"--disable-gpu"</span>
    <span class="n">opts</span><span class="p">.</span><span class="nf">args</span> <span class="o">&lt;&lt;</span> <span class="s2">"--no-sandbox"</span>
  <span class="k">end</span>
  <span class="no">Capybara</span><span class="o">::</span><span class="no">Selenium</span><span class="o">::</span><span class="no">Driver</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="ss">browser: :chrome</span><span class="p">,</span> <span class="ss">options: </span><span class="n">browser_options</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>ã“ã†ã—ã¦ç™»éŒ²ã—ãŸ<code class="language-plaintext highlighter-rouge">headless_chrome</code>ã‚’SystemTestã«å¯¾ã—ã¦é©å¿œã•ã›ã¦ã‚„ã‚Œã°OKã§ã™ã€‚</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="o">...</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">,</span> <span class="ss">type: :system</span><span class="p">,</span> <span class="ss">js: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">driven_by</span> <span class="ss">:headless_chrome</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>ã“ã‚Œã§ãã¡ã‚“ã¨Dockerä¸Šã§SystemSpecãŒé€šã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-compose run web rspec
<span class="go">
Randomized with seed 30150
............................................................................................................Capybara starting Puma...
* Version 4.1.1 , codename: Fourth and One
* Min threads: 0, max threads: 4
* Listening on tcp://127.0.0.1:38789
</span><span class="c">...............................................
</span><span class="go">
Finished in 19.87 seconds (files took 8.8 seconds to load)
155 examples, 0 failures
</span></code></pre></div></div>

<h2 id="å…¬å¼ã§ã¯no-sandboxã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã¯ã—ã¦ãã‚Œãªã„">å…¬å¼ã§ã¯no-sandboxã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã¯ã—ã¦ãã‚Œãªã„ï¼Ÿ</h2>

<p>ä½™è«‡ã§ã™ãŒã€Capybaraæœ¬ä½“ã§ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹<code class="language-plaintext highlighter-rouge">selenium_chrome_headless</code>ã«<code class="language-plaintext highlighter-rouge">no-sandbox</code>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã™ã‚‹å¤‰æ›´ã‚’PRã—ã¦ã¿ã¾ã—ãŸãŒã€ä¸‹è¨˜ã®é€šã‚ŠRejectã•ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚</p>

<p><a href="https://github.com/teamcapybara/capybara/pull/2241">Add <code class="language-plaintext highlighter-rouge">no-sandbox</code> option for selenium_chrome_headless by toshimaru Â· Pull Request #2241 Â· teamcapybara/capybara</a></p>

<h3 id="securityã‚’æ‹…ä¿ã™ã‚‹ãŸã‚ã®sandbox">Securityã‚’æ‹…ä¿ã™ã‚‹ãŸã‚ã®sandbox</h3>

<p>sandboxã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’é«˜ã‚ã‚‹ãŸã‚ã®ç’°å¢ƒãªã®ã§åŸºæœ¬çš„ã«ã¯ <strong>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ no-sandbox ã«ã™ã‚‹ã¹ãã§ã¯ãªã„</strong> ã¨ã„ã†åˆ¤æ–­ã®ã‚ˆã†ã§ã™ã€‚</p>

<blockquote>
  <p>Sandbox leverages the OS-provided security to allow code execution that cannot make persistent changes to the computer or access information that is confidential.</p>
</blockquote>

<p>via. <a href="https://chromium.googlesource.com/chromium/src/+/master/docs/design/sandbox.md">Sandbox</a></p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<ul>
  <li><a href="https://qiita.com/ngron/items/f61b8635b4d67f666d75">Rails + Selenium + Dockerã§SystemSpecã®ç’°å¢ƒæ§‹ç¯‰ - Qiita</a></li>
  <li><a href="https://news.mynavi.jp/article/20081009-a027/">Google Chrome ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã§å®Ÿç¾ã™ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€Windowsã®æ©Ÿèƒ½ã«ä¾å­˜ | ãƒã‚¤ãƒŠãƒ“ãƒ‹ãƒ¥ãƒ¼ã‚¹</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="rspec" /><category term="rails" /><category term="docker" /><summary type="html"><![CDATA[Rails on Docker ãªç’°å¢ƒä¸Šã« SystemSpec(System Test + RSpec) ã‚’å°å…¥ã—ã¾ã—ãŸã€‚ ç’°å¢ƒ ä»Šå›SystemSpecã‚’å°å…¥ã—ãŸã®ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªç’°å¢ƒã§ã™ã€‚ç§ã®SystemSpecã€é…ã™ãâ€¦ï¼Ÿ å®Ÿã¯ SystemSpec ã‚’å°å…¥ã—ã‚ˆã†ã¨è©¦ã¿ãŸã®ã¯ä»Šå›ã§äºŒå›ç›®ã§ã™ã€‚ä¸€å›ç›®ã¯ SystemTest ãŒ Rails ã®æ©Ÿèƒ½ã®ä¸€ã¤ã¨ã—ã¦ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦é–“ã‚‚ãªã„é ƒã«è©¦ã—ãŸã®ã§ã™ãŒã€ãƒ†ã‚¹ãƒˆå…¨ä½“ã«ã‹ã‹ã‚‹æ™‚é–“ãŒåŠ‡çš„ã«é…ããªã£ãŸãŸã‚ã€å°å…¥ã‚’æ–­å¿µã—ãŸã¨ã„ã†çµŒç·¯ãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã“ã‚Œã¯çµæœã‹ã‚‰ã„ã†ã¨è¨­å®šãŒæ‚ªã‹ã£ãŸã®ã§ã—ãŸã€‚]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/systemspec/og.jpg" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/systemspec/og.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">docker-compose ã§ Rails ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹</title><link href="https://blog.toshimaru.net/docker-compose-rails/" rel="alternate" type="text/html" title="docker-compose ã§ Rails ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹" /><published>2016-04-09T00:00:00+09:00</published><updated>2016-04-09T00:00:00+09:00</updated><id>https://blog.toshimaru.net/docker-compose-rails</id><content type="html" xml:base="https://blog.toshimaru.net/docker-compose-rails/"><![CDATA[<p><code class="language-plaintext highlighter-rouge">docker-machine</code>, <code class="language-plaintext highlighter-rouge">docker-compose</code> ã‚’ä½¿ã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã«Rails on docker ãªç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã¿ã¾ã™ã€‚</p>

<h2 id="å‰æ">å‰æ</h2>

<ul>
  <li>docker-machine</li>
  <li>docker-compose</li>
</ul>

<p>ãã‚Œãã‚Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ä¸‹è¨˜ã®é€šã‚Šã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-machine <span class="nt">-v</span>
<span class="go">docker-machine version 0.6.0, build e27fb87

</span><span class="gp">$</span><span class="w"> </span>docker-compose <span class="nt">-v</span>
<span class="go">docker-compose version 1.6.2, build unknown
</span></code></pre></div></div>

<h2 id="docker-machine-æº–å‚™">docker-machine æº–å‚™</h2>

<p><code class="language-plaintext highlighter-rouge">docker-machine create</code> ã§defaultã®machineã‚’ä½œæˆã—ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-machine create <span class="nt">--driver</span> virtualbox default
<span class="go">Running pre-create checks...
(...snip...)
(default) Creating VirtualBox VM...
(default) Creating SSH key...
(default) Starting the VM...
(default) Check network to re-create if needed...
(default) Found a new host-only adapter: "vboxnet0"
(default) Waiting for an IP...
Waiting for machine to be running, this may take a few minutes...
Detecting operating system of created instance...
Waiting for SSH to be available...
Detecting the provisioner...
Provisioning with boot2docker...
Copying certs to the local machine directory...
Copying certs to the remote machine...
Setting Docker configuration on the remote daemon...
Checking connection to Docker...
Docker is up and running!
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env default
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">docker-machine ls</code> ã§çŠ¶æ…‹ã‚’ç¢ºèªã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-machine <span class="nb">ls</span>
<span class="go">NAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER    ERRORS
default   -        virtualbox   Running   tcp://192.168.99.100:2376           v1.10.3
</span></code></pre></div></div>

<p>STATE: Running ã«ãªã£ã¦ã¾ã™ã­ã€‚</p>

<h3 id="ç’°å¢ƒå¤‰æ•°è¨­å®š">ç’°å¢ƒå¤‰æ•°è¨­å®š</h3>

<p>docker-machine ã®ç’°å¢ƒå¤‰æ•°ã‚’ã‚»ãƒƒãƒˆã—ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">eval</span> <span class="s2">"</span><span class="si">$(</span>docker-machine <span class="nb">env </span>default<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>

<h2 id="railsè¨­å®š">Railsè¨­å®š</h2>

<h3 id="dockerfile">Dockerfile</h3>

<p>ã“ã®ã‚ˆã†ã«<code class="language-plaintext highlighter-rouge">Dockerfile</code>ã‚’ä½œæˆã—ã¾ã™ã€‚</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> ruby:2.3.0</span>
<span class="k">RUN </span>apt-get update <span class="nt">-qq</span> <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> build-essential libpq-dev
<span class="k">RUN </span><span class="nb">mkdir</span> /myapp
<span class="k">WORKDIR</span><span class="s"> /myapp</span>
<span class="k">ADD</span><span class="s"> Gemfile /myapp/Gemfile</span>
<span class="k">ADD</span><span class="s"> Gemfile.lock /myapp/Gemfile.lock</span>
<span class="k">RUN </span>bundle <span class="nb">install</span>
<span class="k">ADD</span><span class="s"> . /myapp</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Dockerfile</code>ã«æ›¸ã„ã¦ã‚ã‚‹å†…å®¹ã¯ã ã„ãŸã„ã“ã‚“ãªæ„Ÿã˜ã€‚</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">FROM</code>: Docker hub ã®rubyã‚¤ãƒ¡ãƒ¼ã‚¸ã€2.3.0ã‚¿ã‚°ã‚’ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã™ã‚‹</li>
  <li><code class="language-plaintext highlighter-rouge">WORKDIR</code>: <code class="language-plaintext highlighter-rouge">mkdir /myapp</code>ã—ã¦ãã“ã‚’ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨å®£è¨€</li>
  <li><code class="language-plaintext highlighter-rouge">Gemfile</code>, <code class="language-plaintext highlighter-rouge">Gemfile.lock</code>ã‚’è¿½åŠ </li>
  <li><code class="language-plaintext highlighter-rouge">WORKDIR</code>ã«ã¦<code class="language-plaintext highlighter-rouge">bundle install</code>ã™ã‚‹</li>
</ul>

<h3 id="docker-composeyml">docker-compose.yml</h3>

<p><code class="language-plaintext highlighter-rouge">docker-compose.yml</code>ã‚’ç”¨æ„ã—ã¾ã™ã€‚<code class="language-plaintext highlighter-rouge">docker-compose.yml</code>ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2'</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yes"</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">bundle exec rails s -p 3000 -b '0.0.0.0'</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.:/myapp</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">web</code>, <code class="language-plaintext highlighter-rouge">db</code> ã®ï¼’ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç”¨æ„ã—ã¾ã™ã€‚ä»Šå›ã¯<code class="language-plaintext highlighter-rouge">db</code>ã¯mysqlã§ã„ãã¾ã™ã€‚</p>

<h3 id="gemfile-gemfilelock">Gemfile, Gemfile.lock</h3>

<p><code class="language-plaintext highlighter-rouge">Gemfile</code>ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚rails 4.2.6 ã§ã„ãã¾ã—ã‚‡ã†ã€‚</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>
<span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span> <span class="s1">'4.2.6'</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Gemfile.lock</code>ã¯ç©ºã£ã½ã§ :ok: .</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">touch </span>Gemfile.lock
</code></pre></div></div>

<h3 id="rails-new">rails new</h3>

<p>ã“ã‚Œã§æº–å‚™å®Œäº†ã€‚æ¬¡ã«<code class="language-plaintext highlighter-rouge">docker-compose</code>ã‚’é€šã—ã¦<code class="language-plaintext highlighter-rouge">rails new</code>ã—ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-compose run web rails new <span class="nb">.</span> <span class="nt">--force</span> <span class="nt">--database</span><span class="o">=</span>mysql <span class="nt">--skip-bundle</span>
</code></pre></div></div>

<p>ã“ã‚Œã§webã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦<code class="language-plaintext highlighter-rouge">rails new</code>ã•ã‚Œã€ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãã®æˆæœç‰©ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<p>Gemfileã®<code class="language-plaintext highlighter-rouge">therubyracer</code> gemã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤–ã—ã¦<code class="language-plaintext highlighter-rouge">docker-compose build</code>ã—ã¾ã™ã€‚</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s1">'therubyracer'</span><span class="p">,</span> <span class="ss">platforms: :ruby</span>
</code></pre></div></div>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-compose build
<span class="go">db uses an image, skipping
Building web
Step 1 : FROM ruby:2.3.0
</span><span class="gp"> ---&gt;</span><span class="w"> </span>268e5f4c6264
<span class="go">Step 2 : RUN apt-get update -qq &amp;&amp; apt-get install -y build-essential libpq-dev
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>b5f055055282
<span class="go">Step 3 : RUN mkdir /myapp
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>ef58bac5859f
<span class="go">Step 4 : WORKDIR /myapp
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>d712516a5383
<span class="go">Step 5 : ADD Gemfile /myapp/Gemfile
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>45897d961453
<span class="go">Step 6 : ADD Gemfile.lock /myapp/Gemfile.lock
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>1e9aadcd1985
<span class="go">Step 7 : RUN bundle install
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Running <span class="k">in </span>db6cade21717
<span class="go">Fetching gem metadata from https://rubygems.org/...........
Fetching version metadata from https://rubygems.org/...
Fetching dependency metadata from https://rubygems.org/..
Resolving dependencies...
Installing rake 11.1.2
...snip...
Removing intermediate container b18b021bc248
Step 8 : ADD . /myapp
</span><span class="gp"> ---&gt;</span><span class="w"> </span>e259ae327e06
<span class="go">Removing intermediate container 568e85cfeee6
Successfully built e259ae327e06
</span></code></pre></div></div>

<h2 id="ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š</h2>

<p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å‘ãå…ˆãŒ<code class="language-plaintext highlighter-rouge">localhost</code>ã«ãªã£ã¦ã„ã¾ã™ã®ã§ã€ã“ã‚Œã‚’<code class="language-plaintext highlighter-rouge">db</code>ã‚³ãƒ³ãƒ†ãƒŠã«å‘ã‘ã¦ã‚„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>

<p>ä¸‹è¨˜ã®é€šã‚Šã€<code class="language-plaintext highlighter-rouge">config/database.yml</code>å†…ã®hostã«<code class="language-plaintext highlighter-rouge">db</code>ã‚’æŒ‡å®šã—ã¾ã—ã‚‡ã†ã€‚</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/database.yml</span>
<span class="na">default</span><span class="pi">:</span> <span class="nl">&amp;default</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="na">encoding</span><span class="pi">:</span> <span class="s">utf8</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="m">5</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>
  <span class="na">password</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">db</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">myapp_development</span>
</code></pre></div></div>

<p>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®šãŒå®Œäº†ã—ãŸã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-compose run web rake db:create
</code></pre></div></div>

<h2 id="docker-compose-up">docker-compose up</h2>

<p><code class="language-plaintext highlighter-rouge">docker-compose up</code>ã—ã¦rails serverã‚’ç«‹ã¡ä¸Šã’ã¾ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-compose up
<span class="go">Recreating rails1_db_1
Recreating rails1_web_1
Attaching to rails1_db_1, rails1_web_1
db_1  | 2016-04-09T16:48:34.775827Z 0 [Note] mysqld (mysqld 5.7.11) starting as process 1 ...
...snip...
db_1  | Version: '5.7.11'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  MySQL Community Server (GPL)
web_1 | [2016-04-09 16:48:38] INFO  WEBrick 1.3.1
web_1 | [2016-04-09 16:48:38] INFO  ruby 2.3.0 (2015-12-25) [x86_64-linux]
</span><span class="gp">web_1 | [2016-04-09 16:48:38] INFO  WEBrick::HTTPServer#</span>start: <span class="nv">pid</span><span class="o">=</span>1 <span class="nv">port</span><span class="o">=</span>3000
</code></pre></div></div>

<p>ã“ã‚Œã§rails serverãŒæº–å‚™ã§ãã¾ã—ãŸã€‚<code class="language-plaintext highlighter-rouge">192.168.99.100:3000</code>ã§ãƒšãƒ¼ã‚¸ãŒè¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>

<p>ã¡ãªã¿ã«docker-machineã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«å–å¾—å¯èƒ½ã§ã™ã€‚</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>docker-machine ip default
<span class="go">192.168.99.100
</span></code></pre></div></div>

<p>ã“ã‚Œã«ã¦å®Œäº†ï¼</p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<ul>
  <li><a href="https://docs.docker.com/compose/rails/">Quickstart: Compose and Rails</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="docker" /><summary type="html"><![CDATA[docker-machine, docker-compose ã‚’ä½¿ã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã«docker Railsç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã¿ã¾ã™ã€‚]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/docker/compose.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/docker/compose.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Ruby on Rails ã‚’ Google App Engine ä¸Šã§å‹•ã‹ã—ã¦ã¿ã‚‹</title><link href="https://blog.toshimaru.net/ruby-on-google-app-engine/" rel="alternate" type="text/html" title="Ruby on Rails ã‚’ Google App Engine ä¸Šã§å‹•ã‹ã—ã¦ã¿ã‚‹" /><published>2016-03-26T00:00:00+09:00</published><updated>2016-03-26T00:00:00+09:00</updated><id>https://blog.toshimaru.net/ruby-on-google-app-engine</id><content type="html" xml:base="https://blog.toshimaru.net/ruby-on-google-app-engine/"><![CDATA[<p><a href="http://www.publickey1.jp/blog/16/google_app_enginerubynodejsgcp_next_2016.html">ï¼»é€Ÿå ±ï¼½Google App EngineãŒRubyã¨Node.jsã®ã‚µãƒãƒ¼ãƒˆã‚’ç™ºè¡¨ã€‚GCP Next 2016 ï¼ Publickey</a></p>

<p>ã¨ã„ã†ã“ã¨ã§Ruby on Railsã‚’Google App Engine ä¸Šã§å‹•ã‹ã—ã¦ã¿ã¾ã—ãŸã€‚æ‰‹é †ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ» <a href="https://cloud.google.com/ruby/getting-started/hello-world">How to run Hello World - Ruby â€” Google Cloud Platform</a> ã‚’å‚è€ƒã«é€²ã‚ã¦ã„ãã¾ã™ã€‚</p>

<h2 id="å‰æ">å‰æ</h2>

<ul>
  <li>gcloud ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã“ã¨ï¼ˆ<a href="https://cloud.google.com/sdk/">Google Cloud SDK</a>ã«å«ã¾ã‚Œã¦ã„ã¾ã™ï¼‰</li>
  <li>Google Cloud Platformã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã§ã‚ã‚Šã€ä»Šå›ã®ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã¨ãªã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆæ¸ˆã¿ã§ã‚ã‚‹ã“ã¨</li>
</ul>

<h2 id="æ‰‹é †">æ‰‹é †</h2>

<h3 id="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h3>

<p><a href="https://github.com/GoogleCloudPlatform/getting-started-ruby">GoogleCloudPlatform/getting-started-ruby</a> ã®Hello World Appã‚’ä»Šå›ã¯å‹•ã‹ã—ã¾ã™ã®ã§ã¾ãšã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/GoogleCloudPlatform/getting-started-ruby.git
$ cd 1-hello-world
</code></pre></div></div>

<p>ã¾ãšã¯é€šå¸¸ã®Ruby on Railsã‚¢ãƒ—ãƒªã¨åŒã˜ã<code class="language-plaintext highlighter-rouge">bundle install</code>ã—ã¦Railsã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bundle install
$ rails server
</code></pre></div></div>

<p>ã“ã‚Œã§<code class="language-plaintext highlighter-rouge">localhost:3000</code>ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹Hello World AppãŒè¦‹ã‚Œã¾ã—ãŸã€‚</p>

<h3 id="gcloud-ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—">gcloud ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h3>

<p>gcloud ã‚’ä½¿ã£ã¦è¡Œãã¾ã™ãŒã„ãã¤ã‹äº‹å‰ã®è¨­å®šãŒå¿…è¦ã‚ã‚Šã¾ã™ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># åˆæœŸåŒ–
$ gcloud init

# Googleãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹
$ gcloud auth login

# ä»Šå›ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’ã‚»ãƒƒãƒˆ
$ gcloud config set project {your-project-id}
</code></pre></div></div>

<p>ã“ã‚Œã§app deployã‚³ãƒãƒ³ãƒ‰ãŒå‹•ä½œã—ã¾ã—ãŸã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gcloud preview app deploy
</code></pre></div></div>

<p>ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚ã¨ã¯ AppEngine Console ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä¸€è¦§ã«å‡ºã¦ãã¾ã™ã€‚</p>

<p><img src="/images/posts/ruby-gae/deploy-version.png" alt="deploy-version" /></p>

<h3 id="ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ãƒ­ã‚°">ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ãƒ­ã‚°</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Beginning deployment...
If this is your first deployment, this may take a while...done.

Using Ruby 2.2.4 as requested in the .ruby-version file
Verifying that Managed VMs are enabled and ready.
Building and pushing image for module [default]
Started cloud build [789f0d61-dc0a-4994-8292-02a5ff9f65de].
To see logs in the Cloud Console: https://console.developers.google.com/logs?project=your-project-id&amp;service=cloudbuild.googleapis.com&amp;key1=789f0d61-dc0a-4994-8292-02a5ff9f65de&amp;logName=projects/your-project-id/logs/cloudbuild
--------------------------------- REMOTE BUILD OUTPUT ----------------------------------
starting build "789f0d61-dc0a-4994-8292-02a5ff9f65de"

FETCHSOURCE
Fetching storage object: gs://staging.your-project-id.appspot.com/your-project-id.default.20160326t100408#1458954328349000
Copying gs://staging.your-project-id.appspot.com/your-project-id.default.20160326t100408#1458954328349000...
Downloading file:///tmp/source-archive.tgz:                      13.32 KiB/13.32 KiB
FETCHBUILDER
Using default tag: latest
latest: Pulling from cloud-builders/dockerizer
bf61d14f65db: Pulling fs layer
3ea15286bc1a: Pulling fs layer
515285067dbf: Pulling fs layer
5e89b839ecfa: Pulling fs layer
e63e5abf57a3: Pulling fs layer
ec858f8c1767: Pulling fs layer
51d0afdd2ff8: Pulling fs layer
415319aa0c90: Pulling fs layer
51d0afdd2ff8: Verifying Checksum
51d0afdd2ff8: Download complete
415319aa0c90: Verifying Checksum
415319aa0c90: Download complete
5e89b839ecfa: Verifying Checksum
5e89b839ecfa: Download complete
3ea15286bc1a: Verifying Checksum
3ea15286bc1a: Download complete
515285067dbf: Verifying Checksum
515285067dbf: Download complete
e63e5abf57a3: Verifying Checksum
e63e5abf57a3: Download complete
ec858f8c1767: Verifying Checksum
ec858f8c1767: Download complete
bf61d14f65db: Verifying Checksum
bf61d14f65db: Download complete
bf61d14f65db: Pull complete
3ea15286bc1a: Pull complete
515285067dbf: Pull complete
5e89b839ecfa: Pull complete
e63e5abf57a3: Pull complete
ec858f8c1767: Pull complete
51d0afdd2ff8: Pull complete
415319aa0c90: Pull complete
Digest: sha256:b80a8cc7ed504307717c7530e795b0c2dea1ff99957806e0785ae831309084ae
Status: Downloaded newer image for gcr.io/cloud-builders/dockerizer:latest
BUILD
Client:
 Version:      1.9.1
 API version:  1.21
 Go version:   go1.4.3
 Git commit:   a34a1d5
 Built:        Fri Nov 20 17:56:04 UTC 2015
 OS/Arch:      linux/amd64

Server:
 Version:      1.9.1
 API version:  1.21
 Go version:   go1.4.2
 Git commit:   a34a1d5
 Built:        Fri Nov 20 13:12:04 UTC 2015
 OS/Arch:      linux/amd64
Sending build context to Docker daemon 90.62 kB
Step 1 : FROM gcr.io/google_appengine/ruby
 ---&gt; 3e6d0d6d0575
Step 2 : RUN cd /rbenv/plugins/ruby-build &amp;&amp;     git pull &amp;&amp;     rbenv install -s 2.2.4 &amp;&amp;     rbenv global 2.2.4 &amp;&amp;     gem install -q --no-rdoc --no-ri bundler --version 1.11.2 &amp;&amp;     gem install -q --no-rdoc --no-ri foreman --version 0.78.0
 ---&gt; Running in 451faee44d37
Already up-to-date.
Successfully installed bundler-1.11.2
1 gem installed
Successfully installed foreman-0.78.0
1 gem installed
 ---&gt; 5da2526068cb
Removing intermediate container 451faee44d37
Step 3 : ENV RBENV_VERSION 2.2.4
 ---&gt; Running in 1e6f8d74782b
 ---&gt; 416110028d7d
Removing intermediate container 1e6f8d74782b
Step 4 : COPY Gemfile Gemfile.lock /app/
 ---&gt; 0ab134d54690
Removing intermediate container 7337fb40c45b
Step 5 : RUN bundle install &amp;&amp; rbenv rehash
 ---&gt; Running in 0c258ea5a1be
Don't run Bundler as root. Bundler can ask for sudo if it is needed, and
installing your bundle as root will break this application for all non-root
users on this machine.
Fetching gem metadata from https://rubygems.org/...........
Fetching version metadata from https://rubygems.org/...
Fetching dependency metadata from https://rubygems.org/..
Using rake 10.4.2
Installing i18n 0.7.0
Installing json 1.8.3 with native extensions
Installing minitest 5.7.0
Installing thread_safe 0.3.5
Installing builder 3.2.2
Installing erubis 2.7.0
Installing mini_portile 0.6.2
Installing rack 1.6.4
Installing mime-types 2.6.1
Installing arel 6.0.0
Installing cliver 0.3.2
Installing diff-lcs 1.2.5
Installing multi_json 1.11.2
Installing websocket-extensions 0.1.2
Using bundler 1.11.2
Using thor 0.19.1
Installing rspec-support 3.3.0
Installing tzinfo 1.2.2
Installing nokogiri 1.6.6.2 with native extensions
Installing rack-test 0.6.3
Installing sprockets 3.2.0
Installing mail 2.6.3
Installing websocket-driver 0.6.3 with native extensions
Installing rspec-core 3.3.1
Installing rspec-expectations 3.3.0
Installing rspec-mocks 3.3.1
Installing activesupport 4.2.2
Installing tzinfo-data 1.2015.6
Installing loofah 2.0.2
Installing xpath 2.0.0
Installing rails-deprecated_sanitizer 1.0.3
Installing globalid 0.3.5
Installing activemodel 4.2.2
Installing rails-html-sanitizer 1.0.2
Installing capybara 2.4.4
Installing rails-dom-testing 1.0.6
Installing activejob 4.2.2
Installing activerecord 4.2.2
Installing poltergeist 1.8.1
Installing actionview 4.2.2
Installing actionpack 4.2.2
Installing actionmailer 4.2.2
Installing railties 4.2.2
Installing sprockets-rails 2.3.2
Installing rspec-rails 3.3.2
Installing rails 4.2.2
Bundle complete! 6 Gemfile dependencies, 47 gems now installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
 ---&gt; 9fde5c5bec0c
Removing intermediate container 0c258ea5a1be
Step 6 : COPY . /app/
 ---&gt; 05eb1e2b6b90
Removing intermediate container e885ebd8251c
Step 7 : ENTRYPOINT bundle exec rackup -p 8080 -E production config.ru
 ---&gt; Running in 1b616e80361d
 ---&gt; 0695731649da
Removing intermediate container 1b616e80361d
Successfully built 0695731649da
PUSH
The push refers to a repository [appengine.gcr.io/gcloud/your-project-id.default.20160326t100408] (len: 1)
Sending image list
Pushing repository appengine.gcr.io/gcloud/your-project-id.default.20160326t100408 (1 tags)
Image 3bc7cdb36864 already pushed, skipping
Image 4bfc20f0ed66 already pushed, skipping
Image ff52712bb308 already pushed, skipping
Image 5880acd9ad50 already pushed, skipping
Image 096d9403d234 already pushed, skipping
Image 956eb41cd003 already pushed, skipping
Image 01eaa1a367c4 already pushed, skipping
Image 943d779f0853 already pushed, skipping
Image 3cc9009b6572 already pushed, skipping
Image b19c39f03dbb already pushed, skipping
Image ca6428f24e68 already pushed, skipping
Image 7b90390ae965 already pushed, skipping
Image cb10a2abbe53 already pushed, skipping
Image 31bee42bdd8a already pushed, skipping
Image a04427afe410 already pushed, skipping
Image 8f70e181ae11 already pushed, skipping
Image 72b1839f75eb already pushed, skipping
Image 0ea63ea23bf2 already pushed, skipping
Image 86100fe6deed already pushed, skipping
Image 45ab69b78373 already pushed, skipping
Image 32066980c48e already pushed, skipping
Image fc85fe8bcbac already pushed, skipping
Image 76b185852e95 already pushed, skipping
Image eec69d4fcd9a already pushed, skipping
Image 17402d207077 already pushed, skipping
Image 27bea8c63202 already pushed, skipping
Image 3e6d0d6d0575 already pushed, skipping
5da2526068cb: Pushing
5da2526068cb: Image successfully pushed
416110028d7d: Pushing
416110028d7d: Image successfully pushed
0ab134d54690: Pushing
0ab134d54690: Image successfully pushed
9fde5c5bec0c: Pushing
9fde5c5bec0c: Image successfully pushed
05eb1e2b6b90: Pushing
05eb1e2b6b90: Image successfully pushed
0695731649da: Pushing
0695731649da: Image successfully pushed
Pushing tag for rev [0695731649da] on {https://appengine.gcr.io/v1/repositories/gcloud/your-project-id.default.20160326t100408/tags/latest}
DONE
----------------------------------------------------------------------------------------

Updating module [default]...done.
Deployed module [default] to [https://your-project-id.appspot.com]
</code></pre></div></div>

<h2 id="appyml">app.yml</h2>

<p>ä»Šå›ä½¿ã‚ã‚Œã¦ã„ã‚‹<code class="language-plaintext highlighter-rouge">app.yml</code>ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã—ãŸã€‚</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># [START runtime]</span>
<span class="na">runtime</span><span class="pi">:</span> <span class="s">ruby</span>
<span class="na">vm</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">entrypoint</span><span class="pi">:</span> <span class="s">bundle exec rackup -p 8080 -E production config.ru</span>
<span class="c1"># [END runtime]</span>

<span class="c1"># [START resources]</span>
<span class="na">resources</span><span class="pi">:</span>
  <span class="na">cpu</span><span class="pi">:</span> <span class="s">.5</span>
  <span class="na">memory_gb</span><span class="pi">:</span> <span class="m">1.3</span>
  <span class="na">disk_size_gb</span><span class="pi">:</span> <span class="m">10</span>
<span class="c1"># [END resources]</span>

<span class="c1"># [START scaling]</span>
<span class="na">automatic_scaling</span><span class="pi">:</span>
  <span class="na">min_num_instances</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">max_num_instances</span><span class="pi">:</span> <span class="m">5</span>
  <span class="na">cool_down_period_sec</span><span class="pi">:</span> <span class="m">60</span>
  <span class="na">cpu_utilization</span><span class="pi">:</span>
    <span class="na">target_utilization</span><span class="pi">:</span> <span class="m">0.5</span>
<span class="c1"># [END scaling]</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">runtime</code>ã®è¨­å®šãŒrubyãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å…±é€šã®è¨­å®šã§<code class="language-plaintext highlighter-rouge">resources</code>, <code class="language-plaintext highlighter-rouge">scaling</code>ã¯ç’°å¢ƒã«åˆã‚ã›ã¦é©å®œãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¦ãã ã•ã„ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®çŠ¶æ…‹ã¨ã—ã¦ã¯ãƒŸãƒ‹ãƒãƒ«ãªè¨­å®šã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚</p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<ul>
  <li><a href="https://github.com/GoogleCloudPlatform/ruby-docker">GoogleCloudPlatform/ruby-docker: Docker images for Ruby</a></li>
  <li><a href="https://github.com/GoogleCloudPlatform/ruby-docker/blob/master/appengine/Dockerfile">ruby-docker/Dockerfile at master Â· GoogleCloudPlatform/ruby-docker</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="google-app-engine" /><category term="rails" /><category term="docker" /><summary type="html"><![CDATA[Ruby on Railsã‚’Google App Engine ä¸Šã§å‹•ã‹ã—ã¦ã¿ã¾ã—ãŸã€‚æ‰‹é †ã¯Googleå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã€ŒHow to run Hello World - Ruby â€” Google Cloud Platformã€ã‚’å‚è€ƒã«é€²ã‚ã¦ã„ãã¾ã™ã€‚]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/ruby-gae/ruby.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/ruby-gae/ruby.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>