<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator><link href="https://blog.toshimaru.net/feed/by_tag/rake.xml" rel="self" type="application/atom+xml" /><link href="https://blog.toshimaru.net/" rel="alternate" type="text/html" /><updated>2023-12-31T17:21:42+09:00</updated><id>https://blog.toshimaru.net/feed/by_tag/rake.xml</id><title type="html">Hack Your Design!</title><subtitle>toshimaruの技術系なブログ</subtitle><author><name>Toshimaru</name></author><entry><title type="html">他のrakeタスクに依存するrakeタスクの実行</title><link href="https://blog.toshimaru.net/rake-dependency/" rel="alternate" type="text/html" title="他のrakeタスクに依存するrakeタスクの実行" /><published>2015-08-22T00:00:00+09:00</published><updated>2015-08-22T00:00:00+09:00</updated><id>https://blog.toshimaru.net/rake-dependency</id><content type="html" xml:base="https://blog.toshimaru.net/rake-dependency/"><![CDATA[<h2 id="rakeタスクの前に別のrakeタスクを実行">rakeタスクの前に別のrakeタスクを実行</h2>

<p>ある特定のRakeタスクを実行する前に別のタスクを実行したい場合、このようにタスクを書きます。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">task</span><span class="p">(</span><span class="ss">:x</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"x"</span> <span class="p">}</span>
<span class="n">task</span><span class="p">(</span><span class="ss">:y</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"y"</span> <span class="p">}</span>
<span class="n">task</span><span class="p">(</span><span class="ss">:z</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"z"</span> <span class="p">}</span>

<span class="n">desc</span> <span class="s2">"dependency rake task"</span>
<span class="n">task</span> <span class="ss">foo: </span><span class="p">[</span><span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span><span class="p">,</span> <span class="ss">:z</span><span class="p">]</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">"foo task"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>結果はこんな感じ。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rake foo
x
y
z
foo task
</code></pre></div></div>

<p>タスク<code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">y</code>, <code class="language-plaintext highlighter-rouge">z</code> が実行された後にタスク<code class="language-plaintext highlighter-rouge">foo</code>が実行されます。</p>

<h3 id="別の方法">別の方法</h3>

<p>また下記のように<code class="language-plaintext highlighter-rouge">foo</code>タスクのみ先に定期して、別のtaskとして依存を定義することも可能です。</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">task</span><span class="p">(</span><span class="ss">:x</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"x"</span> <span class="p">}</span>
<span class="n">task</span><span class="p">(</span><span class="ss">:y</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"y"</span> <span class="p">}</span>
<span class="n">task</span><span class="p">(</span><span class="ss">:z</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"z"</span> <span class="p">}</span>

<span class="n">desc</span> <span class="s2">"dependency rake task"</span>
<span class="n">task</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">"foo task"</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">foo: </span><span class="p">[</span><span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span><span class="p">,</span> <span class="ss">:z</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rake foo
x
y
z
foo task
</code></pre></div></div>

<h2 id="rakeタスクの後に別のrakeタスクを実行">rakeタスクの後に別のrakeタスクを実行</h2>

<p>ある特定のRakeタスクを実行する後に別のタスクを実行したい場合、<code class="language-plaintext highlighter-rouge">enhance</code>を使ってこのようにタスクを書けます。さっきの書いたタスクをenhanceしてみましょう。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">task</span><span class="p">(</span><span class="ss">:x</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"x"</span> <span class="p">}</span>
<span class="n">task</span><span class="p">(</span><span class="ss">:y</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"y"</span> <span class="p">}</span>
<span class="n">task</span><span class="p">(</span><span class="ss">:z</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"z"</span> <span class="p">}</span>

<span class="n">desc</span> <span class="s2">"dependency rake task"</span>
<span class="n">task</span> <span class="ss">foo: </span><span class="p">[</span><span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span><span class="p">,</span> <span class="ss">:z</span><span class="p">]</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">"foo task"</span>
<span class="k">end</span>

<span class="no">Rake</span><span class="o">::</span><span class="no">Task</span><span class="p">[</span><span class="s2">"foo"</span><span class="p">].</span><span class="nf">enhance</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">"foo enhancing task"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>結果はこんな感じ。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rake foo
x
y
z
foo task
foo enhancing task
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">enhance</code>の中にかいた処理はしっかり<code class="language-plaintext highlighter-rouge">foo</code>タスクのあとに実行されていますね。</p>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="http://www.dan-manges.com/blog/modifying-rake-tasks">Modifying Rake Tasks - Dan Manges’s Blog</a></li>
  <li><a href="https://github.com/ruby/rake">ruby/rake</a></li>
  <li><a href="http://yamayo.github.io/blog/2014/06/06/rake-before-task-hook/">Rake で before task をフックする - northaven</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="rake" /><summary type="html"><![CDATA[他のrakeタスクに依存性のあるrakeタスクの実行の仕方について紹介します。]]></summary></entry><entry><title type="html">Rakeタスクにエイリアスを付ける</title><link href="https://blog.toshimaru.net/rake-alias/" rel="alternate" type="text/html" title="Rakeタスクにエイリアスを付ける" /><published>2013-11-17T00:00:00+09:00</published><updated>2013-11-17T00:00:00+09:00</updated><id>https://blog.toshimaru.net/rake-alias</id><content type="html" xml:base="https://blog.toshimaru.net/rake-alias/"><![CDATA[<p>RubyのRakeタスクにエイリアス付けたいときってありませんか？</p>

<p>僕はあります。<code class="language-plaintext highlighter-rouge">rake create</code>なんていうタスクがあったとしたら、手癖で<code class="language-plaintext highlighter-rouge">rake new</code>とか打っちゃうことがあるんですよ。そういうときは<code class="language-plaintext highlighter-rouge">alias_task</code>なんていう関数を作ってやって、タスク名に別のエイリアス名を割り当ててやればOK。具体的にはこんな感じです。</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">alias_task</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
  <span class="n">tasks</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">new_name</span><span class="p">,</span> <span class="n">old_name</span><span class="o">|</span>
    <span class="n">task</span> <span class="n">new_name</span><span class="p">,</span> <span class="p">[</span><span class="o">*</span><span class="no">Rake</span><span class="p">.</span><span class="nf">application</span><span class="p">[</span><span class="n">old_name</span><span class="p">].</span><span class="nf">arg_names</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="n">old_name</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">alias_task</span> <span class="p">[</span>
  <span class="p">[</span><span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="p">],</span>
  <span class="p">[</span><span class="ss">:dc</span><span class="p">,</span>  <span class="ss">:db_create</span><span class="p">]</span>
<span class="p">]</span>
</code></pre></div></div>

<p>このコードでは</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">create</code>タスクに<code class="language-plaintext highlighter-rouge">new</code>というエイリアス名</li>
  <li><code class="language-plaintext highlighter-rouge">db_create</code>タスクに<code class="language-plaintext highlighter-rouge">dc</code>というエイリアス名</li>
</ul>

<p>をそれぞれ割り当てています。</p>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="http://stackoverflow.com/questions/7656541/the-alias-of-task-name-in-rake">The alias of task name in rake</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="ruby" /><category term="rake" /><summary type="html"><![CDATA[RubyのRakeタスクにエイリアス付けたいときってありません？ 僕はあります。rake createなんていうタスクがあったとしたら、何らかの手癖のせいでrake newとか打っちゃうことがあるんですよ。そういうときはalias_taskなんていう関数を作ってやって、タスク名に別のエイリアス名を割り当ててやればOK。]]></summary></entry></feed>