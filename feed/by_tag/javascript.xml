<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="https://blog.toshimaru.net/feed/by_tag/javascript.xml" rel="self" type="application/atom+xml" /><link href="https://blog.toshimaru.net/" rel="alternate" type="text/html" /><updated>2022-05-23T01:30:20+09:00</updated><id>https://blog.toshimaru.net/feed/by_tag/javascript.xml</id><title type="html">Hack Your Design!</title><subtitle>toshimaruの技術系なブログ</subtitle><author><name>Toshimaru</name></author><entry><title type="html">JavaScriptのXHRの送り方いろいろ: XMLHttpRequest, fetch, async/await</title><link href="https://blog.toshimaru.net/new-xhr-fetch-asyncawait/" rel="alternate" type="text/html" title="JavaScriptのXHRの送り方いろいろ: XMLHttpRequest, fetch, async/await" /><published>2017-02-20T00:00:00+09:00</published><updated>2017-02-20T00:00:00+09:00</updated><id>https://blog.toshimaru.net/new-xhr-fetch-asyncawait</id><content type="html" xml:base="https://blog.toshimaru.net/new-xhr-fetch-asyncawait/"><![CDATA[<p>JavaScriptのXHR(XMLHttpRequest)の送り方は１つだけではありません。モダンなXHRに向けてそれぞれのHTTPリクエストの送り方を比較・検討してみます。</p>

<h2 id="前提">前提</h2>

<ul>
  <li><a href="https://jquery.com/">jQuery</a>, <a href="https://github.com/visionmedia/superagent">superagent</a>, <a href="https://github.com/mzabriskie/axios">axios</a>などのAJAX系ライブラリは使用しないこととする。</li>
  <li>検証に使うブラウザは最新版のChrome (現在はVersion56.0)</li>
  <li>今回リクエストを送る先は仮想的に下記のURLとする</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://your.domain.net/</span><span class="dl">"</span>
</code></pre></div></div>

<h2 id="1-xmlhttprequest">1. XMLHttpRequest</h2>

<p>さぁ,まずは古き良き<a href="https://developer.mozilla.org/ja/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>。ローレベルなAPIでAJAX処理が書きにくいのですが、歴史がある分多くのブラウザで動作します。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">error!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</code></pre></div></div>

<p>Chrome Dev Toolのコンソールで動かしてみましょう。</p>

<p><img src="/images/posts/xhr/1.png" alt="xhr1" /></p>

<h3 id="モダンな書き方にしてみよう">モダンな書き方にしてみよう！</h3>

<p>このまま次のXHRに進んでも良いですがせっかくなので上記のコードをもう少しモダンにしてみます。</p>

<p>今回は下記の２つの書き方を導入します。</p>

<ul>
  <li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/const">const</a> = 定数</li>
  <li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Functions/Arrow_functions">Arrow function</a> = アロー関数</li>
</ul>

<p>上記の2つで1のXMLHttpRequestのコードを書き直すとこのようになります。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">error!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">var</code>は<code class="language-plaintext highlighter-rouge">const</code>に、<code class="language-plaintext highlighter-rouge">function</code>は<code class="language-plaintext highlighter-rouge">=&gt;</code>へと変更しています。わかりやすくなってスッキリしましたね。</p>

<p>この書き方でも動くかChrome Dev Toolのコンソールで動かしてみましょう。</p>

<p><img src="/images/posts/xhr/2.png" alt="xhr2" /></p>

<p>:ok: でした。</p>

<h2 id="2-fetch-api">2. fetch API</h2>

<p>次は<code class="language-plaintext highlighter-rouge">fetch</code> APIを使ってXHRしてみましょう。ちなみにfetch APIはChrome Version 42よりサポートされています。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">error caught!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>コードとしてはurlを<code class="language-plaintext highlighter-rouge">fetch</code>して<code class="language-plaintext highlighter-rouge">then</code>, <code class="language-plaintext highlighter-rouge">catch</code>をチェインさせてそれぞれの処理内容を書いていくというものになります。</p>

<p>Chrome Dev Toolコンソールで動かした結果。</p>

<p><img src="/images/posts/xhr/3.png" alt="xhr3" /></p>

<p><code class="language-plaintext highlighter-rouge">fetch</code>は<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>を返す点がポイントですね。</p>

<h2 id="3-fetch--asyncawait">3. fetch + async/await</h2>

<p>最後のXHRは<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/async_function">async/await</a>になります。Chrome55からのサポートなので最近追加された機能ということになります。</p>

<p>さきほどの<code class="language-plaintext highlighter-rouge">fetch</code>のコードをasync/awaitの機能を使って書き換えてみましょう。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">async</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">error!</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})();</span>
</code></pre></div></div>

<p>ポイントとしては <code class="language-plaintext highlighter-rouge">async</code>を使ってまず無名関数を作ります。これでその関数内に<code class="language-plaintext highlighter-rouge">await</code>を使う準備ができました。<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/await">await</a>はPromiseが返されるのを待機するので、先程のPromiseを返す<code class="language-plaintext highlighter-rouge">fetch</code>関数の手前に<code class="language-plaintext highlighter-rouge">await</code>を宣言します。これで<code class="language-plaintext highlighter-rouge">fetch</code>関数は<code class="language-plaintext highlighter-rouge">then</code>でコールバックをチェインする必要がなくなり、<code class="language-plaintext highlighter-rouge">response</code>変数にダイレクトに結果が代入されます。エラー処理に関してはtryで処理内容を囲み、catchでエラーを補足します。</p>

<p>コンソールで動かしてみた結果は下記の通り。</p>

<p><img src="/images/posts/xhr/4.png" alt="xhr4" /></p>

<h2 id="結論">結論</h2>

<p>結論としては現時点では3つめのfetch+async/awaitな書き方が最もモダンな書き方となります。</p>

<p>3の書き方でなにが嬉しいかというと:</p>

<ul>
  <li>非同期処理でありがちなコールバック地獄からの解放</li>
  <li>同期的なコードで書けるので書きやすい・読みやすい</li>
  <li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/try...catch">try~catch節</a>を用いているのでエラー処理の見通しが良い</li>
</ul>

<p>このあたりでしょうか。</p>

<p>まだasync/awaitシンタックスはECMAScript 2017のDraftな仕様というステータスであり現時点でIEはサポートしていない書き方です。なので多くの人が触る環境下のコードベースにおける導入は厳しいですが、これらが使える利用環境を限定できるのであれば積極的に使っていきたい書き方ですね。</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/OC7tgJP1D4s" frameborder="0" allowfullscreen=""></iframe>

<h2 id="おまけbabelで使う場合">（おまけ）babelで使う場合</h2>

<p>babel で async/await のシンタックス使いたい場合は<code class="language-plaintext highlighter-rouge">babel-plugin-syntax-async-functions</code>を使うことになります。</p>

<p><a href="https://babeljs.io/docs/plugins/syntax-async-functions/">Syntax async functions · Babel</a></p>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="https://jakearchibald.com/2015/thats-so-fetch/">That’s so fetch! - JakeArchibald.com</a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest - Web APIs | MDN</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="javascript" /><category term="ajax" /><summary type="html"><![CDATA[JavaScriptのXHR(XMLHttpRequest)の送り方は１つだけではありません。モダンなXHRに向けてそれぞれのHTTPリクエストの送り方を比較・検討してみます。jQuery, superagent, axiosなどのAJAX系ライブラリは使用しないこととする。 検証に使うブラウザは最新版のChrome (現在はVersion56.0) 今回リクエストを送る先は仮想的に下記のURLとする。]]></summary></entry><entry><title type="html">jQueryでHTMLタグ要素をcreateElement使わずに生成する</title><link href="https://blog.toshimaru.net/jqueryhidden-inputjquery/" rel="alternate" type="text/html" title="jQueryでHTMLタグ要素をcreateElement使わずに生成する" /><published>2016-01-17T00:00:00+09:00</published><updated>2016-01-17T00:00:00+09:00</updated><id>https://blog.toshimaru.net/jqueryhidden-inputjquery</id><content type="html" xml:base="https://blog.toshimaru.net/jqueryhidden-inputjquery/"><![CDATA[<h2 id="やりたいこと">やりたいこと</h2>

<p>とある<code class="language-plaintext highlighter-rouge">&lt;form&gt;</code>があってその中にjQueryで動的にinput hiddenタグ要素を生成&amp;追加して送信したい。</p>

<h2 id="方法">方法</h2>

<p>要素を生成しようと思ったときにぱっと思いつくのは、<code class="language-plaintext highlighter-rouge">document.createElement</code>だが、jQueryを使うと下記のように簡潔にかける。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"targetId"</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;input&gt;</span><span class="dl">'</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hidden</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">input_id</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">value</span><span class="p">:</span> <span class="mi">12345</span>
<span class="p">}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="dl">'</span><span class="s1">#targetId</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>また下記のように<code class="language-plaintext highlighter-rouge">attr</code>を使わずに書くことができる（コメントで教えていただきました taku hhara さん、ありがとうございます）。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;input&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hidden</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">input_id</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">value</span><span class="p">:</span> <span class="mi">12345</span>
<span class="p">}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="dl">'</span><span class="s1">#targetId</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="テキストの入ったdivを生成">テキストの入ったdivを生成</h2>

<p>上述のテクニックを使った下記のようなテキストの入った<code class="language-plaintext highlighter-rouge">div</code>要素も生成できます。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;div&gt;</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span><span class="dl">'</span><span class="s1">hoge</span><span class="dl">'</span><span class="p">,</span> <span class="na">class</span><span class="p">:</span><span class="dl">'</span><span class="s1">fuga</span><span class="dl">'</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span><span class="dl">'</span><span class="s1">piyo</span><span class="dl">'</span> <span class="p">});</span>
</code></pre></div></div>

<p>このコードは下記コードと同じ結果を得られます。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;div id="hoge"&gt;&lt;span class="fuga"&gt;piyo&lt;/span&gt;&lt;/div&gt;</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>(コードは<a href="http://ginpen.com/2012/12/01/jquery-core-func/">jQueryの$()が多機能すぎる件について。5種類も仕事があるよ。</a>より引用)</p>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="http://stackoverflow.com/questions/2408043/jquery-create-hidden-form-element-on-the-fly">Jquery - Create hidden form element on the fly</a></li>
  <li><a href="http://stackoverflow.com/questions/268490/jquery-document-createelement-equivalent">jQuery document.createElement equivalent?</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="javascript" /><category term="jquery" /><summary type="html"><![CDATA[とあるがあってその中にjQueryで動的にinput hiddenタグ要素を生成&追加して送信したい。要素を生成しようと思ったときにぱっと思いつくのは、document.createElementだが、jQueryを使うと簡潔にかける。]]></summary></entry><entry><title type="html">video.js で m3u8 形式の動画ファイルをブラウザで再生する</title><link href="https://blog.toshimaru.net/play-m3u8-video-in-browser/" rel="alternate" type="text/html" title="video.js で m3u8 形式の動画ファイルをブラウザで再生する" /><published>2015-05-03T00:00:00+09:00</published><updated>2015-05-03T00:00:00+09:00</updated><id>https://blog.toshimaru.net/play-m3u8-video-in-browser</id><content type="html" xml:base="https://blog.toshimaru.net/play-m3u8-video-in-browser/"><![CDATA[<p><a href="https://github.com/videojs/video.js">video.js</a>を使ってm3u8形式の動画ファイルをSafari以外のブラウザでも再生する方法を紹介します。デモページは下のボタンから。</p>

<p><a href="http://toshimaru.net/demo/videojs-m3u8/" class="btn btn-primary">Demo</a></p>

<h2 id="動作環境">動作環境</h2>

<p>下記環境で（現時点の最新版での）動作を確認しています。</p>

<ul>
  <li>Chrome</li>
  <li>Safari</li>
  <li>Opera</li>
  <li>Safari</li>
</ul>

<p><strong>※要Flash</strong></p>

<h2 id="使うjsライブラリ">使うJSライブラリ</h2>
<ol>
  <li><a href="https://github.com/videojs/video.js">videojs/video.js</a>
    <ul>
      <li>基本素材。動画ファイルを様々なブラウザで再生できるようにする。</li>
    </ul>
  </li>
  <li><a href="https://github.com/videojs/videojs-contrib-media-sources">videojs/videojs-contrib-media-sources</a>
    <ul>
      <li>videoタグに動画ソースを流し込めるようにするvideo.jsプラグイン。</li>
      <li>W3Cのドラフト仕様<a href="https://w3c.github.io/media-source/">Media Source Extensions</a>が元のよう。</li>
    </ul>
  </li>
  <li><a href="https://github.com/videojs/videojs-contrib-hls">videojs/videojs-contrib-hls</a>
    <ul>
      <li>HLS(<code class="language-plaintext highlighter-rouge">m3u8</code>)形式の動画ファイルを再生可能にするvideo.jsプラグイン。</li>
      <li>HLSに対応していないブラウザでもFlash技術を通すことで再生可能にしているよう。</li>
    </ul>
  </li>
</ol>

<h2 id="usage">Usage</h2>

<p>全体HTMLファイルはこんな感じ。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Video.js m3u8<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"css/video-js.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"//cdnjs.cloudflare.com/ajax/libs/video.js/4.12.5/video.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/videojs-media-sources.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/videojs.hls.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;h1&gt;</span>Video.js m3u8 demo page<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"test"</span> <span class="na">class=</span><span class="s">"video-js vjs-default-skin"</span> <span class="na">height=</span><span class="s">"300"</span> <span class="na">width=</span><span class="s">"600"</span> <span class="na">controls</span><span class="nt">&gt;</span>
      <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">"//solutions.brightcove.com/jwhisenant/hls/apple/bipbop/bipbopall.m3u8"</span> <span class="na">type=</span><span class="s">"application/x-mpegURL"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/video&gt;</span>

    <span class="nt">&lt;script&gt;</span>
      <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">videojs</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">);</span>
      <span class="nx">player</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
    <span class="nt">&lt;/script&gt;</span>

  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<h3 id="cssjs読み込み">CSS/JS読み込み</h3>

<p>video.js, videojs-media-sources.js, videojs.hls.js 以外にもCSSを読み込まないとエラーが出て再生できなかったのでCSSも読み込むこと。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"css/video-js.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"//cdnjs.cloudflare.com/ajax/libs/video.js/4.12.5/video.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/videojs-media-sources.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/videojs.hls.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></figure>

<h3 id="videoタグ">videoタグ</h3>

<p>適当なクラスを持った<code class="language-plaintext highlighter-rouge">&lt;video&gt;</code>をタグに<code class="language-plaintext highlighter-rouge">height</code>, <code class="language-plaintext highlighter-rouge">width</code>を定義してやって、中に<code class="language-plaintext highlighter-rouge">type="application/x-mpegURL"</code>と<code class="language-plaintext highlighter-rouge">src</code>を持った<code class="language-plaintext highlighter-rouge">&lt;source&gt;</code>タグを入れてやる。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"test"</span> <span class="na">class=</span><span class="s">"video-js vjs-default-skin"</span> <span class="na">height=</span><span class="s">"300"</span> <span class="na">width=</span><span class="s">"600"</span> <span class="na">controls</span><span class="nt">&gt;</span>
  <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">"//solutions.brightcove.com/jwhisenant/hls/apple/bipbop/bipbopall.m3u8"</span> <span class="na">type=</span><span class="s">"application/x-mpegURL"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/video&gt;</span></code></pre></figure>

<h3 id="javascript">JavaScript</h3>

<p><code class="language-plaintext highlighter-rouge">videojs()</code>内にvideoタグのIDでplayerを生成してplay。</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">videojs</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">player</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span></code></pre></figure>

<h2 id="最後に">最後に</h2>

<p>クロスオリジンな動画リソースを読み込むときは CORS(Cross-Origin Resource Sharing) の設定を適切にしてやる必要があることに注意！</p>

<hr />

<h2 id="追記">追記</h2>

<p>本記事を参考に書かれた下記の記事も参考になるかもしれません。</p>

<p><a href="http://akiyoko.hatenablog.jp/entry/2015/08/11/015852">Video.js を使って HLS形式の動画をストリーミング再生する - akiyoko blog</a></p>]]></content><author><name>Toshimaru</name></author><category term="video" /><category term="javascript" /><summary type="html"><![CDATA[video.jsを使ってm3u8形式の動画ファイルをSafari以外のブラウザでも再生する方法を紹介します。]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/videojs.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/videojs.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Canvas+Chart.jsでグラフを描画する</title><link href="https://blog.toshimaru.net/chart-js/" rel="alternate" type="text/html" title="Canvas+Chart.jsでグラフを描画する" /><published>2013-11-21T00:00:00+09:00</published><updated>2013-11-21T00:00:00+09:00</updated><id>https://blog.toshimaru.net/chart-js</id><content type="html" xml:base="https://blog.toshimaru.net/chart-js/"><![CDATA[<p><a href="/cool-ui/">昨日のエントリ</a>で実験的に記事内のグラフを画像ではなくJSでCanvas要素を使って描画してみました。そのときに使用した<a href="http://www.chartjs.org/">Chart.js</a>がなかなかいい感じだったので紹介。</p>

<h2 id="導入">導入</h2>

<p>まずは<code class="language-plaintext highlighter-rouge">Chart.js</code>をincludeしてください。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;script src="Chart.js"&gt;&lt;/script&gt;
</code></pre></div></div>

<h2 id="線グラフ">線グラフ</h2>

<p>まずは線グラフ。</p>

<canvas id="line" width="300"></canvas>

<script src="https://gist.github.com/toshimaru/e9d483cdb65c54d87e8d.js"></script>

<h2 id="棒グラフ">棒グラフ</h2>

<p>次は棒。</p>

<canvas id="bar" width="300"></canvas>

<script src="https://gist.github.com/toshimaru/14e8e9ab91d48b71673c.js"></script>

<h2 id="レーダーチャート">レーダーチャート</h2>

<p>次はレーダーチャート。幅の制限により少し小さくなってしまいました。</p>

<canvas id="radar" width="300"></canvas>

<script src="https://gist.github.com/toshimaru/136570ccc4f90049096a.js"></script>

<h2 id="円グラフ">円グラフ</h2>

<p>最期に円グラフ。</p>

<canvas id="pie" width="300"></canvas>

<script src="https://gist.github.com/toshimaru/2fb67c25d80683e4f1e2.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/Chart.js/0.2.0/Chart.min.js"></script>

<script type="text/javascript">
(function(){
  // line
  var ctx = document.getElementById("line").getContext("2d");
  var data = {
    labels : ["1月", "2月", "3月", "4月", "5月"],
    datasets : [
      {
        fillColor : "rgba(220,220,220,0.5)",
        strokeColor : "rgba(220,220,220,1)",
        data : [65,59,90,81,56]
      },
      {
        fillColor : "rgba(151,187,205,0.5)",
        strokeColor : "rgba(151,187,205,1)",
        data : [28,48,40,19,100]
      }
    ]
  }
  new Chart(ctx).Line(data);

  // bar
  var ctx = document.getElementById("bar").getContext("2d");
  new Chart(ctx).Bar(data);

  var ctx = document.getElementById("radar").getContext("2d");
  new Chart(ctx).Radar(data);

  var ctx = document.getElementById("pie").getContext("2d");
  var data = [
    {
      value: 30,
      color:"#F38630"
    },
    {
      value : 50,
      color : "#E0E4CC"
    },
    {
      value : 100,
      color : "#69D2E7"
    }
  ]
  new Chart(ctx).Pie(data);
})();
</script>

<h2 id="その他">その他</h2>
<p>もっと細かいチャートの設定がしたければ<code class="language-plaintext highlighter-rouge">data</code>のあとにオプション引数を取ることもできます。その他のグラフ、細かいオプションに関しては<a href="http://www.chartjs.org/docs/">公式ドキュメント</a>を参考にしてください。</p>

<p>あと細かいところですがチャートを描画するときにアニメーションで描画されてます。気付かなかったかもなので一応。</p>

<h2 id="課題">課題</h2>

<p>見てわかるようにレスポンシブデザインに対応しておりません。なのでとりあえずのところ現在はwidthを300に固定することにしています（なのでグラフが小さくなっております）。これに関しては<a href="https://github.com/nnnick/Chart.js/issues/56">Github Issues</a>で現在も議論されておりますがスマートな解決法は無いので、公式のレスポンシブデザイン対応が期待されます。</p>

<h2 id="参考">参考</h2>

<p><a href="http://startapp.jp/2013/07/21/how-to-create-flat-chart.html">絶対まねしたい！Chart.jsを使ってフラットデザインぽいグラフを作る方法</a></p>]]></content><author><name>Toshimaru</name></author><category term="javascript" /><summary type="html"><![CDATA[昨日のエントリで実験的に記事内のグラフを画像ではなくJSでCanvas要素を使って描画してみました。そのときに使用したChart.jsがなかなかいい感じだったので紹介。まずはChart.jsをincludeしてください。]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/canvasjs.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/canvasjs.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">マイナーJS・CSSライブラリのCDNはcdnjs.comがいい感じ</title><link href="https://blog.toshimaru.net/cdn-js/" rel="alternate" type="text/html" title="マイナーJS・CSSライブラリのCDNはcdnjs.comがいい感じ" /><published>2013-08-17T00:00:00+09:00</published><updated>2013-08-17T00:00:00+09:00</updated><id>https://blog.toshimaru.net/cdn-js</id><content type="html" xml:base="https://blog.toshimaru.net/cdn-js/"><![CDATA[<p>Web制作において外部でホストされているライブラリを読み込むことは多いですね。こんな感じで。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"&gt;&lt;/script&gt;
</code></pre></div></div>

<p>CDNは安心と信頼のGoogleのCDNを使いたいところですが、メジャーなライブラリしかホストされていません。例えばBackbone.jsとかはホストされていない。</p>

<p>そこで使うべきは <a href="http://cdnjs.com/">cdnjs.com</a>。</p>

<p>マイナーなものでも名前が通ってるライブラリであれば本CDNに登録されている印象です。</p>]]></content><author><name>Toshimaru</name></author><category term="javascript" /><summary type="html"><![CDATA[CDNは安心と信頼のGoogleのCDNを使いたいところですが、メジャーなライブラリしかホストされていません。例えばBackbone.jsとかはホストされていない。そこで使うべきは cdnjs.com。]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/cdnjs.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/cdnjs.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">underscore.js のテンプレートのデフォルトデリミタを変更する</title><link href="https://blog.toshimaru.net/underscore-template-in-erb/" rel="alternate" type="text/html" title="underscore.js のテンプレートのデフォルトデリミタを変更する" /><published>2013-08-05T00:00:00+09:00</published><updated>2013-08-05T00:00:00+09:00</updated><id>https://blog.toshimaru.net/underscore-template-in-erb</id><content type="html" xml:base="https://blog.toshimaru.net/underscore-template-in-erb/"><![CDATA[<p>Railsのerb内でunderscore.jsのテンプレートを使おうとするとerbのデリミタとunderscoreのデリミタが競合してしまってエラーになってしまう。そういう時は下記のようにunderscoreテンプレートのデリミタを<code class="language-plaintext highlighter-rouge">templateSettings</code>を使って変更してやればよい。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">_</span><span class="p">.</span><span class="nx">templateSettings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">interpolate</span> <span class="p">:</span> <span class="sr">/</span><span class="se">\{\{(</span><span class="sr">.+</span><span class="se">?)\}\}</span><span class="sr">/g</span><span class="p">,</span>
  <span class="na">escape</span><span class="p">:</span> <span class="sr">/</span><span class="se">\{\{</span><span class="sr">-</span><span class="se">(</span><span class="sr">.+</span><span class="se">?)\}\}</span><span class="sr">/g</span>
<span class="p">};</span>
</code></pre></div></div>

<p>これで <code class="language-plaintext highlighter-rouge">{{ hoge }}</code> という<a href="http://mustache.github.io/">mustache</a>ライクなデリミタに変更できる。</p>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="http://null.ly/post/20000241563/underscore-js-erb">Underscore.js のテンプレートを ERB の中で使う</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="javascript" /><summary type="html"><![CDATA[erb内でunderscore.jsのテンプレートを使おうとするとerbのデリミタと競合してしまってエラーになってしまう。そういう時は下記のようにunderscoreテンプレートのデリミタをtemplateSettingsを使って変更してやればよい。]]></summary></entry><entry><title type="html">Backbone.jsをそろそろ学習したい人のための学習リソース集（2013年版）</title><link href="https://blog.toshimaru.net/backbone-learn/" rel="alternate" type="text/html" title="Backbone.jsをそろそろ学習したい人のための学習リソース集（2013年版）" /><published>2013-07-30T00:00:00+09:00</published><updated>2013-07-30T00:00:00+09:00</updated><id>https://blog.toshimaru.net/backbone-learn</id><content type="html" xml:base="https://blog.toshimaru.net/backbone-learn/"><![CDATA[<p>Backbone.jsを週末を使って学習しました。メモがてらそのときに使った学習リソースをまとめてみたいと思います。</p>

<h2 id="公式サイト">公式サイト</h2>
<p>まずは公式サイト。ただ公式サイトを眺めただけじゃようわからないので、ざっと眺めるだけでOKだと思います。</p>

<p><a href="http://underscorejs.org/">Backbone.js</a></p>

<h2 id="動画でbackboneを触ってみる">動画でBackboneを触ってみる</h2>

<p>ドットインストールのBackbone入門。手を動かしてもいいですし、流し見でもいいでしょう。</p>

<p><a href="http://dotinstall.com/lessons/basic_backbonejs">Backbone.js入門（ドットインストール）</a></p>

<p><img src="/images/posts/backbone/dotinstall.png" alt="dotinstall" /></p>

<p>英語、かつ有料になりますがプログラミング学習サイト、Code Schoolのコンテンツも非常にいいです。</p>

<p><a href="http://www.codeschool.com/courses/anatomy-of-backbonejs">Anatomy of Backbone.js（Code School）</a></p>

<p><img src="/images/posts/backbone/codeschool.png" alt="codeschool" /></p>

<h2 id="文章でbackboneを理解する">文章でBackboneを理解する</h2>

<p>英語になりますがオライリーのBackbone本がWEBで公開されているので読めます。（日本語訳版は現時点で出版されていないようです）</p>

<p><a href="http://addyosmani.github.io/backbone-fundamentals/">Developing Backbone.js Applications</a></p>

<p><img src="/images/posts/backbone/book.png" alt="book" /></p>

<p>日本語だとこちらの本がよいと思います。</p>

<p><a href="http://www.amazon.co.jp/gp/product/4899773501/ref=as_li_tf_il?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4899773501&amp;linkCode=as2&amp;tag=toshimaru-22"><img border="0" src="http://ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=4899773501&amp;Format=_SL160_&amp;ID=AsinImage&amp;MarketPlace=JP&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=toshimaru-22" /></a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=toshimaru-22&amp;l=as2&amp;o=9&amp;a=4899773501" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

<h2 id="スライドでbackboneの良さを理解する">スライドでBackboneの良さを理解する</h2>

<iframe src="http://www.slideshare.net/slideshow/embed_code/12146222" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen=""> </iframe>
<div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/iloveigloo/clientside-mvc-with-backbonejs" title="Client-side MVC with Backbone.js " target="_blank">Client-side MVC with Backbone.js </a> </strong> from <strong><a href="http://www.slideshare.net/iloveigloo" target="_blank">iloveigloo</a></strong> </div>

<iframe src="http://www.slideshare.net/slideshow/embed_code/22635630" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen="" webkitallowfullscreen="" mozallowfullscreen=""> </iframe>
<div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/kadoppe/backbonejs-22635630" title="いまさら聞けない！？Backbone.js 超入門" target="_blank">いまさら聞けない！？Backbone.js 超入門</a> </strong> from <strong><a href="http://www.slideshare.net/kadoppe" target="_blank">Kohei Kadowaki</a></strong> </div>

<h2 id="実際に動くサンプルを見る">実際に動くサンプルを見る</h2>
<p>「いいから動くサンプルだ！」という方には、いろんなJSフレームワークでTODOアプリを作るプロジェクト、<a href="http://todomvc.com/">TodoMVC</a>のリソースが役立つでしょう。Backbone.jsのプロジェクトはこちら。</p>

<p><a href="http://todomvc.com/architecture-examples/backbone/">Backbone.js(TodoMVC)</a></p>

<p><img src="/images/posts/backbone/todomvc.png" alt="todomvc" /></p>

<p>※Backbone以外にも学習、比較したいJSフレームワークがあるならここで眺めてみるとよいでしょう。</p>

<h2 id="backboneの講演を聞いて理解を深める">Backboneの講演を聞いて理解を深める</h2>
<p>Backboneの作者自身による講演です。</p>

<iframe width="560" height="315" src="//www.youtube.com/embed/4udR30JYenA" frameborder="0" allowfullscreen=""></iframe>

<h2 id="backboneを学習してみて">Backboneを学習してみて</h2>
<p>railsなどに代表されるサーバサイドのMVCとBackboneでいうところのMVCは似て非なるもの。前者を前提として学習を進めていくと痛い目をみるかもしれません。</p>

<p>BackboneにもModel, View, Collectionという名前があって一瞬勘違いしそうになりますが、CollectionはModelの集積。本がModelだとしたら本棚がCollection。なのでrailsでいうところのModelはBackboneではModel/Collectionが担っていて、View,ControllerはBackboneではViewが担う。</p>

<p>上記を踏まえた上で、それぞれのオブジェクトがどういう役割を担っていて、疎結合に保たれているのかを意識して学習すると良い気がしました。</p>

<p>またBackboneというと自由度の高さが逆に足枷になる場合があって、なかなか「ベスト・プラクティス」なるものが見つけにくいのも悩ましいところです。これはいろいろなサンプルを見るなりして窺い知るくらいしかできないと思っています。</p>

<h2 id="参考">参考</h2>
<ul>
  <li><a href="http://mawatari.jp/archives/roadmap-for-backbonejs-beginners">Backbone.js入門 – 初学者の為のロードマップ</a></li>
  <li><a href="http://d.hatena.ne.jp/kazuk_i/20110407/1302130947">Backbone.jsを利用したクライアントサイドMVCの導入についてそろそろ書いておくか</a> 【筆者注】やや情報が古いので注意！</li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="javascript" /><summary type="html"><![CDATA[Backbone.jsを週末を使って学習しました。メモがてらそのときに使った学習リソースをまとめてみたいと思います。]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/backbone/backbone.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/backbone/backbone.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Qiita 2-day Hackathon に参加してきた</title><link href="https://blog.toshimaru.net/qiita-2-day-hackathon/" rel="alternate" type="text/html" title="Qiita 2-day Hackathon に参加してきた" /><published>2013-02-06T00:00:00+09:00</published><updated>2013-02-06T00:00:00+09:00</updated><id>https://blog.toshimaru.net/qiita-2-day-hackathon</id><content type="html" xml:base="https://blog.toshimaru.net/qiita-2-day-hackathon/"><![CDATA[<p><a href="http://qiitahackathon03.peatix.com/">Qiita 2-day Hackathon</a>に参加してきました。</p>
<p>僕にとっての初めてのハッカソン参加となりました。残念ながら入賞はなりませんでしたがとてもいい経験になりました。</p>
<h2>開発テーマ</h2>
<p>ハッカソンのテーマは「GitHub APIを用いた開発+プログラマの問題を解決するサービス」でした。僕がそれでつくったのはこちら。</p>
<p><a href="http://github-tl.toshimaru.net/" target="_blank">Github Timeline</a></p>
<p><img src="/images/2013/02/github-timeline.png"></p>
<h2>動機</h2>
<p>githubのNews Feedを僕はよく見るのだけど、もっとキャッチーにTwitterのように見れたらよくない？</p>
<h2>アーキテクチャ</h2>
<ul>
<li>backend     
<ul>
<li>sinatra</li>
<li>heroku</li>
</ul>
</li>
<li>frontend     
<ul>
<li>jQuery</li>
<li>hogan.js</li>
<li>less.js</li>
</ul>
</li>
</ul>
<p>frontendの実装については、以前作った<a href="http://blog.toshimaru.net/twitter-search-api-js">twitterの検索</a>の経験が生きた。あと、微妙に以前書いた<a href="http://blog.toshimaru.net/jquery-ajaxdeferredajax">jQuery deferred のテク</a>を使ったり。</p>
<h2>発表スライド</h2>
<p>ハッカソンの発表で使った発表スライドはこちらです。</p>
<p><a href="http://toshimaru.net/slides/github_hackathon/#/">http://toshimaru.net/slides/github_hackathon/#/</a></p>
<p><a href="http://toshimaru.net/slides/github_hackathon/#/"><img src="/images/2013/02/gtimeline-slide.png"></a></p>
<p>ちなみにこちらのプレゼンテーションはWEBで動いてますが、JSプレゼンテーションフレームワークには<a href="http://lab.hakim.se/reveal-js/">reveal.js</a>を使わせてもらいました。プレゼンには<a href="http://bartaz.github.com/impress.js/#/bored">impress.js</a><a>&nbsp;</a><a href="http://flowtime-js.marcolago.com/">flowtime.js</a> <a href="http://imakewebthings.com/deck.js/">deck.js</a>を検討しましたが、パッと見て一番簡単に作れそうなrevealを採用させてもらいました。</p>
<h2>審査基準</h2>
<p>実際に作ったものに対する審査基準は下記でした。こんな感じでハッカソンの成果物が評価されるんですね。</p>
<ul>
<li>実際にプログラマの問題を解決 できそうか</li>
<li>多くのプログラマが幸せになれそうか</li>
<li>アイデアはよいか</li>
<li>完成度</li>
</ul>
<h2>ハッカソンを終えてみて</h2>
<p>開発時間は二日間のうち、1日目13:00~2日目15:00の26時間くらいありました。僕は朝までぶっ通しで開発して、朝になって三時間ほど睡眠してまた開発、という感じでやりました。</p>
<p>今回のバックエンド・アーキテクチャで使用したRubyアプリケーション(sinatra)、herokuへのデプロイ、両方ともに初めてでした。なので1日目の間にこの辺のやり方はケリをつけておきたくて、それらを朝までに集中してやって目処をつけておきました。目処はついたタイミングで休んだのでそのあと発表までは、かなり余裕をもって望むことができました。このへんの時間配分に関してはよかったと思ってます。</p>
<p>ちょっと残念だったこととしては、僕はNews Feedをよくチェックするので本アプリケーションを作ったわけですが、周囲の反応を見てると他の開発者の方々はそこまでNews Feedをチェックしていないようで、そこまで同意を得られなかったことでしょうか。たくさんの開発者が「これは便利！すぐ使いたい！」となるようなアイディアを発案できなかったのは残念です。最優秀賞をとった方はやはり、みんなすぐに「いいね！」という反応が得られるアイデアでした。</p>
<p>今回のハッカソンは個人参加でしたが、今度はチーム参加もしてみたいと思いました。</p>
<h2>PJ(Github COO)と話す！</h2>
<p>Github COO の<a href="https://github.com/pjhyett">PJ</a>とも僕の拙い英語ですが話すことができました。「Githubにおいて重要なことって何ですか？」と聞くと、「オープンソースだ。自分のプロジェクトを公開する、それが何より重要だ。」と答えたので、「なるほど。そういう意味じゃGithubはオープンソースしたい開発者にとっては最高な場所だよね！」というとPJがすごく嬉しそうに微笑んでたのが印象的でした。</p>
<p>僕が作ったモノに対しても聞いてみると、「Coolなアプリケーションだったぜ」といってくれたのが（お世辞だとしても）嬉しかったです。</p>
<h2>最後に</h2>
<p>入賞を目指すべく、APIについてしっかり予習して当日望んだわけですが、入賞ならず残念。。。だたPJと話せたりいろんなプログラマの「ハック」も見れて良い経験になりました。最終的に動くものを公開できたことも良かったです。</p>
<p>イベント最後にはGithubからMicroプラン１年無料券をいただけるという粋なプレゼントもあり、素晴らしいハッカソンでした。開催していただいたQiitaおよびスタッフの皆様、ありがとうございました。</p>
<p>そして2日間のハッカソンを走りきった開発者の皆様、お疲れ様でした！</p>]]></content><author><name>Toshimaru</name></author><category term="javascript" /><category term="tech" /><summary type="html"><![CDATA[Qiita 2-day Hackathonに参加してきました。僕にとっての初めてのハッカソン参加となりました。残念ながら入賞はなりませんでしたがとてもいい経験になりました。]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/qiitahack.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/qiitahack.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">jQueryのDeferredを用いたモダンなAjax処理の書き方</title><link href="https://blog.toshimaru.net/jquery-ajaxdeferredajax/" rel="alternate" type="text/html" title="jQueryのDeferredを用いたモダンなAjax処理の書き方" /><published>2012-12-13T00:00:00+09:00</published><updated>2012-12-13T00:00:00+09:00</updated><id>https://blog.toshimaru.net/jquery-ajaxdeferredajax</id><content type="html" xml:base="https://blog.toshimaru.net/jquery-ajaxdeferredajax/"><![CDATA[<p>本エントリは<a href="http://www.adventar.org/calendars/29">軽めのjQuery Advent Calendar 2012</a>の14日目の記事として書きます。軽めといいながら少し重めになってしまった感がありますが、初めてのAdvent Calendar参加ということでご勘弁を。</p>

<p><strong class="red">※ Twitter API仕様変更によりTwitter APIを使ったコード例は現在動作しなくなっていることにご注意。</strong></p>

<h2 id="jquery-14以前の書き方">jQuery 1.4以前の書き方</h2>

<p>まずは、少し古めのコード、昔のjQueryの本とかでよく見る書き方。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ajax.html</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">success!!</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error!!!</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="jquery-15以上の書き方">jQuery 1.5以上の書き方</h2>

<p>1.5以降だと、<code class="language-plaintext highlighter-rouge">$.ajax()</code> は<a href="http://api.jquery.com/jQuery.ajax/#jqXHR">jqXHRオブジェクト</a>を返すようになります。それを利用した書き方はこう。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ajax.html</span><span class="dl">"</span><span class="p">,</span>
<span class="p">}).</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">success!!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error!!!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>成功時の処理と失敗時の処理が<code class="language-plaintext highlighter-rouge">ajax()</code>と並列に書くことができ、コード全体の見通しがぐっとよくなりましたね。</p>

<h2 id="jquery-18以上の書き方">jQuery 1.8以上の書き方</h2>

<p><a href="http://api.jquery.com/jQuery.ajax/">公式リファレンス</a>いわく、</p>

<blockquote>
  <p>Deprecation Notice: The jqXHR.success(), jqXHR.error(), and jqXHR.complete() callbacks will be deprecated in jQuery 1.8. To prepare your code for their eventual removal, use jqXHR.done(), jqXHR.fail(), and jqXHR.always() instead.</p>
</blockquote>

<p>つまり要約するとjQuery1.8から</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">success()</code> は <code class="language-plaintext highlighter-rouge">done()</code> に、</li>
  <li><code class="language-plaintext highlighter-rouge">error()</code> は <code class="language-plaintext highlighter-rouge">fail()</code> に、</li>
  <li><code class="language-plaintext highlighter-rouge">complete()</code> は <code class="language-plaintext highlighter-rouge">always()</code>を</li>
</ul>

<p>代わりに使ってね、ってことです。ということで、<code class="language-plaintext highlighter-rouge">success()</code>,<code class="language-plaintext highlighter-rouge">error()</code>は使わない。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ajax.html</span><span class="dl">"</span><span class="p">,</span>
<span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">success!!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error!!!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>あるいは<code class="language-plaintext highlighter-rouge">then()</code>を用いてこう書いてもいいでしょう。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ajax.html</span><span class="dl">"</span><span class="p">,</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">success!!</span><span class="dl">'</span><span class="p">);</span> <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error!!</span><span class="dl">'</span><span class="p">);</span>   <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">then()</code>の一個目の関数が成功時、二個目の関数が失敗時となります。</p>

<h2 id="発展編1deferredを用いた書き方">【発展編1】Deferredを用いた書き方</h2>

<p>上述した例の中でさりげなくDeferredな書き方を使っていましたが、発展編ということでこのDeferredな書き方をさらに突き詰めてみましょう。</p>

<h3 id="deferredとは何か">deferredとは何か？</h3>

<blockquote>
  <p>jQuery.Deferred() introduces several enhancements to the way callbacks are managed and invoked. In particular, jQuery.Deferred() provides flexible ways to provide multiple callbacks, and these callbacks can be invoked regardless of whether the original callback dispatch has already occurred. jQuery Deferred is based on the CommonJS Promises/A design.</p>

  <p>jQuery.Deferred() はコールバック関数の管理、実行に改善をもたらします。具体的には、jQuery.Deferred()は複数のコールバックの実行を柔軟に行うことができ、これらのコールバック関数は、オリジナルのコールバックのディスパッチが発生しているかどうかにかかわらず実行されます。</p>
</blockquote>

<p>要はコールバック関数の実行を延期(deferred)させて、<code class="language-plaintext highlighter-rouge">.then()</code> <code class="language-plaintext highlighter-rouge">.fail()</code> <code class="language-plaintext highlighter-rouge">.always()</code>なんかを使って柔軟にコールバックを管理、実行できるってことです（雑）。</p>

<p>詳しくは下記を読むとよいでしょう。</p>

<ul>
  <li><a href="http://msdn.microsoft.com/en-us/magazine/gg723713.aspx">Creating Responsive Applications Using jQuery Deferred and Promises</a></li>
  <li><a href="https://twitter.com/tokkonopapa">@tokkonoPapa</a>さんによる上記事の翻訳はこちら → <a href="http://tokkono.cute.coocan.jp/blog/slow/index.php/programming/jquery-deferred-for-responsive-applications-basic/">jQueryのDeferredとPromiseで応答性の良いアプリをー基本編</a></li>
</ul>

<p>論より実践。deferredをうまく使ったAjaxコードを見てみましょう。</p>

<p><a href="http://jsfiddle.net/toshimaru/yP58L/1/light/">jsfiddleでの実例はこちら</a></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Twitter</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">search</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">defer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://search.twitter.com/search.json</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">q</span><span class="p">:</span> <span class="nx">query</span><span class="p">,</span>
                <span class="na">rpp</span><span class="p">:</span> <span class="mi">50</span>
            <span class="p">},</span>
            <span class="na">dataType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">jsonp</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">success</span><span class="p">:</span> <span class="nx">defer</span><span class="p">.</span><span class="nx">resolve</span><span class="p">,</span>
            <span class="na">error</span><span class="p">:</span> <span class="nx">defer</span><span class="p">.</span><span class="nx">reject</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">defer</span><span class="p">.</span><span class="nx">promise</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#button</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Twitter</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="dl">'</span><span class="s1">jquery deferred</span><span class="dl">'</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">){</span>
           <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#tweets</span><span class="dl">'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">text</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;br/&gt;</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>見てわかるとおり、Deferredを使うことでtwitterの検索を行うAjax部分と結果取得時のイベント処理部分が分離できます。</p>

<p>これによりネストが深くならずに済み、コードの可読性が上がります。また、イベント処理部分のほうは</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Twitter</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="dl">'</span><span class="s1">query hoge</span><span class="dl">'</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* ...code... */</span> <span class="p">});</span>
</code></pre></div></div>

<p>と書くだけですから、ajax部分を気にすることなく結果取得後のイベント処理に意識を集中して書くことができます。素晴らしいですネ。</p>

<h2 id="発展編2when-を用いた書き方">【発展編2】$.when() を用いた書き方</h2>

<p><code class="language-plaintext highlighter-rouge">$.when()</code>を用いると複数のdeferredオブジェクトをまとめて管理できます。</p>

<p><a href="http://jsfiddle.net/toshimaru/nNMae/">jsfiddleでの実例はこちら</a></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// `Twitter`のコードは同上</span>
<span class="c1">// var Twitter = { ... }</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#button</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="nx">Twitter</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="dl">'</span><span class="s1">jquery deferred</span><span class="dl">'</span><span class="p">),</span> <span class="nx">Twitter</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="dl">'</span><span class="s1">jquery when</span><span class="dl">'</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data1</span><span class="p">,</span> <span class="nx">data2</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data1</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data2</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>when内のDeferredオブジェクト全ての処理が完了すると、その後の処理が発火します。複数のAJAX結果をまとめて処理したいってときに使えます。</p>

<hr />

<p>いかがだったでしょうか？ Deferredオブジェクトを使うことでより楽しいAjaxライフが送れそうですね。ワクワクしますね。</p>

<p>本日紹介したコードは<a href="https://gist.github.com/4269484">gist</a>にも上げております。</p>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="http://d.hatena.ne.jp/aoe-tk/20110515/1305471586">jQueryのDeferredオブジェクトについて調べてみた</a></li>
  <li><a href="http://tokkono.cute.coocan.jp/blog/slow/index.php/programming/how-happy-with-jquery-deferred-for-your-applications/">jQueryのDeferredとPromiseで応答性の良いアプリをー実践編</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="jquery" /><category term="javascript" /><category term="ajax" /><summary type="html"><![CDATA[jQeuryにおけるDeferredを用いたモダンなAjaxの書き方を目指して、jQueryのバージョン毎にステップ・バイ・ステップでコード付きで解説していきます。]]></summary></entry><entry><title type="html">Responsive Web Design 時代の画像スライダー</title><link href="https://blog.toshimaru.net/responsive-web-design/" rel="alternate" type="text/html" title="Responsive Web Design 時代の画像スライダー" /><published>2012-10-11T00:00:00+09:00</published><updated>2012-10-11T00:00:00+09:00</updated><id>https://blog.toshimaru.net/responsive-web-design</id><content type="html" xml:base="https://blog.toshimaru.net/responsive-web-design/"><![CDATA[<p>え？　"れすぽんしぶうぇぶでざいん"って何かって？</p>
<p>なかなか日本では聞きなれないような気がしなくもないですがこんな意味です。</p>
<blockquote>
<p>Responsive web design (often abbreviated to RWD) is an approach to web design in which a site is crafted to provide an optimal viewing experience&mdash;easy reading and navigation with a minimum of resizing, panning, and scrolling&mdash;across a wide range of devices (from desktop computer monitors to mobile phones).</p>
<p><a href="http://en.wikipedia.org/wiki/Responsive_web_design">Responsive web design (wikipedia)</a></p>
</blockquote>
<p>つまり、レスポンシブWEBデザインとは、デバイスの幅に応じてWebの見た目（レイアウトとかサイズとか）が最適化されるWebデザインの手法のことです。タブレット、スマホの台頭によってますます重要視されている手法ですね。</p>
<p>さて、本題。本日は画像スライダーのお話。</p>
<p>先日画像スライダーを実装する機会があったので「js slider」なんかでググって一番最初に出てくる<a href="http://www.slidesjs.com/">slidesjs</a>で画像スライダーを実装するわけです。でもスマホやタブレット見て分かる通り、全然それらのデバイスに最適化されてませんね。</p>
<p><img src="/images/2012/10/slider2.png"></p>
<p><a href="http://toshimaru.net/demo/slidesjs/">http://toshimaru.net/demo/slidesjs/</a></p>
<p>幅がデバイスに応じて変わったりもしないので、ちゃんと最適化されるような違う画像スライダーを探してみます。</p>
<p>んでたどり着いたのが<a href="http://flexslider.woothemes.com/">FlexSlider2</a>。ちゃんとPCでもタブレットでも最適化されて表示されますね。</p>
<p><img src="/images/2012/10/slider3.png"></p>
<p><img src="/images/2012/10/slider1.png"></p>
<p>スマホ、タブレット対応が必須な今、しっかりレスポンシブデザインを心がけてWEB制作をしていきたいところです。</p>
<h3>参考</h3>
<ul>
<li><a href="http://ascii.jp/elem/000/000/697/697463/">レスポンシブWebデザインとは</a> </li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="css" /><category term="design" /><category term="html" /><category term="javascript" /><summary type="html"><![CDATA[え？　"れすぽんしぶうぇぶでざいん"って何かって？ なかなか日本では聞きなれないような気がしなくもないですがこんな意味です。 Responsive web design (often abbreviated to RWD) is an approach to web design in which a site is crafted to provide an optimal viewing experience&mdash;easy reading and navigation with a minimum of resizing, panning, and scrolling&mdash;across a wide range of devices (from desktop computer monitors to mobile phones). Responsive web design (wikipedia) つまり、レスポンシブWEBデザインとは、デバイスの幅に応じてWebの見た目（レイアウトとかサイズとか）が最適化されるWebデザインの手法のことです。タブレット、スマホの台頭によってますます重要視されている手法ですね。 さて、本題。本日は画像スライダーのお話。 先日画像スライダーを実装する機会があったので「js slider」なんかでググって一番最初に出てくるslidesjsで画像スライダーを実装するわけです。でもスマホやタブレット見て分かる通り、全然それらのデバイスに最適化されてませんね。 http://toshimaru.net/demo/slidesjs/ 幅がデバイスに応じて変わったりもしないので、ちゃんと最適化されるような違う画像スライダーを探してみます。 んでたどり着いたのがFlexSlider2。ちゃんとPCでもタブレットでも最適化されて表示されますね。 スマホ、タブレット対応が必須な今、しっかりレスポンシブデザインを心がけてWEB制作をしていきたいところです。 参考 レスポンシブWebデザインとは]]></summary></entry></feed>