<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.1.1">Jekyll</generator><link href="https://blog.toshimaru.net/feed/by_tag/activerecord.xml" rel="self" type="application/atom+xml" /><link href="https://blog.toshimaru.net/" rel="alternate" type="text/html" /><updated>2020-11-24T01:10:50+09:00</updated><id>https://blog.toshimaru.net/feed/by_tag/activerecord.xml</id><title type="html">Hack Your Design!</title><subtitle>toshimaruã®æŠ€è¡“ç³»ãªãƒ–ãƒ­ã‚°</subtitle><author><name>Toshimaru</name></author><entry><title type="html">éŠ€åº§Rails#21ã§ã€ŒFat Modelã®å€’ã—æ–¹ã€ã‚’ç™ºè¡¨ã—ã¾ã—ãŸ</title><link href="https://blog.toshimaru.net/how-to-deal-with-fat-model/" rel="alternate" type="text/html" title="éŠ€åº§Rails#21ã§ã€ŒFat Modelã®å€’ã—æ–¹ã€ã‚’ç™ºè¡¨ã—ã¾ã—ãŸ" /><published>2020-06-01T00:00:00+09:00</published><updated>2020-06-05T00:00:00+09:00</updated><id>https://blog.toshimaru.net/how-to-deal-with-fat-model</id><content type="html" xml:base="https://blog.toshimaru.net/how-to-deal-with-fat-model/">&lt;p&gt;&lt;a href=&quot;https://ginza-rails.connpass.com/event/173610/&quot;&gt;éŠ€åº§Rails#21&lt;/a&gt;ã§ã€ŒFat Modelã®å€’ã—æ–¹ã€ã¨é¡Œã—ã¦ç™ºè¡¨ã—ã¦ãã¾ã—ãŸã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰&quot;&gt;ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰&lt;/h2&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;fa367404507c4311aa3eeb087fc45a6e&quot; data-ratio=&quot;1.33333333333333&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

&lt;h2 id=&quot;ç›®æ¬¡&quot;&gt;ç›®æ¬¡&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰&quot; id=&quot;markdown-toc-ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰&quot;&gt;ç™ºè¡¨ã‚¹ãƒ©ã‚¤ãƒ‰&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ç›®æ¬¡&quot; id=&quot;markdown-toc-ç›®æ¬¡&quot;&gt;ç›®æ¬¡&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#fat-rails-stage&quot; id=&quot;markdown-toc-fat-rails-stage&quot;&gt;Fat Rails Stage&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#fat-modelå¯¾å‡¦ã®ãŸã‚ã®ï¼“ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ&quot; id=&quot;markdown-toc-fat-modelå¯¾å‡¦ã®ãŸã‚ã®ï¼“ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ&quot;&gt;Fat Modelå¯¾å‡¦ã®ãŸã‚ã®ï¼“ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#rails-modelã®é™ç•Œ&quot; id=&quot;markdown-toc-rails-modelã®é™ç•Œ&quot;&gt;Rails Modelã®é™ç•Œ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#rails-modelã¯ãªãœè¾›ããªã‚‹ã®ã‹&quot; id=&quot;markdown-toc-rails-modelã¯ãªãœè¾›ããªã‚‹ã®ã‹&quot;&gt;Rails Modelã¯ãªãœè¾›ããªã‚‹ã®ã‹ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ç›®æŒ‡ã™ã¹ãã‚´ãƒ¼ãƒ«&quot; id=&quot;markdown-toc-ç›®æŒ‡ã™ã¹ãã‚´ãƒ¼ãƒ«&quot;&gt;ç›®æŒ‡ã™ã¹ãã‚´ãƒ¼ãƒ«&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#rails-way&quot; id=&quot;markdown-toc-rails-way&quot;&gt;Rails Way&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#concerns&quot; id=&quot;markdown-toc-concerns&quot;&gt;Concerns&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#sti&quot; id=&quot;markdown-toc-sti&quot;&gt;STI&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#polymorphic-association&quot; id=&quot;markdown-toc-polymorphic-association&quot;&gt;Polymorphic Association&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#accepts_nested_attributes_for&quot; id=&quot;markdown-toc-accepts_nested_attributes_for&quot;&gt;accepts_nested_attributes_for&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ãã®ä»–ç´°ã‹ã‚ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯&quot; id=&quot;markdown-toc-ãã®ä»–ç´°ã‹ã‚ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯&quot;&gt;ãã®ä»–ç´°ã‹ã‚ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#rails-wayã¾ã¨ã‚&quot; id=&quot;markdown-toc-rails-wayã¾ã¨ã‚&quot;&gt;ã€ŒRails Wayã€ã¾ã¨ã‚&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#sub-rails-way&quot; id=&quot;markdown-toc-sub-rails-way&quot;&gt;Sub-Rails Way&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#view-model&quot; id=&quot;markdown-toc-view-model&quot;&gt;View Model&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#æ¨©é™ç®¡ç†èªå¯&quot; id=&quot;markdown-toc-æ¨©é™ç®¡ç†èªå¯&quot;&gt;æ¨©é™ç®¡ç†ãƒ»èªå¯&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#interactor&quot; id=&quot;markdown-toc-interactor&quot;&gt;Interactor&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ç‰¹å®šã®èª²é¡Œã®è§£æ±º&quot; id=&quot;markdown-toc-ç‰¹å®šã®èª²é¡Œã®è§£æ±º&quot;&gt;ç‰¹å®šã®èª²é¡Œã®è§£æ±º&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ãã‚Œrailsã§ã§ãã‚‹ã‚ˆ&quot; id=&quot;markdown-toc-ãã‚Œrailsã§ã§ãã‚‹ã‚ˆ&quot;&gt;ã€Œãã‚ŒRailsã§ã§ãã‚‹ã‚ˆã€&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ãã‚Œrubyã§ã§ãã‚‹ã‚ˆ&quot; id=&quot;markdown-toc-ãã‚Œrubyã§ã§ãã‚‹ã‚ˆ&quot;&gt;ã€Œãã‚ŒRubyã§ã§ãã‚‹ã‚ˆã€&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#saasã«åˆ‡ã‚Šå‡ºã™&quot; id=&quot;markdown-toc-saasã«åˆ‡ã‚Šå‡ºã™&quot;&gt;SaaSã«åˆ‡ã‚Šå‡ºã™&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#sub-rails-wayã¾ã¨ã‚&quot; id=&quot;markdown-toc-sub-rails-wayã¾ã¨ã‚&quot;&gt;ã€ŒSub-Rails Wayã€ã¾ã¨ã‚&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#non-rails-way&quot; id=&quot;markdown-toc-non-rails-way&quot;&gt;Non-Rails Way&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#form-model&quot; id=&quot;markdown-toc-form-model&quot;&gt;Form Model&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#poro&quot; id=&quot;markdown-toc-poro&quot;&gt;PORO&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#service-class&quot; id=&quot;markdown-toc-service-class&quot;&gt;Service Class&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#1-table-multiple-models&quot; id=&quot;markdown-toc-1-table-multiple-models&quot;&gt;1 Table Multiple Models&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#non-rails-wayã¾ã¨ã‚&quot; id=&quot;markdown-toc-non-rails-wayã¾ã¨ã‚&quot;&gt;ã€ŒNon-Rails Wayã€ã¾ã¨ã‚&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#å…¨ä½“ã®ã¾ã¨ã‚&quot; id=&quot;markdown-toc-å…¨ä½“ã®ã¾ã¨ã‚&quot;&gt;å…¨ä½“ã®ã¾ã¨ã‚&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#å‚è€ƒè³‡æ–™&quot; id=&quot;markdown-toc-å‚è€ƒè³‡æ–™&quot;&gt;å‚è€ƒè³‡æ–™&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#å¾Œç·¨è³ªå•æ„Ÿæƒ³ç·¨&quot; id=&quot;markdown-toc-å¾Œç·¨è³ªå•æ„Ÿæƒ³ç·¨&quot;&gt;å¾Œç·¨ï¼ˆè³ªå•ãƒ»æ„Ÿæƒ³ç·¨ï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;fat-rails-stage&quot;&gt;Fat Rails Stage&lt;/h2&gt;

&lt;p&gt;è‚¥å¤§åŒ–ã—ãŸRailsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆFat Rails Applicationï¼‰ã«ãŠã„ã¦æœ€ã‚‚è¾›ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã©ã“ã§ã—ã‚‡ã†ã‹ï¼Ÿ&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Fat View&lt;/li&gt;
  &lt;li&gt;Fat Controller&lt;/li&gt;
  &lt;li&gt;Fat Model&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åƒ•ã¯Fat Modelã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹è¨˜ã¯ã€ŒRailsãŒã©ã®ã‚ˆã†ã«Fatã«ãªã£ã¦ã„ãã‹ã€æ®µéšã‚’ç¤ºã—ãŸè¡¨ã§ã™ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Fat Stage&lt;/th&gt;
      &lt;th&gt;Railsç¿’ç†Ÿåº¦&lt;/th&gt;
      &lt;th&gt;Fat Layer&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;ä½&lt;/td&gt;
      &lt;td&gt;Fat View&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;ä¸­&lt;/td&gt;
      &lt;td&gt;Fat Controller&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;é«˜&lt;/td&gt;
      &lt;td&gt;Fat Model&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ã¾ãšã¯Fatã‚¹ãƒ†ãƒ¼ã‚¸1ã€‚Railsã¨ã„ã†ã‚‚ã®ã‚’å…¨ç„¶çŸ¥ã‚‰ãªã„è¶…åˆå¿ƒè€…ãŒé™¥ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã™ã€‚ãƒ“ãƒ¥ãƒ¼ã«ä½•ã§ã‚‚ã‹ã‚“ã§ã‚‚ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ã„ã¡ã‚ƒã†ã€‚ãã®çµæœãŒFat Viewã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;æ¬¡ã«Fatã‚¹ãƒ†ãƒ¼ã‚¸2ã€‚ã‚ã‚‹ç¨‹åº¦Railsã«æ…£ã‚Œã¦ããŸé–‹ç™ºè€…ãŒé™¥ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã™ã€‚Modelã¸ã®ãƒ­ã‚¸ãƒƒã‚¯åˆ†é›¢ãŒã†ã¾ãã§ããšã€Controllerã«ãƒ­ã‚¸ãƒƒã‚¯ãŒé›†ä¸­ã™ã‚‹ã€‚ãã®çµæœã¯Fat Controllerã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;æœ€å¾ŒãŒFatã‚¹ãƒ†ãƒ¼ã‚¸3ã€‚Railsã‚’ç¿’ç†Ÿã—ãŸã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã‚ã‚Œã°Modelã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¯„ã›ã¦ã„ãã®ãŒå®šçŸ³ã§ã™ã€‚ãã®çµæœå‡ºæ¥ä¸ŠãŒã‚‹ã®ã¯Fat Modelã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã“ã®ã‚ˆã†ã« &lt;strong&gt;ã©ã‚“ãªã«Railsã«ç¿’ç†Ÿã—ã¦ã‚ˆã†ã¨æœ€çµ‚çš„ã«ã¶ã¤ã‹ã‚‹å£ãŒFat Model&lt;/strong&gt; ã§ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;fat-modelå¯¾å‡¦ã®ãŸã‚ã®ï¼“ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ&quot;&gt;Fat Modelå¯¾å‡¦ã®ãŸã‚ã®ï¼“ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ&lt;/h2&gt;

&lt;p&gt;Fat Modelã‚’å€’ã™ãŸã‚ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ã—ã¦ã€åƒ•ã¯ä¸‹è¨˜ã®3ã¤ã«åˆ†ã‘ã¦æ•´ç†ã™ã‚Œã°è‰¯ã„ã®ã§ã¯ã¨è€ƒãˆã¾ã—ãŸã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Rails Way&lt;/li&gt;
  &lt;li&gt;Sub-Rails Way&lt;/li&gt;
  &lt;li&gt;Non-Rails Way&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;rails-modelã®é™ç•Œ&quot;&gt;Rails Modelã®é™ç•Œ&lt;/h2&gt;

&lt;p&gt;ãªãœRailsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®Modelå±¤ã¯é™ç•Œã‚’è¿ãˆã¦ã—ã¾ã†ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ&lt;/p&gt;

&lt;p&gt;Railsã®åŸå§‹çš„ãªçŠ¶æ…‹ã¯ã€1ã¤ã®Modelã«1ã¤ã®ControllerãŒçµã³ã¤ã„ã¦ã„ã¾ã™ã€‚ã™ãªã‚ã¡ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User&lt;/code&gt;ãƒ¢ãƒ‡ãƒ«ãŒã‚ã‚Œã°&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;UsersController&lt;/code&gt;ãŒã‚ã‚Šã€Controllerã®ãã‚Œãã‚Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User&lt;/code&gt;ãƒ¢ãƒ‡ãƒ«ãŒç´ã¥ãã¨ã„ã†å½¢ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã—ã‹ã—ä¸‹å›³&lt;sup id=&quot;fnref:a&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:a&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;ã¯ãã‚ŒãŒç ´ç¶»ã—ãŸçŠ¶æ…‹ã§ã™ã€‚ã©ã†ãªã£ã¦ã„ã‚‹ã‹ã¨ã„ã†ã¨ã€è¤‡æ•°ã®Controllerã‹ã‚‰ã„ã‚ã‚“ãªã‹ãŸã¡ã§ï¼‘ã¤ã®ãƒ¢ãƒ‡ãƒ«ãŒè§¦ã‚‰ã‚Œã‚‹ã€ãã†ã„ã†çŠ¶æ…‹ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/controllers-model.jpg&quot; alt=&quot;inline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç¶šã„ã¦ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã§ã™&lt;sup id=&quot;fnref:b&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:b&quot; class=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://speakerd.s3.amazonaws.com/presentations/ce30c3cf9433471283e24855f6bdd2b4/slide_42.jpg?12161035&quot; alt=&quot;inline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ã“ã“ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ã¯ &lt;strong&gt;ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹&lt;/strong&gt;ã€‚ã„ã‚ã‚“ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’1ã¤ã®Modelã§è¡¨ç¾ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã¨ã„ã†çŠ¶æ³ãŒè¾›ã„ã¨è¨€ãˆã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;rails-modelã¯ãªãœè¾›ããªã‚‹ã®ã‹&quot;&gt;Rails Modelã¯ãªãœè¾›ããªã‚‹ã®ã‹ï¼Ÿ&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;1ã¤ã®ModelãŒè¤‡æ•°ã®ç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¯†çµåˆã—ã¦å®Ÿè£…ã•ã‚Œã‚‹ã¨ã
    &lt;ul&gt;
      &lt;li&gt;â†’ ã‚ã‚‹æ¡ä»¶ã‚„contextã«ç´ä»˜ã„ãŸValidation/Callbackå‡¦ç†&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;1ã¤ã®ãƒ•ã‚©ãƒ¼ãƒ ã§è¤‡æ•°ã®ã‚µãƒ–ãƒªã‚½ãƒ¼ã‚¹ãŒæ›´æ–°ã•ã‚Œã‚‹ã¨ãï¼ˆãƒ•ã‚©ãƒ¼ãƒ ã¨ModelãŒ1å¯¾1ã§ç´ä»˜ã‹ãªã„ã¨ãï¼‰
    &lt;ul&gt;
      &lt;li&gt;â†’ 1ã¤ã®Modelã‚’èµ·ç‚¹ã¨ã—ãŸè¤‡æ•°Modelã‚’è·¨ããƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸Šè¿°ã®é™ç•Œã¯ã€Rails Modelã¨DBã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä¸€å¯¾ä¸€ã§ç´ã¥ãRailsã®ä¸–ç•Œè¦³ã«èµ·å› ã™ã‚‹é™ç•Œã¨è¨€ãˆã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç›®æŒ‡ã™ã¹ãã‚´ãƒ¼ãƒ«&quot;&gt;ç›®æŒ‡ã™ã¹ãã‚´ãƒ¼ãƒ«&lt;/h2&gt;

&lt;p&gt;ã§ã¯ã©ã†Railsã®é™ç•Œã‚’ä¹—ã‚Šè¶Šãˆã¦ã„ã‘ã°ã„ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ&lt;/p&gt;

&lt;p&gt;ä¸‹è¨˜ã¯æ¨ªè»¸ãŒã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ã‚µã‚¤ã‚ºã€ç¸¦è»¸ãŒãƒšã‚¤ãƒ³ï¼ˆç—›ã¿ã®åº¦åˆã„ï¼‰ã‚’æã„ãŸã‚°ãƒ©ãƒ•ã§ã™&lt;sup id=&quot;fnref:c&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:c&quot; class=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/growth.png&quot; alt=&quot;inline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;èµ¤ç·šã¯ãƒãƒ‹ãƒ©Railsã§ã™ã€‚ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ã‚µã‚¤ã‚ºã¨ã¨ã‚‚ã«ãƒšã‚¤ãƒ³ãŒå¢—å¤§ã—ã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ç·‘ç·šã¯ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãƒ¼ãƒ‰Railsã€‚ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãŒå¢—å¤§ã—ã¦ã‚‚ãƒšã‚¤ãƒ³ãŒå¢—å¤§ã—ã¾ã›ã‚“ã€‚&lt;/p&gt;

&lt;p&gt;åƒ•ã®ç™ºè¡¨ã®è¨€ã†ã¨ã“ã‚ã§ã¯ã€èµ¤ç·šï¼ˆãƒãƒ‹ãƒ©Railsï¼‰ãŒRails Wayã€ç·‘ç·šï¼ˆã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãƒ¼ãƒ‰Railsï¼‰ãŒSub-Railsãƒ»Non-Rails Wayã«ã‚ãŸã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/growth2.png&quot; alt=&quot;inline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ã¨ã„ã†ã“ã¨ã§æˆ‘ã€…ã®åŸºæœ¬çš„ãªã‚´ãƒ¼ãƒ«ã¨ã—ã¦ã¯ã“ã®ç·‘ç·šã€ã™ãªã‚ã¡ã€ &lt;strong&gt;ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ãŒå¤§ãããªã£ã¦ã‚‚ãƒšã‚¤ãƒ³ãŒå¢—å¤§ã—ãªã„Railsã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹&lt;/strong&gt; ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;rails-way&quot;&gt;Rails Way&lt;/h2&gt;

&lt;p&gt;å°å­¦ç”Ÿã®çµµã¿ãŸã„ã§æç¸®ãªã‚“ã§ã™ãŒã€Rails Wayã‚’çµµã«ã™ã‚‹ã¨ã“ã‚“ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/rails-way.png&quot; alt=&quot;fit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ã¤ã¾ã‚Š &lt;strong&gt;Railsã®ãƒ¬ãƒ¼ãƒ«ã«æ²¿ã£ãŸé–‹ç™ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ&lt;/strong&gt; ã§ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;concerns&quot;&gt;Concerns&lt;/h3&gt;

&lt;p&gt;ã¾ãšã¯Concernsã€‚Model/Controllerã®å…±é€šã®é–¢å¿ƒäº‹ï¼ˆConcernï¼‰ã‚’moduleã«åˆ‡ã‚Šå‡ºã™æ‰‹æ³•ã§ã™ï¼ˆä»£è¡¨ä¾‹: DHHâ€™s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Recording&lt;/code&gt; Class&lt;sup id=&quot;fnref:6&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:6&quot; class=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/concerns.png&quot; alt=&quot;inline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ³¨æ„ã™ã¹ãã¯ã€Concernã®Railså…¬å¼ã‚¬ã‚¤ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å¼·ã„ã¦è¨€ã†ãªã‚‰ä¸‹è¨˜ã®è¨˜äº‹ã§DHHãŒConcernã‚’ç´¹ä»‹ã—ã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://signalvnoise.com/posts/3372-put-chubby-models-on-a-diet-with-concerns&quot;&gt;Put chubby models on a diet with concerns&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Modelã®æŒã£ã¦ã„ã‚‹èƒ½åŠ›ï¼ˆability = &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-able&lt;/code&gt; suffixï¼‰ã«ç€ç›®ã—ã¦Concern moduleã«åˆ‡ã‚Šå‡ºã—ã¦ã„ãã®ãŒã€Rails Wayã£ã½ã•ãŒã‚ã‚‹ã¨è¨€ãˆã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/models/concerns/concernable.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Concernable&lt;/span&gt;
  &lt;span class=&quot;kp&quot;&gt;extend&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Concern&lt;/span&gt;

  &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;your&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;concern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;sti&quot;&gt;STI&lt;/h3&gt;

&lt;p&gt;Railsã«ãŠã„ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã¨Modelã¯åŸå‰‡çš„ã«1å¯¾1ã§çµã³ã¤ãã¾ã™ã€‚ã—ã‹ã—ã€STIã‚’ä½¿ãˆã°1ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§è¤‡æ•°Modelç´ä»˜ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›³ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;players&lt;/code&gt;ã¨ã„ã†å˜ä¸€ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¤‡æ•°ã®ã‚¯ãƒ©ã‚¹ãŒçµã³ã¤ã„ã¦ã„ã‚‹å›³ã§ã™&lt;sup id=&quot;fnref:5&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:5&quot; class=&quot;footnote&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/sti.png&quot; alt=&quot;inline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Railsã®ã‚³ãƒ¼ãƒ‰ä¾‹ã§ã™ã€‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;companies&lt;/code&gt; ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç´ã¥ã &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Firm&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Client&lt;/code&gt;ãƒ¢ãƒ‡ãƒ«ã®ä¾‹ã ã¨ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/models/company.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Company&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# app/models/firm.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Firm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Company&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# app/models/client.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Client&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Company&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;polymorphic-association&quot;&gt;Polymorphic Association&lt;/h3&gt;

&lt;p&gt;1ã¤ã®ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯é–¢é€£ä»˜ã‘å®šç¾©ã§è¤‡æ•°ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å¾“å±ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ãŒãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯é–¢é€£ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/polymorphic.png&quot; alt=&quot;inline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šå›³ã®å ´åˆã€é€šå¸¸ã®Rails DBè¨­è¨ˆã§ã‚ã‚Œã° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pictures&lt;/code&gt;ãƒ†ãƒ¼ãƒ–ãƒ«ãŒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;employee_id&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;product_id&lt;/code&gt;ã‚’æŒã£ã¦ã„ã‚‹ã¹ãã§ã™ãŒã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;imagable_id&lt;/code&gt;ã¨ã„ã†1ã¤ã‚«ãƒ©ãƒ ã§è¤‡æ•°ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å¾“å±ã•ã›ã‚‹ã“ã¨ãŒã§ãã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã“ã‚Œã‚’Railsã®ã‚³ãƒ¼ãƒ‰ã§ã‚ã‚‰ã‚ã™ã¨ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/models/picture.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Picture&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:imageable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;polymorphic: &lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# app/models/employee.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Employee&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:pictures&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;as: :imageable&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# app/models/product.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Product&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:pictures&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;as: :imageable&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ãŸã ã—æ³¨æ„ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯é–¢é€£ã¯ã€SQLã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€6ç« ã§ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦ç´¹ä»‹ã•ã‚Œã¦ãŠã‚Šã€ä½¿ç”¨ã™ã‚‹éš›ã¯æ°—ã‚’ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;è©³ã—ãã¯ã€SQLã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã‚’èª­ã‚“ã§ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;accepts_nested_attributes_for&quot;&gt;accepts_nested_attributes_for&lt;/h3&gt;

&lt;p&gt;ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã§é–¢é€£ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ã‚’è¡Œã†ã®ãŒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;accepts_nested_attributes_for&lt;/code&gt;ã§ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Member&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;accepts_nested_attributes_for&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;member: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;name: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'joe'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;posts_attributes: &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;title: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Kari, the awesome Ruby documentation browser!'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;title: &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'The egalitarian assumption of the modern citizen'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Member&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:member&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ãŸã ã—ã“ã®&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;accepts_nested_attributes_for&lt;/code&gt;ã¯DHHè‡ªã‚‰ãŒã€Œæ¶ˆã—ãŸã„ã€ã¨ç™ºè¨€ã—ã¦ãŠã‚Š&lt;sup id=&quot;fnref:7&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:7&quot; class=&quot;footnote&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;ã€ç©æ¥µçš„ã«ä½¿ã†ã®ã¯ã‚„ã‚„èºŠèº‡ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/dhh.png&quot; alt=&quot;inline&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;ãã®ä»–ç´°ã‹ã‚ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯&quot;&gt;ãã®ä»–ç´°ã‹ã‚ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Serialize Attribute&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;jsonå‹ã‚«ãƒ©ãƒ ã¸ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã«ä¾¿åˆ©&lt;/li&gt;
      &lt;li&gt;âš ï¸ã€SQLã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€5ç«  EAV&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Value Object&lt;/strong&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compose_of&lt;/code&gt;)
    &lt;ul&gt;
      &lt;li&gt;è¤‡æ•°ã‚«ãƒ©ãƒ ã‚’Valueã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦å±•é–‹ã™ã‚‹ã¨ãã«ä¾¿åˆ©&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Validation Class&lt;/strong&gt;/&lt;strong&gt;Callback Class&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;ã‚¯ãƒ©ã‚¹ã¨ã—ã¦åˆ†é›¢å¯èƒ½ â†’ åˆ†é›¢ã™ã‚‹ã“ã¨ã§è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã§å†åˆ©ç”¨å¯èƒ½ã«&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;rails-wayã¾ã¨ã‚&quot;&gt;ã€ŒRails Wayã€ã¾ã¨ã‚&lt;/h3&gt;

&lt;p&gt;å…¨ä½“ã¨ã—ã¦ã¯ã€Rails Wayã ã‘ã§ã¯Fat Modelã‚’å€’ã™æ‰‹æ®µã¨ã—ã¦æ‰‹æ•°ãŒå°‘ãªãç‰©è¶³ã‚Šãªã„ã¨æ„Ÿã˜ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚ºãŒFatã«ãªã£ã¦ã„ã‚‹æ™‚ç‚¹ã§ãã®Railsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä¸­è¦æ¨¡ä»¥ä¸Šã®ã‚µã‚¤ã‚ºãŒè¦‹è¾¼ã¾ã‚Œã¾ã™ã‹ã‚‰ã€æ­£ç›´Rails Wayã ã‘ã§Fat Modelã‚’å€’ã™ã®ã¯ç„¡ç†ã ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;âŒ Concerns, Validation Classãªã©Fat Modelã‚’DRYã«è¨˜è¿°ã™ã‚‹æ‰‹æ®µã«ã¯ãªã‚‹ãŒã€æ§‹é€ çš„ã«ãƒ€ã‚¤ã‚¨ãƒƒãƒˆã™ã‚‹æ‰‹æ®µã«ã¯ãªã£ã¦ã„ã¾ã›ã‚“ã€‚ã‚ãã¾ã§ãã‚Œã‚‰ã¯å±€æ‰€çš„ãªãƒ€ã‚¤ã‚¨ãƒƒãƒˆã«ç•™ã¾ã£ã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;âŒ STI, Polymorphicãªã©ã¯DBè¨­è¨ˆã¨å¯†çµåˆã—ãŸã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€å®Œå…¨ãªã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®è§£æ±ºã«ã¯ãªã£ã¦ã„ã¾ã›ã‚“ã€‚ã¾ãŸã€ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€ãã‚Œè‡ªä½“ãŒæŠ€è¡“è² å‚µã«ãªã‚Šãˆã‚‹æ§‹é€ çš„å•é¡Œã‚’å­•ã‚“ã§ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;sub-rails-way&quot;&gt;Sub-Rails Way&lt;/h2&gt;

&lt;p&gt;Sub-Rails Wayã¯ãƒ¬ãƒ¼ãƒ«ã‚’è£œå¼·ãƒ»æ‹¡å¼µã—ã¤ã¤ãƒ¬ãƒ¼ãƒ«ã«ä¹—ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/sub-rails-way.png&quot; alt=&quot;fit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ãƒ¬ãƒ¼ãƒ«ã‚’ä½•ã‚’ä½¿ã£ã¦è£œå¼·ãƒ»æ‹¡å¼µã™ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿãã‚Œã¯ä¸‹è¨˜ï¼’ã¤ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;gem&lt;/li&gt;
  &lt;li&gt;SaaS&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;view-model&quot;&gt;View Model&lt;/h3&gt;

&lt;p&gt;Modelã«ãŠã‘ã‚‹Viewé–¢é€£ãƒ­ã‚¸ãƒƒã‚¯ã‚’ &lt;strong&gt;View Model&lt;/strong&gt; ã¨ã—ã¦åˆ‡ã‚Šå‡ºã™æ‰‹æ³•ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;Development of Further PoEAAã§&lt;a href=&quot;https://martinfowler.com/eaaDev/PresentationModel.html&quot;&gt;Presentation Model&lt;/a&gt;ã¨ã„ã†æ¦‚å¿µã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ãŸã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚Modelã‚’Decoratorãƒ‘ã‚¿ãƒ¼ãƒ³ã£ã½ãæ‹¡å¼µã—ã¦ã„ã‚‹ã®ã§Decoratorã¨ã‚‚å‘¼ã°ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã§ã™&lt;sup id=&quot;fnref:8&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:8&quot; class=&quot;footnote&quot;&gt;8&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ã“ã®View Modelã®è‰¯ã„ã¨ã“ã‚ã¨ã—ã¦ã¯ã€Fat Model ã®å¯¾å‡¦ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ã ã‘ã§ãªãã€Fat View ã®å¯¾å‡¦ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã™ã‚‹ç‚¹ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ğŸ’ gemã®å®Ÿè£…ã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/drapergem/draper&quot;&gt;draper&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/amatsuda/active_decorator&quot;&gt;active_decorator&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ğŸ”§ draperã®å ´åˆã€ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆArticleãƒ¢ãƒ‡ãƒ«ã®Decoratorã‚¯ãƒ©ã‚¹ï¼‰ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/decorators/article_decorator.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ArticleDecorator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Draper&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Decorator&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;delegate_all&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;publication_status&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;published?&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;Published at &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;published_at&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;Unpublished&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;published_at&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;published_at&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;strftime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;%A, %B %e&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æ¨©é™ç®¡ç†èªå¯&quot;&gt;æ¨©é™ç®¡ç†ãƒ»èªå¯&lt;/h3&gt;

&lt;p&gt;ç®¡ç†ç”»é¢å®Ÿè£…ã«ãŠã„ã¦é€ƒã’ã‚‰ã‚Œãªã„å®Ÿè£…ã¯èªè¨¼ã¨ã‚ã‚ã›ã¦ã€æ¨©é™ç®¡ç†ãƒ»èªå¯ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ&lt;/p&gt;

&lt;p&gt;Resourceã®CRUDã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã™ã‚‹ã®ãŒã€ŒRailsã‚‰ã—ã„ã€æ¨©é™ç®¡ç†ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ğŸ’ gemã®å®Ÿè£…ã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/varvet/pundit&quot;&gt;pundit&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/kyuden/banken&quot;&gt;banken&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/CanCanCommunity/cancancan&quot;&gt;cancancan&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ğŸ”§ punditã®å ´åˆã€ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ï¼ˆPostãƒ¢ãƒ‡ãƒ«ã®èªå¯ã‚¯ãƒ©ã‚¹ï¼‰ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/policies/post_policy.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PostPolicy&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;attr_reader&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:post&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@post&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;update?&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;admin?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;published?&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;interactor&quot;&gt;Interactor&lt;/h3&gt;

&lt;p&gt;Interactorã¯Clean Architectureç”±æ¥ã™ã‚‹æ¦‚å¿µã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹è¨˜ã®å›³ã¯è¦‹ãŸã“ã¨ã‚ã‚‹æ–¹ã‚‚å¤šãã„ã‚‰ã£ã—ã‚ƒã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚èµ¤ã„éƒ¨åˆ†ãŒClean Architectureã«ãŠã‘ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã«ãªã‚Šã¾ã™ã€‚ã“ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã« Interactor ãŒè¡¨ç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg&quot; alt=&quot;inline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã¨ã„ã†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã¨ã¦ã‚‚è‰¯ã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ãªãœãªã‚‰å…ˆç¨‹ã€Œ1ã¤ã®ModelãŒè¤‡æ•°ã®ç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«å¯†çµåˆã—ã¦å®Ÿè£…ã•ã‚Œã‚‹ã¨ãâ€•ã€ã¨è¨€ã„ã¾ã—ãŸãŒã€ãã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’ã¾ã•ã«Interactorã¨ã—ã¦è¡¨ç¾ã§ãã‚‹ã‹ã‚‰ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;å€‹äººçš„ã«Clean Architectureã¨Railsã¯ç›¸æ€§ãŒè‰¯ã„ã¨æ€ã£ã¦ã„ã¦ã€ã“ã®ã‚ˆã†ã«MVC+Interactorã§Clean Architectureã®ãã‚Œãã‚Œã®å±¤ã¨ä¸€è‡´ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‰ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/Clean_Coder_Blog.png&quot; alt=&quot;inline&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ğŸ’ gemã¨ã—ã¦ã¯ä¸‹è¨˜ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/collectiveidea/interactor-rails&quot;&gt;interactor-rails&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;(not Rails) &lt;a href=&quot;https://github.com/hanami&quot;&gt;hanami&lt;/a&gt;â€™s &lt;a href=&quot;https://github.com/hanami/utils/blob/master/lib/hanami/interactor.rb&quot;&gt;Interactor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;hanamiã¯Railsã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€Clean Architectureã«å¼·ãå½±éŸ¿ã‚’å—ã‘ãŸRubyè£½Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚hanamiã«ã¯ Interactor ã®ä»•çµ„ã¿ãŒæ¨™æº–ã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ğŸ”§ interactor-railsã®å ´åˆã®ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’èªè¨¼ã™ã‚‹ã‚¯ãƒ©ã‚¹ï¼‰ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# app/interactors/authenticate_user.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AuthenticateUser&lt;/span&gt;
  &lt;span class=&quot;kp&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Interactor&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;authenticate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;secret_token&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fail!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;message: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;authenticate_user.failure&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# Inside your controller,&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;AuthenticateUser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;session_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ç‰¹å®šã®èª²é¡Œã®è§£æ±º&quot;&gt;ç‰¹å®šã®èª²é¡Œã®è§£æ±º&lt;/h3&gt;

&lt;p&gt;ç‰¹å®šã®èª²é¡Œã‚’è§£æ±ºã™ã‚‹gemã¨ã—ã¦ã¯ä¾‹ãˆã°ä¸‹è¨˜ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;è«–ç†å‰Šé™¤&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;ğŸ’ gem: &lt;a href=&quot;https://github.com/jhawthorn/discard&quot;&gt;discard&lt;/a&gt;, &lt;a href=&quot;https://github.com/rubysherpas/paranoia&quot;&gt;paranoia&lt;/a&gt;, &lt;a href=&quot;https://github.com/ActsAsParanoid/acts_as_paranoid&quot;&gt;acts_as_paranoid&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;âš ï¸ &lt;a href=&quot;https://www.slideshare.net/t_wada/ronsakucasual&quot;&gt;SQLã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ å¹»ã®ç¬¬26ç« ã€Œã¨ã‚Šã‚ãˆãšå‰Šé™¤ãƒ•ãƒ©ã‚°ã€&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;è¦ç´ ã®ã‚½ãƒ¼ãƒˆãƒ»ä¸¦ã³æ›¿ãˆ&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;ğŸ’ gem: &lt;a href=&quot;https://github.com/brendon/acts_as_list&quot;&gt;acts_as_list&lt;/a&gt;, &lt;a href=&quot;https://github.com/mixonic/ranked-model&quot;&gt;ranked-model&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;State Machine&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;ğŸ’ gem: &lt;a href=&quot;https://github.com/aasm/aasm&quot;&gt;aasm&lt;/a&gt;, &lt;a href=&quot;https://github.com/amatsuda/stateful_enum&quot;&gt;stateful_enum&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Tagging&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;ğŸ’ gem: &lt;a href=&quot;https://github.com/mbleigh/acts-as-taggable-on&quot;&gt;acts-as-taggable-on&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Hashã‚’ActiveRecordã£ã½ãæ“ä½œ&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;ğŸ’ gem: &lt;a href=&quot;https://github.com/zilkey/active_hash&quot;&gt;active_hash&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è§£æ±ºã—ãŸã„èª²é¡Œã«å¿œã˜ã¦å°å…¥ã—ã¦ã„ãã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ãã‚Œrailsã§ã§ãã‚‹ã‚ˆ&quot;&gt;ã€Œãã‚ŒRailsã§ã§ãã‚‹ã‚ˆã€&lt;sup id=&quot;fnref:10&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:10&quot; class=&quot;footnote&quot;&gt;9&lt;/a&gt;&lt;/sup&gt;&lt;/h3&gt;

&lt;p&gt;é€†ã«gemã‚’ä½¿ã‚ãšã¨ã‚‚Railsæ¨™æº–ã§è§£æ±ºã§ãã‚‹ã‚ˆã£ã¦èª²é¡Œã‚‚å¤šãå­˜åœ¨ã—ã¾ã™ã€‚ä¾‹ãˆã°ä¸‹è¨˜ã®ã‚ˆã†ãªä¾‹ã§ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;:gem: &lt;a href=&quot;https://github.com/brainspec/enumerize&quot;&gt;enumerize&lt;/a&gt; (Emumerized Attributes)
    &lt;ul&gt;
      &lt;li&gt;Rails 4.1: ActiveRecord enum&lt;/li&gt;
      &lt;li&gt;å‚è€ƒ. &lt;a href=&quot;https://api.rubyonrails.org/v5.2.3/classes/ActiveRecord/Enum.html&quot;&gt;ActiveRecord::Enum&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;:gem: &lt;a href=&quot;https://github.com/eagletmt/switch_point&quot;&gt;switch_point&lt;/a&gt; (Database R/W Split)
    &lt;ul&gt;
      &lt;li&gt;Rails 6: Multi-DB&lt;/li&gt;
      &lt;li&gt;å‚è€ƒ: &lt;a href=&quot;https://railsguides.jp/active_record_multiple_databases.html&quot;&gt;Active Record ã§è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ©ç”¨ - Railsã‚¬ã‚¤ãƒ‰&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;:gem: &lt;a href=&quot;https://github.com/zdennis/activerecord-import&quot;&gt;activerecord-import&lt;/a&gt; (Bulk Import)
    &lt;ul&gt;
      &lt;li&gt;Rails 6: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;insert_all&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;upsert_all&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;:gem: &lt;a href=&quot;https://github.com/carrierwaveuploader/carrierwave&quot;&gt;carrierwave&lt;/a&gt;, &lt;a href=&quot;https://github.com/shrinerb/shrine&quot;&gt;shrine&lt;/a&gt; (File Uploader)
    &lt;ul&gt;
      &lt;li&gt;Rails 5.2: Active Storage&lt;/li&gt;
      &lt;li&gt;å‚è€ƒ: &lt;a href=&quot;https://railsguides.jp/active_storage_overview.html&quot;&gt;Active Storage ã®æ¦‚è¦ - Railsã‚¬ã‚¤ãƒ‰&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;:gem: &lt;a href=&quot;https://github.com/norman/friendly_id&quot;&gt;friendly_id&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;ActiveRecord: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;to_param&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;å‚è€ƒ: &lt;a href=&quot;https://api.rubyonrails.org/classes/ActiveRecord/Integration.html#method-i-to_param&quot;&gt;ActiveRecord::Integration&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;:gem: &lt;a href=&quot;https://github.com/magnusvk/counter_culture&quot;&gt;counter_culture&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;ActiveRecord: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;counter_cache&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;å‚è€ƒ: &lt;a href=&quot;https://railsguides.jp/association_basics.html#belongs-to%E3%81%AE%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-counter-cache&quot;&gt;Active Record ã®é–¢é€£ä»˜ã‘&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ID/Passwordèªè¨¼
    &lt;ul&gt;
      &lt;li&gt;ActiveModel: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_secure_password&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;å‚è€ƒ: &lt;a href=&quot;https://api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html&quot;&gt;ActiveModel::SecurePassword::ClassMethods&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;:gem: &lt;a href=&quot;https://github.com/rubyconfig/config&quot;&gt;config&lt;/a&gt; (YAML Config Management)
    &lt;ul&gt;
      &lt;li&gt;Rails Custom configuration:&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Rails::Application.config_for&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config.x&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;å‚è€ƒ: &lt;a href=&quot;https://railsguides.jp/configuring.html#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E8%A8%AD%E5%AE%9A&quot;&gt;Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ - Railsã‚¬ã‚¤ãƒ‰&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ãã‚Œrubyã§ã§ãã‚‹ã‚ˆ&quot;&gt;ã€Œãã‚ŒRubyã§ã§ãã‚‹ã‚ˆã€&lt;sup id=&quot;fnref:10:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:10&quot; class=&quot;footnote&quot;&gt;9&lt;/a&gt;&lt;/sup&gt;&lt;/h3&gt;

&lt;p&gt;gemã‚’ä½¿ã‚ãšã¨ã‚‚Rubyã§ã‚‚ã§ãã‚‹ã‚ˆã£ã¦ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;:gem: &lt;a href=&quot;https://github.com/pry/pry&quot;&gt;pry&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;Ruby 2.4: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;binding.irb&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;Ruby 2.7: REPL Syntax Highlighting&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;saasã«åˆ‡ã‚Šå‡ºã™&quot;&gt;SaaSã«åˆ‡ã‚Šå‡ºã™&lt;/h3&gt;

&lt;p&gt;å‡¦ç†ã‚’SaaSã«åˆ‡ã‚Šå‡ºã™ã€ã¨ã„ã†æ„å‘³ã§ã¯ä¸‹è¨˜ã®ä¾‹ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://auth0.com/jp/&quot;&gt;Auth0&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’Auth0ã«ç§»è­²&lt;/li&gt;
      &lt;li&gt;èªè¨¼ã«ã¨ã‚‚ãªã†MFAã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ãªã©ã®é¢å€’ãªå®Ÿè£…ã‚’Auth0ãŒè‚©ä»£ã‚ã‚Š&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://sentry.io/welcome/&quot;&gt;Sentry&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚’Sentryã«ç§»è­²&lt;/li&gt;
      &lt;li&gt;ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¨ãƒ©ãƒ¼ã‚’ã½ã‚“ã½ã‚“æŠ•ã’è¾¼ã‚ã°ã„ã„æ„Ÿã˜ã«ã‚¨ãƒ©ãƒ¼ã‚’ã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»å¯è¦–åŒ–ãƒ»å„ç¨®é€šçŸ¥ã—ã¦ãã‚Œã‚‹&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://newrelic.co.jp/&quot;&gt;NewRelic&lt;/a&gt;/&lt;a href=&quot;https://www.datadoghq.com/ja/&quot;&gt;Datadog&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;APM (Application Performance Monitoring)ã‚’ NewRelic/Datadog APMã§ã‚„ã‚‹&lt;/li&gt;
      &lt;li&gt;è‡ªå‰ã§ Elasticsearch + Kibana ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã‚‚ã„ã„ãŒã€æ§‹ç¯‰ã‚³ã‚¹ãƒˆãƒ»é‹ç”¨ã‚³ã‚¹ãƒˆã¨ã‚‚ã«é«˜ãã¤ã&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;sub-rails-wayã¾ã¨ã‚&quot;&gt;ã€ŒSub-Rails Wayã€ã¾ã¨ã‚&lt;/h3&gt;

&lt;p&gt;gem ã‚’ä½¿ã†ã“ã¨ã§Fat Modelå¯¾å‡¦æ³•ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãŒãã£ã¨åºƒãŒã‚Šã¾ã™ã€‚ç‹¬è‡ªå®Ÿè£…ã§Modelã‚’å¤ªã‚‰ã›ã‚‹ã“ã¨ã‚’ã›ãšã€ä½¿ãˆã‚‹gemã¯ç©æ¥µçš„ã«åˆ©ç”¨ã—ã¦ã„ãã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€æ–¹ã€gemã‚’ä½¿ã‚ãšã¨ã‚‚Railsæ¨™æº–ã§è§£æ±ºã§ãã‚‹ã“ã¨ã‚‚å®Ÿã¯å¤šãã‚ã‚‹ã®ã§è¦‹æ¥µã‚ãŸä¸Šã§gemå°å…¥ã—ã¾ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;p&gt;ã¾ãŸã€é¸æŠè‚¢ã¯ã•ã»ã©å¤šããªã„ã‚‚ã®ã®ã€æœ€è¿‘ã¯ã•ã¾ã–ã¾ãªä¾¿åˆ©SaaSãŒå‡ºã¦ã„ã‚‹ã®ã§ SaaSã‚’ä½¿ã†ã®ã‚‚Fat Modelå¯¾æŠ—æ‰‹æ®µã®ï¼‘ã¤ã¨ã—ã¦æ¤œè¨ã—ã¦ã‚‚ã‚ˆã„ã§ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;non-rails-way&quot;&gt;Non-Rails Way&lt;/h2&gt;

&lt;p&gt;Non-Railsã¯ãƒ¬ãƒ¼ãƒ«ã«ä¹—ã‚‰ãªã„åˆ¥ã®ãƒ¬ãƒ¼ãƒ«ã€ç‹¬è‡ªè·¯ç·šã®ã“ã¨ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/ginzarails-21/non-rails-way.png&quot; alt=&quot;fit&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ã¤ã¾ã‚Šè‡ªã‚‰ãƒ¬ãƒ¼ãƒ«ã‚’ä½œã£ã¦ã„ãã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;form-model&quot;&gt;Form Model&lt;/h3&gt;

&lt;p&gt;Form Modelã¨ã¯ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;include ActiveModel&lt;/code&gt;ã—ãŸRubyã‚¯ãƒ©ã‚¹ã®ã“ã¨ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;å··ã§ã¯Form Objectã¨å‘¼ã°ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã§ã™ãŒã€ï¼œFormã«ç‰¹åŒ–ã—ãŸActiveModelï¼ã¨ã„ã†æ„å‘³ã§ã€ã‚ãˆã¦Form Modelã¨æœ¬ç™ºè¡¨ã§ã¯å‘¼ã‚“ã§ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ãƒ•ã‚©ãƒ¼ãƒ ã¨Form Modelã¯ä¸€å¯¾ä¸€ã§ç´ä»˜ãã¾ã™ã€‚ã“ã†ã™ã‚‹ã“ã¨ã§ &lt;strong&gt;ç‰¹å®šã®ï¼œFormã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼ã«å¯¾å¿œã—ãŸModel&lt;/strong&gt; ãŒä½œæˆå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ğŸ’ gemã®å®Ÿè£…ã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/trailblazer/reform&quot;&gt;reform&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/dry-rb/&quot;&gt;dry-rb&lt;/a&gt;ã‚·ãƒªãƒ¼ã‚ºï¼ˆæ—§ãƒ»&lt;a href=&quot;https://github.com/solnic/virtus&quot;&gt;virtus&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Form Modelã®ä½¿ã„æ‰€ã¨ã—ã¦ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«æ•´ç†ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;ç´ã¥ã&lt;br /&gt;ãƒ†ãƒ¼ãƒ–ãƒ«æ•°&lt;/th&gt;
      &lt;th&gt;Form Modelã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;å•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ãªã©ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹ã¾ã§ã‚‚ãªã„ãƒ•ã‚©ãƒ¼ãƒ ã§åˆ©ç”¨&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2ä»¥ä¸Š&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;accepts_nested_attributes_for&lt;/code&gt;ã®ä»£ã‚ã‚Šã¨ã—ã¦ã€è¤‡é›‘ãªãƒ•ã‚©ãƒ¼ãƒ ã®çµ„ã¿ç«‹ã¦æ™‚ã«åˆ©ç”¨&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ãƒ•ã‚©ãƒ¼ãƒ ãŒ1å¯¾1ã§ç´ã¥ãå ´åˆã¯Rails Wayã§è§£æ±ºã•ã›ã‚‹ã®ãŒç´ ç›´ãªå®Ÿè£…&lt;/p&gt;

&lt;p&gt;ãã®ä»–ã®ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ç‰¹åŒ–ã—ãŸForm Modelå®Ÿè£…ã¨ã—ã¦ã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚‚ã®ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;SearchForm: æ¡ä»¶ã«åŸºã¥ãæ¤œç´¢ã«ç‰¹åŒ–ã—ãŸãƒ•ã‚©ãƒ¼ãƒ &lt;/li&gt;
  &lt;li&gt;DownloadForm: CSVãªã©ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«ç‰¹åŒ–ã—ãŸãƒ•ã‚©ãƒ¼ãƒ &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;poro&quot;&gt;PORO&lt;/h3&gt;

&lt;p&gt;POROã¨ã¯Plain Old Ruby Objectã®ç•¥ã§ã™ã€‚å…ƒãƒã‚¿ã¯PoEAAã®POJO (Plain Old Java Object)ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;POROã¯ã€ActiveRecordã®æ©Ÿèƒ½ã«ä¾å­˜ã—ãªã„ç´”ç²‹ãªRubyå®Ÿè£…ã§ã™ã€‚ãªã®ã§&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;include ActiveModel&lt;/code&gt;ã—ã¦ã„ã‚‹Rubyã‚¯ãƒ©ã‚¹ã¯å€‹äººçš„ã«ã¯POROã¨ã¯å‘¼ã‚“ã§ã„ã¾ã›ã‚“ã€‚&lt;/p&gt;

&lt;p&gt;ç´”ç²‹ãªRubyå®Ÿè£…ãªã®ã§ã‚ã‚‹æ„å‘³ã€ &lt;strong&gt;Ruby Way&lt;/strong&gt; ã¨ã‚‚è¨€ã†ã“ã¨ãŒã§ãã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;POROã®ä¸»ãªç”¨é€”ã¨ã—ã¦ã¯Modelã®è£œåŠ©è¼ªçš„ãªå½¹å‰²ã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹ãˆã°ä¸‹è¨˜ã®ä¾‹ã§ã¯ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;create!&lt;/code&gt;å‘¼ã³å‡ºã—æ™‚ã«å¼•æ•°ã‚’å—ã‘å–ã£ã¦&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;create!&lt;/code&gt;ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¼µã£ã¦è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã®æ›´æ–°ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;PostWithNotifications&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;create!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;creator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;creator: &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;creator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;body: &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;create!&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;creator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:)&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@creator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;creator&lt;/span&gt;
    &lt;span class=&quot;vi&quot;&gt;@body&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;create!&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;transaction&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;create_post!&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;create_notifications!&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;    
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã“ã®Rubyã‚¯ãƒ©ã‚¹ã®å ´åˆã€ï¼œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Post&lt;/code&gt;ä½œæˆã¨ã¨ã‚‚ã«&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Notification&lt;/code&gt;ã‚‚ä½œæˆã™ã‚‹ï¼ã¨ã„ã†è¤‡æ•°ãƒ¢ãƒ‡ãƒ«æ›´æ–°ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’POROã«é–‰ã˜è¾¼ã‚ãŸã¨ã„ã†ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;service-class&quot;&gt;Service Class&lt;/h3&gt;

&lt;p&gt;ç¶šã„ã¦ã¯ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã«é–¢ã—ã¦ã¯ã‚‚ã—ã‹ã—ãŸã‚‰è³›å¦ä¸¡è«–ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã¨ã„ã†æ¦‚å¿µãŒãƒ‡ã‚«ã™ãã‚‹æ•…ã«ã€äººã«ã‚ˆã£ã¦ä½¿ã„æ–¹ãƒ»è§£é‡ˆãŒç•°ãªã‚Šã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã«ã¾ã¤ã‚ã‚‹å··ã®ã™ã‚Œé•ã„ã‚’èµ·ã“ã—ã¦ã„ã‚‹å°è±¡ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã«é–¢ã—ã¦ã¯ã¾ãšã¯ã‚µãƒ¼ãƒ“ã‚¹ã®å®šç¾©å•é¡ŒãŒã‚ã‚‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€Œã‚ãªãŸã®è¨€ã†Serviceã£ã¦ãªã‚“ã§ã™ã‹ï¼Ÿã€ã¨ã„ã†å•é¡Œã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€å£ã«ã‚µãƒ¼ãƒ“ã‚¹ã¨ã„ã£ã¦ã‚‚æ§˜ã€…ãªæ–‡è„ˆã®ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Architecture&lt;/th&gt;
      &lt;th&gt;Service Name&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;PoEAA&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;Service Layer&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;DDD&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;Service Class&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;Onion Architecture&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;Application Service, Domain Service&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;Rails â€œServiceâ€&lt;/strong&gt; ?&lt;/td&gt;
      &lt;td&gt;ä¸Šè¨˜ã®ã©ã‚Œã§ã‚‚ãªã„â€Serviceâ€&lt;br /&gt;ä¸Šè¨˜ã‚’çµ„ã¿åˆã‚ã›ãŸâ€Serviceâ€&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ã€Œã©ã†ã„ã†æ–‡è„ˆã®ã‚µãƒ¼ãƒ“ã‚¹ã‹ï¼Ÿã€ã‚’æ˜ç¢ºã«ã—ãŸä¸Šã§è­°è«–ã—ãªã„ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã®å®šç¾©ãƒ»æ¦‚å¿µãŒãƒœãƒ³ãƒ¤ãƒªã—ã¦ã—ã¾ã†å°è±¡ã§ã™ã€‚ãªã®ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã‚’å°å…¥ã™ã‚‹éš›ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã®å®šç¾©ãƒ»ä½¿ã„æ–¹ã‚’æ˜ç¢ºã«ã—ãŸä¸Šã§ãƒãƒ¼ãƒ ã«å°å…¥ã—ã¦ã„ãã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;å€‹äººçš„ãªè¦‹è§£ã«ã¯ãªã‚Šã¾ã™ãŒã€ï¼œç‰¹å®šã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®è§£æ±ºï¼ã¨ã„ã†æ„å‘³ã«ãŠã„ã¦ã¯Interactorã®ã»ã†ãŒå°‘ãªãã¨ã‚‚Railsã«ãŠã„ã¦ã¯ç­‹ãŒè‰¯ã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã¾ãŸã€å€‹äººçš„ã«ä¸‹æ‰‹ã«ã‚µãƒ¼ãƒ“ã‚¹ã¨ã„ã†å·¨å¤§ã§å¼·ã„æ¦‚å¿µã‚’æŒã¡è¾¼ã‚€ã‚ˆã‚Šã€POROã¨ã„ã†æ¦‚å¿µã§é›‘ã«ã¾ã¨ã‚ãŸã»ã†ãŒå¥½ã¿ã ã£ãŸã‚Šã—ã¾ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;1-table-multiple-models&quot;&gt;1 Table Multiple Models&lt;/h3&gt;

&lt;p&gt;ä¸€ã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¤‡æ•°Modelã‚’ç´ä»˜ã‘ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;Rails Wayã ã¨STIã§ã®ã¿ã“ã‚Œã¯å®Ÿç¾å¯èƒ½ã§ã™ãŒã€STIã‚’ä½¿ã‚ãšã«ãŒã‚“ã°ã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã§è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã‚’è¡¨ç¾ã—ã¡ã‚ƒã„ã¾ã—ã‚‡ã†ã¨ã„ã†ã‚„ã‚Šæ–¹ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã‚³ãƒ¼ãƒ‰ã«ã™ã‚‹ã¨ã€ä¾‹ãˆã°ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User::AsSignUp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;validates&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_create&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:send_welcome_email&lt;/span&gt;

  &lt;span class=&quot;kp&quot;&gt;private&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send_welcome_email&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã“ã®ä¾‹ã§ã¯ï¼œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User&lt;/code&gt;ã®ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ï¼ã¨ã„ã†ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã®ã¿ç‰¹åŒ–ã—ãŸActiveRecordã®Modelã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ãŸã ã“ã®å®Ÿè£…ã«é–¢ã—ã¦ã¯ã€1 Table 1 Modelã¨ã„ã†Railsã®ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ï¼ˆè¦ç´„ï¼‰ã‚’å£Šã™ã“ã¨ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€ã„ã•ã•ã‹å±é™ºæ€æƒ³ã¨ã„ã†å°è±¡ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ãŸã åƒ•è‡ªèº«å®Ÿéš›ã«ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã«å°å…¥ã—ã¦é‹ç”¨ã—ãŸçµŒé¨“ã¯ãªã„ã®ã§ã€ã‚‚ã—å®Ÿé‹ç”¨ã«ãŠã‘ã‚‹æˆåŠŸä¾‹ãŠæŒã¡ã®æ–¹ãŒã„ã‚Œã°æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;non-rails-wayã¾ã¨ã‚&quot;&gt;ã€ŒNon-Rails Wayã€ã¾ã¨ã‚&lt;/h3&gt;

&lt;p&gt;4ã¤ã® Non-Railsã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Form Model&lt;/li&gt;
  &lt;li&gt;PORO&lt;/li&gt;
  &lt;li&gt;Service Class&lt;/li&gt;
  &lt;li&gt;1 Table Multiple Models&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ã“ã‚Œã‚‰ã‚’ã†ã¾ãå°å…¥ã§ãã‚Œã°Fat Modelã‚’å€’ã™å¼·åŠ›ãªæ­¦å™¨ã¨ãªã‚‹ã®ã¯é–“é•ã„ãªã„ã§ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;p&gt;ã©ã‚Œã‚’ã©ã†å°å…¥ã™ã‚‹ã‹ã«é–¢ã—ã¦ã¯æ­£è§£ã¯ãªã„ã¨æ€ã†ã®ã§ãƒãƒ¼ãƒ ã«ã‚ã£ãŸæ‰‹æ³•ã‚’é¸æŠã™ã‚‹ã¨è‰¯ã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã¨ã„ã£ã¦ã‚‚ã€Œã©ã‚Œã‚’å°å…¥ã™ã‚Œã°ã„ã„ã‹ã‚ã‹ã‚‰ã‚“â€¦ã€ã£ã¦ãªã‚‹ã¨æ€ã†ã®ã§å€‹äººçš„ãªãŠã™ã™ã‚ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ç´¹ä»‹ã™ã‚‹ã¨ã€ãƒ¢ãƒ‡ãƒ«ã‚’å¤ªã‚‰ã›ã¦ã—ã¾ã†ã‚ˆã†ãªè¤‡é›‘ãªãƒ•ã‚©ãƒ¼ãƒ ã«é–¢ã—ã¦ã¯Form Modelã§è¡¨ç¾ã™ã‚‹ã®ãŒã‚ã‹ã‚Šã‚„ã™ã„ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ä½•ã‚‰ã‹ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ç‰¹åŒ–ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œã‚ŠãŸã„ã®ã§ã‚ã‚Œã°ã€Sub-Railsã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ç´¹ä»‹ã—ãŸInteractorã‚’ä½¿ã†ã®ãŒå€‹äººçš„ã«ã¯ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ä¸Šè¨˜ã§è¶³ã‚Šãªã„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒå‡ºã¦ããŸå ´åˆã€POROã¨ç·ç§°ã—ã¦Modelã®è£œåŠ©è¼ªã¨ãªã‚‹ã‚ˆã†ãªRubyã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¦ã‚ã’ã‚‹ã¨è‰¯ã„ã‹ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å…¨ä½“ã®ã¾ã¨ã‚&quot;&gt;å…¨ä½“ã®ã¾ã¨ã‚&lt;/h2&gt;

&lt;p&gt;Fat Modelã‚’å€’ã™ãŸã‚ã®3ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Rails Way&lt;/strong&gt;: Railsã®è¦ç´„ã«æ²¿ã£ãŸé–‹ç™ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Sub-Rails Way&lt;/strong&gt;: Railsã®è¦ç´„ã‚’gemã§è£œå¼·ãƒ»æ‹¡å¼µã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Non-Rails Way&lt;/strong&gt;: Railsã®è¦ç´„ã‹ã‚‰å¤–ã‚Œã‚‹ç‹¬è‡ªå®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ã¾ãšã¯ã€ &lt;strong&gt;Rails Way&lt;/strong&gt; + &lt;strong&gt;Sub-Rails Way&lt;/strong&gt; ã§Fat Modelã‚’ãƒ€ã‚¤ã‚¨ãƒƒãƒˆã§ããªã„ã‹è€ƒãˆã¾ã—ã‚‡ã†ã€‚å°è¦æ¨¡ãªRailsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚Œã° Rails Way + Sub-Rails Way ã§ååˆ†æˆ¦ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;Rails Way + Sub-Rails Way ã ã‘ã§ç«‹ã¡è¡Œã‹ãªããªã£ãŸå ´åˆã«ã€å¿…è¦ã«å¿œã˜ã¦é©åˆ‡ãª &lt;strong&gt;Non-Rails Way&lt;/strong&gt; ã‚’å–ã‚Šå…¥ã‚Œã¦ã„ãã¾ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Non-Rails Way&lt;/strong&gt; ã¯ãƒãƒ¼ãƒ æ¯ã«æœ€é©è§£ãŒã‚ã‚‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ãƒãƒ¼ãƒ ã§åˆæ„ã§ãã‚‹ç‹¬è‡ªè·¯ç·šã‚’é¸æŠãƒ»å°å…¥ã™ã‚Œã°ã‚ˆã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å‚è€ƒè³‡æ–™&quot;&gt;å‚è€ƒè³‡æ–™&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;æ›¸ç±
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://amzn.to/2TO3ZTe&quot;&gt;ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://amzn.to/2XfXKJT&quot;&gt;Clean Architectureã€€é”äººã«å­¦ã¶ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®æ§‹é€ ã¨è¨­è¨ˆ&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://amzn.to/3exaz8y&quot;&gt;ã‚¨ãƒªãƒƒã‚¯ãƒ»ã‚¨ãƒ´ã‚¡ãƒ³ã‚¹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://leanpub.com/growing-rails&quot;&gt;Growing Rails Applications in Practice&lt;/a&gt; by Henning Koch and Thomas Eisenbarth&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¾ã¤ã‚ã‚‹è³‡æ–™
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://martinfowler.com/eaaDev/&quot;&gt;Martin Fowler: Development of Further Patterns of Enterprise Application Architecture&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html&quot;&gt;Clean Coder Blog: The Clean Architecture&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://jeffreypalermo.com/2008/07/the-onion-architecture-part-1/&quot;&gt;The Onion Architecture : part 1 | Programming with Palermo&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://guides.hanamirb.org/architecture/interactors/&quot;&gt;Architecture: Interactors | Hanami Guides&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://qiita.com/yuku_t/items/961194a5443b618a4cac&quot;&gt;ä¸­è¦æ¨¡Webé–‹ç™ºã®ãŸã‚ã®MVCåˆ†å‰²ã¨ãƒ¬ã‚¤ãƒ¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - Qiita&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Railså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://guides.rubyonrails.org/association_basics.html&quot;&gt;Active Record Associations â€” Ruby on Rails Guides&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://guides.rubyonrails.org/active_model_basics.html&quot;&gt;Active Model Basics â€” Ruby on Rails Guides&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html&quot;&gt;accepts_nested_attributes_for&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://api.rubyonrails.org/classes/ActiveRecord/Inheritance.html&quot;&gt;ActiveRecord::Inheritance&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://api.rubyonrails.org/v6.0.2.1/classes/ActiveSupport/Concern.html&quot;&gt;ActiveSupport::Concern&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Form Model (Form Object)ã«ã¤ã„ã¦
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://tech.libinc.co.jp/entry/2019/04/05/113000&quot;&gt;Railsã§è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã‚’æ‰±ã†ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã™ã£ãã‚Šæ›¸ãï¼ˆFormã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ - LiBz Tech Blog&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://moneyforward.com/engineers_blog/2018/12/15/formobject/&quot;&gt;accepts_nested_attributes_forã‚’ä½¿ã‚ãšã€è¤‡æ•°ã®å­ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹ | Money Forward Engineersâ€™ Blog&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://discourse.clean-rails.org/t/model-form-1-1/14&quot;&gt;Model ã¨ç”»é¢ä¸Šã® form ãŒ1å¯¾1ã§ä¸€è‡´ã—ãªã„å ´åˆã€ã©ã®ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹ã®ãŒç¶ºéº—ãªã®ã‹ï¼Ÿ - clean-rails.org&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Service Class (Service Object) ã«ã¤ã„ã¦
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://techracho.bpsinc.jp/hachi8833/2017_10_16/46482&quot;&gt;Railsã§é‡è¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³part 1: Service Objectï¼ˆç¿»è¨³ï¼‰ï½œTechRachoï¼ˆãƒ†ãƒƒã‚¯ãƒ©ãƒƒãƒãƒ§ï¼‰ã€œã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ã€Œï¼Ÿã€ã‚’ã€Œï¼ã€ã«ã€œï½œBPSæ ªå¼ä¼šç¤¾&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://qiita.com/joker1007/items/2a03500017766bdb0234&quot;&gt;ã¦ã‚ãˆã‚‰ã®Railsã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã˜ã‚ƒã­ãˆï¼ã¾ãšã¯Callbackã‚¯ãƒ©ã‚¹ã€Validatorã‚¯ãƒ©ã‚¹ã‚’æ´»ç”¨ã—ã‚ï¼ - Qiita&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://intersect.whitefusion.io/the-art-of-code/why-service-objects-are-an-anti-pattern&quot;&gt;Why Service Objects are an Anti-Pattern â€” INTERSECT&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://techracho.bpsinc.jp/hachi8833/2018_04_16/55130&quot;&gt;Service ObjectãŒã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚ã‚‹ç†ç”±ã¨ã‚ˆã‚Šã‚ˆã„ä»£æ›¿æ‰‹æ®µï¼ˆç¿»è¨³ï¼‰ï½œTechRachoï¼ˆãƒ†ãƒƒã‚¯ãƒ©ãƒƒãƒãƒ§ï¼‰ã€œã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ã€Œï¼Ÿã€ã‚’ã€Œï¼ã€ã«ã€œï½œBPSæ ªå¼ä¼šç¤¾&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://speakerdeck.com/willnet/concerns-about-concerns&quot;&gt;Concerns about Concerns - Speaker Deck&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://tech.kitchhike.com/entry/2018/02/28/221159&quot;&gt;Decorator ã¨ Presenter ã‚’ä½¿ã„åˆ†ã‘ã¦ã€ Rails ã‚’ ViewModel ã§ã™ã£ãã‚Šã•ã›ã‚ˆã† - KitchHike Tech Blog&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://qiita.com/hanachin_/items/ba1dd93905567d88145c&quot;&gt;ActiveRecordã®ãƒ¢ãƒ‡ãƒ«ãŒ1ã¤ã ã¨ã¤ã‚‰ã„ - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;å¾Œç·¨è³ªå•æ„Ÿæƒ³ç·¨&quot;&gt;å¾Œç·¨ï¼ˆè³ªå•ãƒ»æ„Ÿæƒ³ç·¨ï¼‰&lt;/h2&gt;

&lt;p&gt;åˆ¥è¨˜äº‹ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/how-to-deal-with-fat-model-after&quot;&gt;éŠ€åº§Rails#21ã§ã€ŒFat Modelã®å€’ã—æ–¹ã€ã‚’ç™ºè¡¨ã—ã¾ã—ãŸ ã€œè³ªå•ãƒ»æ„Ÿæƒ³ç·¨ã€œ&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model&quot;&gt;Buckblog: Skinny Controller, Fat Model&lt;/a&gt;Â &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:a&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://speakerdeck.com/hshimoyama/rails-with-applicationmodel&quot;&gt;ApplicationModel ã®ã‚ã‚‹é¢¨æ™¯ - Speaker Deck&lt;/a&gt;Â &lt;a href=&quot;#fnref:a&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:b&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://speakerdeck.com/yasaichi/what-is-ruby-on-rails-and-how-to-deal-with-it&quot;&gt;Ruby on Railsã®æ­£ä½“ã¨å‘ãåˆã„æ–¹ - Speaker Deck&lt;/a&gt;Â &lt;a href=&quot;#fnref:b&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:c&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://leanpub.com/growing-rails&quot;&gt;Growing Rails Applications in Practice&lt;/a&gt;Â &lt;a href=&quot;#fnref:c&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:6&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://twitter.com/dhh/status/964244090224128001&quot;&gt;https://twitter.com/dhh/status/964244090224128001&lt;/a&gt;Â &lt;a href=&quot;#fnref:6&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;PoEAA: &lt;a href=&quot;https://www.martinfowler.com/eaaCatalog/singleTableInheritance.html&quot;&gt;Single Table Inheritance&lt;/a&gt;Â &lt;a href=&quot;#fnref:5&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:7&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/26976#discussion_r87855694&quot;&gt;https://github.com/rails/rails/pull/26976#discussion_r87855694&lt;/a&gt;Â &lt;a href=&quot;#fnref:7&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:8&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;å‚è€ƒ: &lt;a href=&quot;https://amzn.to/3cekmi3&quot;&gt;ã€Rubyã«ã‚ˆã‚‹ãƒ†ã‚™ã‚µã‚™ã‚¤ãƒ³ãƒã‚šã‚¿ãƒ¼ãƒ³ã€&lt;/a&gt; ç¬¬11ç«  ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ”¹è‰¯ã™ã‚‹ï¼šDecoratorÂ &lt;a href=&quot;#fnref:8&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:10&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Ruby/Railså…¬å¼ã®æä¾›ã™ã‚‹æ©Ÿèƒ½ã¯gemã‚ˆã‚Šè²§å¼±ã ã£ãŸã‚Šã™ã‚‹ã®ã§ã‚ã—ã‹ã‚‰ãšÂ &lt;a href=&quot;#fnref:10&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;Â &lt;a href=&quot;#fnref:10:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content><author><name>Toshimaru</name></author><category term="presentation" /><category term="rails" /><category term="activerecord" /><summary type="html">éŠ€åº§Rails#21ã§ã€ŒFat Modelã®å€’ã—æ–¹ã€ã¨é¡Œã—ã¦ç™ºè¡¨ã—ã¦ãã¾ã—ãŸã€‚</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/ginzarails-21/og.jpg" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/ginzarails-21/og.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">ActiveRecordã§has_oneã‚’æŒã£ãŸãƒ¢ãƒ‡ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦é–¢é€£ã‚’å®šç¾©ã™ã‚‹æ–¹æ³•</title><link href="https://blog.toshimaru.net/belongs-to-foreign-key-and-primary-key/" rel="alternate" type="text/html" title="ActiveRecordã§has_oneã‚’æŒã£ãŸãƒ¢ãƒ‡ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦é–¢é€£ã‚’å®šç¾©ã™ã‚‹æ–¹æ³•" /><published>2019-11-10T00:00:00+09:00</published><updated>2019-11-10T00:00:00+09:00</updated><id>https://blog.toshimaru.net/belongs-to-foreign-key-and-primary-key</id><content type="html" xml:base="https://blog.toshimaru.net/belongs-to-foreign-key-and-primary-key/">&lt;h2 id=&quot;ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ&quot;&gt;ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ&lt;/h2&gt;

&lt;p&gt;ã¨ã‚ã‚‹Railsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã“ã‚“ãªãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆãŒã‚ã£ãŸã¨ã—ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/belongs-to-foreign-key-and-primary-key/users-posts.png&quot; alt=&quot;table relation&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;railsãƒ¢ãƒ‡ãƒ«å®šç¾©&quot;&gt;Railsãƒ¢ãƒ‡ãƒ«å®šç¾©&lt;/h2&gt;

&lt;p&gt;Railsãƒ¢ãƒ‡ãƒ«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªçŠ¶æ…‹ã§ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User&lt;/code&gt;ï¼‰ã¯è¤‡æ•°ã®è¨˜äº‹ï¼ˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Post&lt;/code&gt;ï¼‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã£ã¦ã„ã‚‹&lt;/li&gt;
  &lt;li&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User&lt;/code&gt;ï¼‰ã¯ï¼‘ã¤ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Profile&lt;/code&gt;ï¼‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã£ã¦ã„ã‚‹&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_one&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:profile&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Post&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;has_oneã‚’ã‚‚ã£ãŸãƒ¢ãƒ‡ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹&quot;&gt;has_oneã‚’ã‚‚ã£ãŸãƒ¢ãƒ‡ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹&lt;/h2&gt;

&lt;p&gt;ã‚„ã‚ŠãŸã„ã“ã¨ã¨ã—ã¦ã¯ã“ã®ãƒ¢ãƒ‡ãƒ«æ§‹æˆã®ä¸­å¿ƒã«ã„ã‚‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User&lt;/code&gt; ã®é–¢é€£ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Post&lt;/code&gt; ã¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Profile&lt;/code&gt; ã‚’ç›´æ¥é–¢é€£ä»˜ã‘ã¦ã‚„ã‚‹ã“ã¨ã§ã™ã€‚ã¤ã¾ã‚Š &lt;strong&gt;User has_one Profile&lt;/strong&gt;, &lt;strong&gt;User has_many Posts&lt;/strong&gt; ã®é–¢ä¿‚ã‚’ã€&lt;strong&gt;Profile has_many Posts&lt;/strong&gt; ã®é–¢ä¿‚ã«ã—ã¡ã‚ƒãŠã†ã€ã¨ã„ã†ã“ã¨ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã§è¡¨ç¾ã™ã‚‹ã¨ä¸‹å›³ã®èµ¤ç·šã®éƒ¨åˆ†ãŒä»Šå›ã‚„ã‚ŠãŸã„é–¢é€£ã®å®šç¾©ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/belongs-to-foreign-key-and-primary-key/users-posts2.png&quot; alt=&quot;model relation 2&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;ãƒ¢ãƒ‡ãƒ«å®šç¾©&quot;&gt;ãƒ¢ãƒ‡ãƒ«å®šç¾©&lt;/h3&gt;

&lt;p&gt;ä¸Šè¨˜ã®ã‚„ã‚ŠãŸã„ã“ã¨ã¯ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã®å®šç¾©ã«ãŠã„ã¦ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;foreign_key&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;primary_key&lt;/code&gt; ãªã©ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é§†ä½¿ã—ã¦å®Ÿç¾å¯èƒ½ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹è¨˜ãŒãã®ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©ã®å®Œæˆå½¢ã¨ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_one&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:profile&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Post&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;foreign_key: :user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;primary_key: :user_id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;foreign_key: :user_id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã“ã®å®šç¾©ã«ã‚ˆã‚Š &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Post&lt;/code&gt; â†’ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Profile&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Profile&lt;/code&gt; â†’ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Post&lt;/code&gt; ã®åŒæ–¹å‘ã®é–¢é€£ä»˜ã‘ãŒå®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;profile&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  Post Load (1.2ms)  SELECT  `posts`.* FROM `posts` ORDER BY `posts`.`id` ASC LIMIT 1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  Profile Load (3.9ms)  SELECT  `profiles`.* FROM `profiles` WHERE `profiles`.`user_id` = 1 LIMIT 1&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;Profile id: 1, user_id: 1, ...&quot;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;posts&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  Profile Load (0.8ms)  SELECT  `profiles`.* FROM `profiles` ORDER BY `profiles`.`id` ASC LIMIT 1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  Post Load (0.4ms)  SELECT  `posts`.* FROM `posts` WHERE `posts`.`user_id` = 1 LIMIT 11&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;ActiveRecord::Associations::CollectionProxy [#&amp;lt;Post id: 1, user_id: 1, ...&quot;&amp;gt;, #&amp;lt;Post id: 2, user_id: 1, ...]&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸Šçµæœã®é€šã‚Šã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User Load&lt;/code&gt;ã‚’é€šã™ã“ã¨ãªããŠäº’ã„ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚&lt;/p&gt;

&lt;h2 id=&quot;inverse_of-ã‚’è¨­å®šã™ã‚‹&quot;&gt;inverse_of ã‚’è¨­å®šã™ã‚‹&lt;/h2&gt;

&lt;p&gt;ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã‚„ã‚ŠãŸã„ã“ã¨ãŒå®Ÿç¾ã§ãã¾ã—ãŸãŒã€ã¾ã ï¼‘ã¤ã ã‘å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;foreign_key&lt;/code&gt; ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹ãŸã‚ã«ã€åŒæ–¹å‘ã®é–¢é€£ä»˜ã‘ãŒä¸å®Œå…¨ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Active Recordã§ã¯æ¨™æº–çš„ãªåå‰åŒå£«ã®é–¢é€£ä»˜ã‘ã®ã»ã¨ã‚“ã©ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¦ã€è‡ªå‹•çš„ã«èªè­˜ã§ãã¾ã™ã€‚ãŸã ã—ã€Active Recordã§ã‚¹ã‚³ãƒ¼ãƒ—ã‚„æ¬¡ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ãŸå ´åˆã€åŒæ–¹å‘ã®é–¢é€£ä»˜ã‘ã¯è‡ªå‹•çš„ã«èªè­˜ã•ã‚Œã¾ã›ã‚“ã€‚&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:through&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:foreign_key&lt;/code&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;via. &lt;a href=&quot;https://railsguides.jp/association_basics.html#%E5%8F%8C%E6%96%B9%E5%90%91%E9%96%A2%E9%80%A3%E4%BB%98%E3%81%91&quot;&gt;Active Record ã®é–¢é€£ä»˜ã‘ - Rails ã‚¬ã‚¤ãƒ‰&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å®Ÿéš›ã«è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã™ã‚‹ã¨ä¸‹è¨˜ã®é€šã‚Šã€åŒã˜idã‚’æŒã£ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšé•ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;Profile id: 1, user_id: 1, ...&quot;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;posts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;profile&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;Profile id: 1, user_id: 1, ...&quot;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;equal?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile2&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ãƒ¢ãƒ‡ãƒ«å®šç¾©inverse_of-version&quot;&gt;ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆinverse_of versionï¼‰&lt;/h3&gt;

&lt;p&gt;ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;inverse_of&lt;/code&gt; ã‚’è¨­å®šã—ã¾ã™ã€‚ä¸Šè¿°ã®ã‚³ãƒ¼ãƒ‰ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_one&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:profile&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Post&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;foreign_key: :user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;primary_key: :user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;inverse_of: :posts&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Profile&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;foreign_key: :user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;inverse_of: :profile&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã“ã‚Œã§ä¸‹è¨˜ã‚³ãƒ¼ãƒ‰ã¯åŒã˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ãªã‚Šã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;true&lt;/code&gt;ã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Profile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;posts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;profile&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;equal?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;profile2&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;éå»ã«æ›¸ã„ãŸé–¢é€£è¨˜äº‹&quot;&gt;éå»ã«æ›¸ã„ãŸé–¢é€£è¨˜äº‹&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/belongs_to-through/&quot;&gt;ActiveRecordã§has_many, throughã¨ã¯é€†ã®é–¢é€£ã‚’å®šç¾©ã™ã‚‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;å‚è€ƒ&quot;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://railsdoc.github.io/classes/ActiveRecord/Associations/ClassMethods.html#method-i-belongs_to&quot;&gt;ActiveRecord::Associations::ClassMethods - belongs_to | RailsDoc(Î²)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://railsdoc.github.io/classes/ActiveRecord/Associations/ClassMethods.html#method-i-has_many&quot;&gt;ActiveRecord::Associations::ClassMethods - has_many | RailsDoc(Î²)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Toshimaru</name></author><category term="activerecord" /><category term="rails" /><summary type="html">ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/belongs-to-foreign-key-and-primary-key/og.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/belongs-to-foreign-key-and-primary-key/og.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">railsdm2018ã§ã€ŒActiveRecordãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã‚’ç™ºè¡¨ã—ã¾ã—ãŸ</title><link href="https://blog.toshimaru.net/rdm2018-active-record-anti-patterns/" rel="alternate" type="text/html" title="railsdm2018ã§ã€ŒActiveRecordãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã‚’ç™ºè¡¨ã—ã¾ã—ãŸ" /><published>2018-03-27T00:00:00+09:00</published><updated>2018-03-27T00:00:00+09:00</updated><id>https://blog.toshimaru.net/rdm2018-active-record-anti-patterns</id><content type="html" xml:base="https://blog.toshimaru.net/rdm2018-active-record-anti-patterns/">&lt;p&gt;&lt;a href=&quot;https://railsdm.github.io/2018/&quot;&gt;Rails Developers Meetup 2018&lt;/a&gt;ã§ã€ŒActiveRecordãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ã§ç™ºè¡¨ã—ã¦ãã¾ã—ãŸã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç™ºè¡¨è³‡æ–™&quot;&gt;ç™ºè¡¨è³‡æ–™&lt;/h2&gt;

&lt;script async=&quot;&quot; class=&quot;speakerdeck-embed&quot; data-id=&quot;2bb9d7ceea4b4987bf4c8618a53a1e68&quot; data-ratio=&quot;1.33333333333333&quot; src=&quot;//speakerdeck.com/assets/embed.js&quot;&gt;&lt;/script&gt;

&lt;h2 id=&quot;ç™ºè¡¨æ¦‚è¦&quot;&gt;ç™ºè¡¨æ¦‚è¦&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;ActiveRecordã¯Webã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢é”ãŒå«Œã†ï¼ˆï¼Ÿï¼‰SQLã‚’æ›¸ã‹ãšã¨ã‚‚ã€Rubyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§æ°—è»½ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹é­”æ³•ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã—ã‹ã—ä¾¿åˆ©ãªåé¢ã€ä½•ã‚‚è€ƒãˆãšã«ã‚´ãƒªã‚´ãƒªActiveRecordã‚’ä½¿ã£ã¦DBã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ã¨ã€åŠ‡çš„ã«é‡ãŸã„ã‚¯ã‚¨ãƒªãŒç™ºè¡Œã•ã‚ŒãŸã‚ŠéåŠ¹ç‡çš„ãªã‚¯ã‚¨ãƒªãŒé‡ç”£ã•ã‚ŒãŸã‚Šã—ã¾ã™ã€‚&lt;/p&gt;

  &lt;p&gt;æœ¬ç™ºè¡¨ã§ã¯ãã‚Œã‚‰ActiveRecordã§é™¥ã‚ŠãŒã¡ãªç½ ã‚’ãƒ‘ã‚¿ãƒ¼ãƒ³åŒ–ã—ã€ActiveRecordãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦ç™ºè¡¨ã—ã¾ã™ã€‚&lt;/p&gt;

  &lt;p&gt;â€»ç™ºè¡¨ã§ã¯å®Ÿéš›ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¨ã¨ã‚‚ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è¨ˆæ¸¬çµæœã‚‚ç´¹ä»‹ã—ã¾ã™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;äº‹å‰ã«å…¬é–‹ã—ãŸã‚¨ãƒ³ãƒˆãƒª&quot;&gt;äº‹å‰ã«å…¬é–‹ã—ãŸã‚¨ãƒ³ãƒˆãƒª&lt;/h2&gt;

&lt;p&gt;ç™ºè¡¨è³‡æ–™ã«å‡ºã¦ãã‚‹æœ€åˆã®äº‹ä¾‹ã¯ã“ã¡ã‚‰ãŒãƒ™ãƒ¼ã‚¹ã®äº‹ä¾‹ã¨ãªã£ã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;ja&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;ä»Šæœˆæœ«ã®Rails Developer Meetupã«å…ˆé§†ã‘ã¦Railsã®é…ã„ãƒãƒƒãƒå‡¦ç†ã‚’400å€é€Ÿãã™ã‚‹è©±ã‚’æ›¸ãã¾ã—ãŸ  | Rails/ActiveRecord ãƒãƒƒãƒå‡¦ç†ã®æœ€é©åŒ– - Hack Your Design! &lt;a href=&quot;https://t.co/i7JZnZcuLc&quot;&gt;https://t.co/i7JZnZcuLc&lt;/a&gt;&lt;/p&gt;&amp;mdash; toshimaru (@toshimaru_e) &lt;a href=&quot;https://twitter.com/toshimaru_e/status/970546164725501952?ref_src=twsrc%5Etfw&quot;&gt;March 5, 2018&lt;/a&gt;&lt;/blockquote&gt;

&lt;h2 id=&quot;ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰&quot;&gt;ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰&lt;/h2&gt;

&lt;p&gt;å®Ÿéš›ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœã¯ã“ã¡ã‚‰ã«ä¸ŠãŒã£ã¦ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lib/tasks/batch.rake&lt;/code&gt;ã€ã‚¹ã‚­ãƒ¼ãƒã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;schema.rb&lt;/code&gt;ã€ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;db/*_seed.csv&lt;/code&gt;ã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœã¯CircleCIã‚’ãã‚Œãã‚Œå‚ç…§ãã ã•ã„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/toshimaru/rdm-rails5.1&quot;&gt;https://github.com/toshimaru/rdm-rails5.1&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;ç™ºè¡¨ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³&quot;&gt;ç™ºè¡¨ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³&lt;/h2&gt;

&lt;p&gt;ä»Šå›ã®ç™ºè¡¨ã«è‡³ã‚‹ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã¯ã€åƒ•ãŒå®Ÿéš›ã«è¸ã‚“ã ActiveRecordã®é‡ã„å‡¦ç†ã¨ã‹ä»–ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒæ›¸ã„ãŸActiveRecordã‚³ãƒ¼ãƒ‰ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã®ãŸã‚ã®ä¿®æ­£ãªã©ã‚’ã‚„ã£ã¦ã„ã‚‹ä¸­ã§ã€ãã®è‰¯ããªã„å‡¦ç†åŠã³ãã‚Œã«å¯¾ã™ã‚‹è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒãƒ‘ã‚¿ãƒ¼ãƒ³åŒ–ã§ãã‚‹ã¨æ€ã£ãŸã‹ã‚‰ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;åƒ•ã®ã‚¢ã‚¿ãƒã®ä¸­ã«ã€Œã“ã†ã„ã†ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚Šãã†ã€ã¨ã„ã†ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³å€™è£œãŒã‚ã‚‹ç¨‹åº¦ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ãŸã®ã§ã€ä»Šå›ã®ç™ºè¡¨ã‚’æ©Ÿã«ãã‚Œã‚‰ã«ãã‚Œã£ã½ã„åå‰ã‚’ä»˜ã‘ã¦ã€åŒæ™‚ã«æœºä¸Šã®ç©ºè«–ã«ãªã‚‰ãªã„ã‚ˆã†ã«ãã‚Œã‚‰ã‚’ã‚³ãƒ¼ãƒ‰ã«è½ã¨ã—ã¦ã€èãæ‰‹ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ã„ã‚ˆã†ã«å…·ä½“çš„ãªäº‹ä¾‹ã¨ã¨ã‚‚ã«ç´¹ä»‹ã—ã¾ã—ãŸã€‚&lt;/p&gt;

&lt;p&gt;çµæœã¨ã—ã¦ã€è‡ªåˆ†ã®ä¸­ã«ã‚ã£ãŸActiveRecordã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‘½åã¨ã¨ã‚‚ã«æ•´ç†ã§ããŸã“ã¨ã¯å¤§å¤‰è‰¯ã‹ã£ãŸã¨æ€ã£ã¦ã„ã¾ã™ã€‚ã¾ãŸã“ã®è³‡æ–™ã•ãˆãƒãƒ¼ãƒ ã«å…±æœ‰ã—ã¨ã‘ã°ã€ä»Šå¾Œãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã¨ãã¨ã‹ã§ã‚‚ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã«é–¢ã™ã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã—ã‚„ã™ããªã£ã¦å€‹äººçš„ã«åŠ©ã‹ã‚Šãã†ã§ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç´¹ä»‹ã—ãŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³&quot;&gt;ç´¹ä»‹ã—ãŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³&lt;/h2&gt;

&lt;p&gt;ç™ºè¡¨å†…ã§ç´¹ä»‹ã—ãŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã“ã¡ã‚‰ã§ã™ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;All Each Pattern&lt;/li&gt;
  &lt;li&gt;N+1 Update Queries Pattern&lt;/li&gt;
  &lt;li&gt;Ruby Aggregation Pattern&lt;/li&gt;
  &lt;li&gt;N+1 Queries Pattern&lt;/li&gt;
  &lt;li&gt;Unnecessary Query Pattern&lt;/li&gt;
  &lt;li&gt;Unnecessary Mode Initialization Pattern&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;ç´¹ä»‹ã§ããªã‹ã£ãŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³&quot;&gt;ç´¹ä»‹ã§ããªã‹ã£ãŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³&lt;/h2&gt;

&lt;p&gt;ä½•ã‹ã—ã‚‰ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³åŒ–ã§ããã†ã ã‘ã©ã€æ™‚é–“ã®éƒ½åˆä¸Šã—ãªã‹ã£ãŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã“ã¡ã‚‰ã§ã™ã€‚ç™ºè¡¨ã—ãªã‹ã£ãŸã®ã§å‘½åã¯é©å½“ã§ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ãªã‚“ã§ã‚‚includesãƒ‘ã‚¿ãƒ¼ãƒ³&quot;&gt;ãªã‚“ã§ã‚‚includesãƒ‘ã‚¿ãƒ¼ãƒ³&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;joins&lt;/code&gt;ã§è‰¯ã„ã®ã«ãªã‚“ã§ã‚‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;includes&lt;/code&gt;ã§è§£æ±ºã—ã‚ˆã†ã¨ã—ã¡ã‚ƒã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚ã“ã®ã¸ã‚“ã¯ä¸‹è¨˜ã®è§£èª¬ã«è©³ã—ã„ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://qiita.com/k0kubun/items/80c5a5494f53bb88dc58&quot;&gt;ActiveRecordã®joinsã¨preloadã¨includesã¨eager_loadã®é•ã„ - Qiita&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;too-many-find_or_create_by-ãƒ‘ã‚¿ãƒ¼ãƒ³&quot;&gt;Too many find_or_create_by ãƒ‘ã‚¿ãƒ¼ãƒ³&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;find_or_create_by&lt;/code&gt;ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯å–å¾—ã€ãªã‘ã‚Œã°ä½œæˆã£ã¦æŒ™å‹•ã‚’ã™ã‚‹ã‚„ã¤ã§ã™ã€‚ã“ã‚Œã‚’ãƒ«ãƒ¼ãƒ—å†…ã§ä½¿ã„ã¾ãã£ã¡ã‚ƒã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚&lt;/p&gt;

&lt;p&gt;ãã‚“ãªã¨ãã¯SQLã®UPSERTã®æ©Ÿèƒ½ã‚’ä½¿ã†ã®ãŒå¾—ç­–ã€‚å…·ä½“çš„ã«ã¯MySQLã§ã‚ã‚Œã°&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;INSERT...ON DUPLICATE KEY UPDATE&lt;/code&gt;ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;æ®‹å¿µãªã“ã¨ã«UPSERTã¯ActiveRecordã®æ¨™æº–æ©Ÿèƒ½ã§ã¯æä¾›ã•ã‚Œã¦ã„ãªã„ã®ã§ã€&lt;a href=&quot;https://github.com/zdennis/activerecord-import&quot;&gt;activerecord-import&lt;/a&gt;ãªã©ã®gemã‚’ä½¿ã£ã¦è§£æ±ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;has_manyé–¢é€£ã®countæ–¹æ³•ã„ã‚ã„ã‚ã‚ã‚‹ã‚ˆå•é¡Œ&quot;&gt;has_manyé–¢é€£ã®countæ–¹æ³•ã„ã‚ã„ã‚ã‚ã‚‹ã‚ˆå•é¡Œ&lt;/h3&gt;

&lt;p&gt;ã¡ã‚ƒã‚“ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³åŒ–ã§ãã¦ã„ã¾ã›ã‚“ãŒã€ã“ã®å•é¡Œã‚‚ãªã‹ãªã‹é›£ã—ã„å•é¡Œã§ã™ã€‚ã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ä½¿ã£ãŸã‚‰ã‚ˆã„ã‹ã¯ã‚±ãƒ¼ã‚¹ãƒã‚¤ã‚±ãƒ¼ã‚¹ã§å¤‰ã‚ã£ã¦ãã‚‹ã®ã§è©³ã—ãã¯ä¸‹è¨˜ã‚’å‚ç…§ã•ã‚ŒãŸã—ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://qiita.com/nay3/items/1cda39fb58569d832203&quot;&gt;ActiveRecord ã® has_manyé–¢é€£ã€ä»¶æ•°ã‚’èª¿ã¹ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã©ã‚Œã‚’ä½¿ãˆã°ã„ã„ï¼Ÿ - Qiita&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;q--a&quot;&gt;Q &amp;amp; A&lt;/h2&gt;

&lt;h3 id=&quot;ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‡ºå…¸ã¯&quot;&gt;ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‡ºå…¸ã¯ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;å…¨éƒ¨ã‚ªãƒ¬ã§ã™ï¼ˆç¬‘&lt;/p&gt;

&lt;p&gt;ä¸€å¿œå…ƒãƒã‚¿ã¨ã„ã†ã‹ã‚¤ãƒ³ã‚¹ãƒ‘ã‚¤ã‚¢ã‚’å—ã‘ãŸæœ¬ã¨ã—ã¦ã¯ç™ºè¡¨å†…ã§ã‚‚ç´¹ä»‹ã—ã¦ã„ã‚‹ã€SQLã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã§ã™ã€‚&lt;/p&gt;

&lt;iframe style=&quot;width:120px;height:240px;&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; scrolling=&quot;no&quot; frameborder=&quot;0&quot; src=&quot;//rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&amp;amp;bc1=000000&amp;amp;IS2=1&amp;amp;bg1=FFFFFF&amp;amp;fc1=000000&amp;amp;lc1=0000FF&amp;amp;t=toshimaru-22&amp;amp;o=9&amp;amp;p=8&amp;amp;l=as4&amp;amp;m=amazon&amp;amp;f=ifr&amp;amp;ref=as_ss_li_til&amp;amp;asins=4873115892&amp;amp;linkId=6903fbe4f4a55cf4f47b4036bf2f350a&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;ã“ã¡ã‚‰ã®æœ¬ãŒåŸè‘—ã¯è‹±èªã§æ›¸ã‹ã‚Œã¦ãŠã‚Šã€ãã‚Œã«å€£ã†ã‹ãŸã¡ã§è‹±èªã§ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‘½åã—ã¾ã—ãŸã€‚ã¾ãå¹³ãŸãè¨€ã†ã¨ã‚«ãƒƒã‚³ã¤ã‘ã¦è‹±èªã«ã—ã¾ã—ãŸä»¥ä¸Šã®ç†ç”±ã¯ã‚ã‚Šã¾ã›ã‚“ :smile:&lt;/p&gt;

&lt;h3 id=&quot;äº‹ä¾‹ï¼‘usercreated_atã«indexè²¼ã‚‰ãªã„ã®&quot;&gt;ï¼ˆäº‹ä¾‹ï¼‘ï¼‰User.created_atã«INDEXè²¼ã‚‰ãªã„ã®ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ä¸‹è¨˜äºŒç‚¹ã®ç†ç”±ã«ã‚ˆã‚Šè²¼ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å‰æäº‹é …ã¨ã—ã¦DBã®æœ€é©åŒ–ã¯ã—ãªã„ã¨è¿°ã¹ãŸ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User.created_at&lt;/code&gt; ã«INDEXã‚’è²¼ã£ã¦ã‚‚INDEXåŠ¹ã‹ãªã„&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User.created_at&lt;/code&gt;ã«INDEX(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;index_users_on_created_at&lt;/code&gt;)ã‚’è²¼ã£ãŸã‚ã¨ã®å®Ÿè¡Œè¨ˆç”»ãŒã“ã¡ã‚‰ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; EXPLAIN UPDATE `users` SET point = point + 100 WHERE (created_at &amp;gt;= '2017-01-01') \G
*************************** 1. row ***************************
           id: 1
  select_type: UPDATE
        table: users
   partitions: NULL
         type: index
possible_keys: index_users_on_created_at
          key: PRIMARY
      key_len: 8
          ref: NULL
         rows: 99574
     filtered: 100.00
        Extra: Using where
1 row in set (0.00 sec)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;INDEXè²¼ã£ã¦ã¦ã‚‚å¯¾è±¡ç¯„å›²ãŒå¤§ãã„ã¨INDEXåŠ¹ã‹ãªããªã‚‹ã‚“ã§ã™ã€‚ãã—ã¦ä»Šå›ã®ã‚±ãƒ¼ã‚¹ã¯ãã‚Œã«å½“ãŸã‚Šã¾ã™ã€‚ï¼ˆã“ã®æŒ™å‹•ã€å®Ÿã¯åƒ•ã‚‚å…¨ç„¶çŸ¥ã‚Šã¾ã›ã‚“ã§ã—ãŸâ€¦ï¼‰&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;ja&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;mysqlã§æ¤œç´¢ã®å¯¾è±¡ç¯„å›²ãŒå¤§ãããªã‚Šã™ãã‚‹ã¨indexãŒåŠ¹ã‹ãªããªã‚‹ã®çŸ¥ã‚‰ãªã‹ã£ãŸ | [MYSQL] datetimeã‚«ãƒ©ãƒ ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½¿ã‚ã‚Œæ–¹ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã¿ãŸ â”‚ revdev &lt;a href=&quot;https://t.co/2JK7VD7Ttv&quot;&gt;https://t.co/2JK7VD7Ttv&lt;/a&gt;&lt;/p&gt;&amp;mdash; toshimaru (@toshimaru_e) &lt;a href=&quot;https://twitter.com/toshimaru_e/status/974924182369722368?ref_src=twsrc%5Etfw&quot;&gt;March 17, 2018&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;ãƒ†ã‚¹ãƒˆã¨ã—ã¦æ¡ä»¶ã®ç¯„å›²ã‚’å°ã•ãã—ãŸå®Ÿè¡Œè¨ˆç”»ãŒã“ã¡ã‚‰ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; EXPLAIN UPDATE `users` SET point = point + 100 WHERE (created_at &amp;gt;= '2018-01-01') \G
*************************** 1. row ***************************
           id: 1
  select_type: UPDATE
        table: users
   partitions: NULL
         type: range
possible_keys: index_users_on_created_at
          key: index_users_on_created_at
      key_len: 5
          ref: const
         rows: 5903
     filtered: 100.00
        Extra: Using where
1 row in set (0.00 sec)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ãã¡ã‚“ã¨ã“ã¡ã‚‰ã§ã¯INDEXãŒåŠ¹ã„ã¦ã¾ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;äº‹ä¾‹ï¼’æ”¹å–„ï¼‘ã®ã‚³ãƒ¼ãƒ‰ã®ãƒ¢ãƒ‡ãƒ«ã£ã¦ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹&quot;&gt;ï¼ˆäº‹ä¾‹ï¼’ï¼‰æ”¹å–„ï¼‘ã®ã‚³ãƒ¼ãƒ‰ã®ãƒ¢ãƒ‡ãƒ«ã£ã¦ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ä¼šå ´ã§ã‚ã£ãŸè³ªå•ã§ã™ã€‚ã“ã¡ã‚‰ã¯Rails consoleã§å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã—ã¦ã‚ã’ã‚Œã°ä¸€ç›®ç­ç„¶ã§ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; Post.group(:user_id).select(&quot;user_id, SUM(like_count) AS like_count&quot;).order(&quot;like_count DESC&quot;) .limit(100)
  Post Load (976.6ms)  SELECT  user_id, SUM(like_count) AS like_count FROM `posts` GROUP BY `posts`.`user_id` ORDER BY like_count DESC LIMIT 11
=&amp;gt; #&amp;lt;ActiveRecord::Relation [#&amp;lt;Post id: nil, user_id: 2632, like_count: 832&amp;gt;, #&amp;lt;Post id: nil, user_id: 51965, like_count: 800&amp;gt;, #&amp;lt;Post id: nil, user_id: 25068, like_count: 783&amp;gt;, ...]&amp;gt;

&amp;gt; Post.group(:user_id).order(&quot;SUM(like_count) DESC&quot;) .limit(3000).pluck(:user_id)
   (668.3ms)  SELECT  `posts`.`user_id` FROM `posts` GROUP BY `posts`.`user_id` ORDER BY SUM(like_count) DESC LIMIT 3000
=&amp;gt; [2632, 51965, 25068, 8515, 84933, 67763, 89631, 69494, 78805, 17541, 53344, 7618, 92652, 13704, 94308, 96778, ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸€ã¤ç›®ã®&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.select&lt;/code&gt;ã‚’ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã¯ãƒ­ã‚°ã«&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Post Load&lt;/code&gt;ã¨å‡ºç¾ã—ã¦ã„ã‚‹é€šã‚Šã€Postãƒ¢ãƒ‡ãƒ«ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ä¸€æ–¹ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.pluck&lt;/code&gt;ã®ã»ã†ã§ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Post Load&lt;/code&gt;ã¨ã¯ãªã«ã‚‚å‡ºãšå˜ç´”ã«èµ°ã£ãŸã‚¯ã‚¨ãƒªã®ã¿ãŒãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ç´¹ä»‹ã—ãŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã©ã‚Œãã‚‰ã„ã®ä»¶æ•°ã§éšœå®³ã«ç¹‹ãŒã‚Šãã†&quot;&gt;ç´¹ä»‹ã—ãŸã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã©ã‚Œãã‚‰ã„ã®ä»¶æ•°ã§éšœå®³ã«ç¹‹ãŒã‚Šãã†ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ä»Šå›ç´¹ä»‹ã—ãŸäº‹ä¾‹ã¯æ•°åƒä»¶-æ•°åä¸‡ãã‚‰ã„ã®ç¨‹åº¦ã®ãƒ‡ãƒ¼ã‚¿é‡ãªã®ã§ãã“ã¾ã§é…·ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµæœã¯å‡ºã¾ã›ã‚“ã§ã—ãŸãŒã€ä¾‹ãˆã°äº‹ä¾‹ï¼‘ã§ã“ã‚ŒãŒUserãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ç™¾ä¸‡ä»¶ã¨ã‹ã€äº‹ä¾‹ï¼“ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒæ•°åä¸‡ä»¶ãã‚‰ã„ã®ã‚ªãƒ¼ãƒ€ãƒ¼ã«ãªã£ã¦ãã‚‹ã¨ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ãŒè¡¨å‡ºã—ãã†ã‹ãªã€ã¨ã„ã†å°è±¡ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã„ãšã‚Œã«ã›ã‚ˆãã“ãã“ã®è¦æ¨¡ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãªã£ã¦ãã‚‹ã¨ã€æ•°ç™¾ä¸‡ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ‰±ã†ã®ã¯å½“ãŸã‚Šå‰ã®ä¸–ç•Œã«ãªã£ã¦ãã‚‹ã¨æ€ã†ã®ã§ã€ãã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã‚’ã©ã†ActiveRecordã®ä¸–ç•Œã§ä¸Šæ‰‹ã«æ‰±ã†ã¯é€ƒã’ã‚‰ã‚Œãªã„ãƒ†ãƒ¼ãƒã«ãªã£ã¦ãã‚‹ã‹ãªã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç™ºè¡¨ã‚’çµ‚ãˆã¦&quot;&gt;ç™ºè¡¨ã‚’çµ‚ãˆã¦&lt;/h2&gt;

&lt;p&gt;30minsã¨é•·ã‚ã®ç™ºè¡¨ã¯&lt;a href=&quot;/aws-summit-tokyo-2015/&quot;&gt;AWS Summitã¶ã‚Š&lt;/a&gt;ã ã£ãŸã®ã§æ™‚é–“é…åˆ†ã«ã‚„ã‚„ä¸å®‰ãŒã‚ã£ãŸã‘ã©ã€å½“æ—¥ã¯ç™ºè¡¨ã‚’å·»ãã“ã¨ã‚‚ãªãä½™è£•ã‚’ã‚‚ã£ã¦25åˆ†ãã‚‰ã„ã§ç™ºè¡¨ã‚’çµ‚ãˆã‚‰ã‚ŒãŸã®ã§ã‚ˆã‹ã£ãŸã§ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ãã®ä»–ã®è³‡æ–™&quot;&gt;ãã®ä»–ã®è³‡æ–™&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Rails Developer Meetup 2018ã®å…¨ä½“ã®ç™ºè¡¨è³‡æ–™ã¯ã“ã¡ã‚‰: &lt;a href=&quot;https://qiita.com/dyoshimitsu/items/20a41ab656d2da80e4d9&quot;&gt;Rails Developers Meetup 2018 ã‚¹ãƒ©ã‚¤ãƒ‰ã¾ã¨ã‚ - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Toshimaru</name></author><category term="presentation" /><category term="activerecord" /><category term="rails" /><summary type="html">Rails Developers Meetup 2018ã§ã€ŒActiveRecordãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ã§ç™ºè¡¨ã—ã¦ãã¾ã—ãŸã€‚</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/railsdm/rdm2018.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/railsdm/rdm2018.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Rails/ActiveRecord ãƒãƒƒãƒå‡¦ç†ã®æœ€é©åŒ–</title><link href="https://blog.toshimaru.net/rails-batch-optimization/" rel="alternate" type="text/html" title="Rails/ActiveRecord ãƒãƒƒãƒå‡¦ç†ã®æœ€é©åŒ–" /><published>2018-03-05T00:00:00+09:00</published><updated>2018-03-05T00:00:00+09:00</updated><id>https://blog.toshimaru.net/rails-batch-optimization</id><content type="html" xml:base="https://blog.toshimaru.net/rails-batch-optimization/">&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;en&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;Railsã®ãƒãƒƒãƒå‡¦ç†æœ€é©åŒ–ã®è¨˜äº‹æ›¸ã„ãŸã‚‰éœ€è¦ã‚ã‚‹ã‹ãª&lt;/p&gt;&amp;mdash; toshimaru (@toshimaru_e) &lt;a href=&quot;https://twitter.com/toshimaru_e/status/936796457931128832?ref_src=twsrc%5Etfw&quot;&gt;December 2, 2017&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;ã¨ã„ã†ã“ã¨ã§ä»Šæ—¥ã¯Railsãƒãƒƒãƒå‡¦ç†ã®æœ€é©åŒ–ã«ã¤ã„ã¦æ›¸ã„ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ¤œè¨¼ç’°å¢ƒ&quot;&gt;æ¤œè¨¼ç’°å¢ƒ&lt;/h2&gt;

&lt;p&gt;ã‚³ãƒ¼ãƒ‰ã®æ¤œè¨¼ã«ä½¿ã£ãŸç’°å¢ƒã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;macOS High Sierra (2.3 GHz Intel Core i5 / ãƒ¡ãƒ¢ãƒª8G)&lt;/li&gt;
  &lt;li&gt;Ruby 2.5&lt;/li&gt;
  &lt;li&gt;Rails 5.1&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;å‰ææ¡ä»¶&quot;&gt;å‰ææ¡ä»¶&lt;/h2&gt;

&lt;p&gt;æœ€é©åŒ–ã®å‰ææ¡ä»¶ã¨ã—ã¦ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ãƒãƒƒãƒã¯rakeã‚¿ã‚¹ã‚¯ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹&lt;/li&gt;
  &lt;li&gt;ä»Šå›ã€æœ€é©åŒ–å¯¾è±¡ã¨ã™ã‚‹ã®ã¯ &lt;strong&gt;Userãƒ¢ãƒ‡ãƒ«ã®ãƒãƒƒãƒå‡¦ç†&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;ä½¿ç”¨ã™ã‚‹Userãƒ¢ãƒ‡ãƒ«ã¯&lt;a href=&quot;https://github.com/plataformatec/devise/&quot;&gt;devise&lt;/a&gt;ã§ä½œã‚‰ã‚Œã‚‹Userãƒ¢ãƒ‡ãƒ«(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rails generate devise:install&lt;/code&gt;)ã‚’åŸºæœ¬ã¨ã—ã¦ã€ãã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã«intå‹ã®pointã‚«ãƒ©ãƒ ã‚’ã¤ã‘ãŸã‚‚ã®&lt;/li&gt;
      &lt;li&gt;pointã‚«ãƒ©ãƒ ã¯ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªç”±ã«ã¤ã‹ãˆã‚‹ãƒã‚¤ãƒ³ãƒˆã®æ„&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Userãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦äº‹å‰ã« &lt;strong&gt;50ä¸‡ä»¶ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿&lt;/strong&gt; ã‚’æŠ•å…¥ã—ã¦ãŠã&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://dalibornasevic.com/posts/68-processing-large-csv-files-with-ruby&quot;&gt;ã“ã¡ã‚‰ã®ã‚³ãƒ¼ãƒ‰&lt;/a&gt;ã‚’å‚è€ƒã«å‡¦ç†ã® &lt;strong&gt;å®Ÿè¡Œæ™‚é–“&lt;/strong&gt; ã¨ &lt;strong&gt;ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡&lt;/strong&gt; ã‚’è¨ˆæ¸¬ã™ã‚‹&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute&lt;/code&gt;ãªã©ã«ã‚ˆã‚‹ç›´æ¥SQLå®Ÿè¡Œã¯ã›ãšã«DBæ“ä½œã‚’è¡Œã†&lt;/li&gt;
  &lt;li&gt;ã‚·ãƒ³ãƒ—ãƒ«ã«ã™ã‚‹ãŸã‚ã«ã€ç™»éŒ²æ—¥ = &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User.created_at&lt;/code&gt;ã¨ã™ã‚‹
    &lt;ul&gt;
      &lt;li&gt;Userã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯ç„¡ã„ã‚‚ã®ã¨ã™ã‚‹ï¼ˆã™ã¹ã¦UTCã¨ã—ã¦æ‰±ã†ï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã¯è€ƒæ…®ã—ãªã„&lt;/li&gt;
  &lt;li&gt;ä»Šå›è¡Œã†æœ€é©åŒ–ã®å¯¾è±¡ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã§ã‚ã‚ŠDBã®æœ€é©åŒ–ã¯è€ƒãˆãªã„&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ¼ãƒ‰&quot;&gt;ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ¼ãƒ‰&lt;/h2&gt;

&lt;p&gt;ã•ã¦ä»Šå›æœ€é©åŒ–ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã§ã™ã€‚å‡¦ç†å†…å®¹ã¨ã—ã¦ã¯ &lt;strong&gt;å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸­ã‹ã‚‰2017å¹´ä»¥é™ã®ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸100ãƒã‚¤ãƒ³ãƒˆã‚’ä»˜ä¸ã™ã‚‹&lt;/strong&gt; ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚ã„ã‹ã«ã‚‚è²©ä¿ƒæ´»å‹•ã®ä¸€ç’°ã¨ã—ã¦ã‚ã‚Šãã†ãªè©±ã§ã™ï¼ˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2017å¹´ä»¥é™&lt;/code&gt;ã®ã¨ã“ã‚ã®æ¡ä»¶ã¯åˆ¥ã«ãªã‚“ã§ã‚‚è‰¯ã‹ã£ãŸã®ã§ã™ãŒã€å‡¦ç†å¯¾è±¡ã‚’ã‚ã‚‹ç¨‹åº¦ç¢ºä¿ã™ã‚‹ãŸã‚ã«ä»Šå›ã¯ãã®ã‚ˆã†ã«è¨­å®šã—ã¾ã—ãŸï¼‰ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Task: batch:original&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;created_at&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;2017-01-01&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;point&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã‚ãªãŸã¯ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ã±ã£ã¨è¦‹ã¦ã©ã“ãŒæ‚ªã„ã‹ã™ãã«ã‚ã‹ã‚Šã¾ã™ã‹ï¼Ÿï¼ˆè¨€ã†ã¾ã§ã‚‚ãªãã“ã®ã‚³ãƒ¼ãƒ‰ã¯å•é¡Œã‚¢ãƒªã‚¢ãƒªã®ã‚³ãƒ¼ãƒ‰ã§ã™!!ï¼‰&lt;/p&gt;

&lt;p&gt;ä¸­ç´šè€…ä»¥ä¸Šã®Railsã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã‚ã‚Œã°ã€Œãã‚“ãªã‚³ãƒ¼ãƒ‰ã¯çµ¶å¯¾æ›¸ã‹ãªã„ã‚ˆï¼ã€ã¨æ€ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã€ŒRailsã§Webãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’åˆã‚ã¦ã¾ã ä¸€ãƒ¶æœˆã§ã™ï¼ã€ã¿ãŸã„ãªåˆç´šã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã‚ã‚Œã°ä¸Šè¨˜ã®ã‚ˆã†ã«æ›¸ã„ã¦ã‚‚å…¨ç„¶ãŠã‹ã—ãã¯ãªã„ã‚³ãƒ¼ãƒ‰ã ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯&quot;&gt;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯&lt;/h3&gt;

&lt;p&gt;ã¾ãšã¯ã“ã®å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã©ã‚Œã ã‘æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã‹ã‚’è¨ˆæ¸¬ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;p&gt;â€» å‰ææ¡ä»¶ã§æ›¸ã„ãŸé€šã‚Šã€&lt;a href=&quot;https://dalibornasevic.com/posts/68-processing-large-csv-files-with-ruby&quot;&gt;ã“ã¡ã‚‰ã®ã‚³ãƒ¼ãƒ‰&lt;/a&gt;ã‚’å‚è€ƒã«æ™‚é–“ã¨ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’è¨ˆæ¸¬ã—ã¾ã™ã€‚ã¾ãŸçµæœã¯æ•°å›å®Ÿæ–½ã—ãŸä¸Šã§å¤§ããå¤–ã‚Œã¦ã„ãªã„å¹³å‡çš„ãªã‚¹ã‚³ã‚¢çµæœã‚’æ²è¼‰ã—ã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-console highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;rake batch:original
&lt;span class=&quot;go&quot;&gt;Time: 339.42 secs
Memory: 2219.72 MB
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å®Ÿè¡Œæ™‚é–“ã¯340ç§’ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¯2200MBç¨‹ã§ã—ãŸã€‚ä»Šå›ã®æœ€é©åŒ–ã®ã‚´ãƒ¼ãƒ«ã¯ &lt;strong&gt;ã“ã®å‡¦ç†æ™‚é–“ã‚’ã§ãã‚‹ã ã‘é€Ÿãã—ã¦ã€ã‚ã‚ã›ã¦ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚‚æŠ‘ãˆã‚‹ã“ã¨ã§ã™ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ã§ã¯æ—©é€Ÿã“ã®ã‚³ãƒ¼ãƒ‰ã‚’æœ€é©åŒ–ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æœ€é©åŒ–1-ç°¡å˜ãªæœ€é©åŒ–&quot;&gt;æœ€é©åŒ–1: ç°¡å˜ãªæœ€é©åŒ–&lt;/h2&gt;

&lt;p&gt;ã¾ãšã¯ç°¡å˜ãªæœ€é©åŒ–ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚æ—¥ä»˜ã®æ¯”è¼ƒã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;String&lt;/code&gt;ã‚’ä½¿ã†ã‚ˆã‚Šã‚‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Date&lt;/code&gt;ã‚¯ãƒ©ã‚¹ã‚’ä½¿ã£ãŸã»ã†ãŒé€Ÿãã†ã§ã™ã€‚ã¾ãŸã€ãƒ«ãƒ¼ãƒ—ã®ä¸­ã§ä½•åº¦ã‚‚åŒã˜å€¤ãŒä½¿ã‚ã‚Œã‚‹ã®ã‚‚è‰¯ããªã„ã®ã§å®šæ•°ã«åˆ‡ã‚Šå‡ºã—ã¡ã‚ƒã„ã¾ã—ã‚‡ã†ã€‚çµæœã€ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Task: batch:improvement1&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;POINT_DATE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2017&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;created_at&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;POINT_DATE&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;point&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯-1&quot;&gt;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯&lt;/h3&gt;

&lt;p&gt;ã•ã¦è¨ˆæ¸¬çµæœã§ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-console highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;rake batch:improvement1
&lt;span class=&quot;go&quot;&gt;Time: 320.0 secs
Memory: 2244.71 MB
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¯å¤‰ã‚ã‚‰ãšã€å®Ÿè¡Œæ™‚é–“ã¯10æ•°ç§’ç¨‹åº¦é€Ÿããªã£ãŸãã‚‰ã„ã§ã—ã‚‡ã†ã‹ã€‚å°ã•ãªæœ€é©åŒ–ãƒ¬ãƒ™ãƒ«ã§ã¾ã ã¾ã å…¨ç„¶é€Ÿããªã£ãŸã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æœ€é©åŒ–2-where--each-ã‚’ä½¿ã†&quot;&gt;æœ€é©åŒ–2: where &amp;amp; each ã‚’ä½¿ã†&lt;/h2&gt;

&lt;p&gt;æ¬¡ã¯ã‚‚ã†å°‘ã—æœ¬æ ¼çš„ãªæœ€é©åŒ–ã‚’å…¥ã‚Œã¦ã„ãã¾ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;p&gt;ã¾ãšã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User.all.each&lt;/code&gt;ã§å…¨ä»¶ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã—ã¦ã„ã‚‹ç‚¹ãŒçœŸã£å…ˆã«æ°—ã«ãªã‚‹ã¨ã“ã‚ã§ã™ã€‚ã“ã‚Œã¯ &lt;strong&gt;å…¨ä»¶å–å¾—ã›ãš2017å¹´ä»¥é™ã®ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚ã‚‰ã‹ã˜ã‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã—ã¦ã‹ã‚‰ãƒ«ãƒ¼ãƒ—ã•ã›ã‚‹&lt;/strong&gt; ã»ã†ãŒè‰¯ã•ãã†ã§ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Task: batch:improvement2&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;created_at &amp;gt;= ?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;POINT_DATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;point&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã‚ã‚‰ã‹ã˜ã‚å‡¦ç†å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã ã‘ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§ãã¦ã„ã‚‹ã®ã§ã€ãƒ«ãƒ¼ãƒ—å†…ã®&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;if&lt;/code&gt;ã‚‚æ¶ˆã™ã“ã¨ãŒã§ãã¾ã—ãŸã€‚&lt;/p&gt;

&lt;h3 id=&quot;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯-2&quot;&gt;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯&lt;/h3&gt;

&lt;div class=&quot;language-console highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;rake batch:improvement2
&lt;span class=&quot;go&quot;&gt;Time: 294.35 secs
Memory: 1623.5 MB
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å®Ÿè¡Œæ™‚é–“ãŒå‰ã®çµæœã‚ˆã‚Š20ç§’ç¨‹æ”¹å–„ã€ãƒ¡ãƒ¢ãƒªæ¶ˆè²»ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å…¨ä»¶å–å¾—ã™ã‚‹å¿…è¦ãŒãªããªã£ãŸåˆ†ã€500MBç¨‹ç©ºãã¾ã—ãŸã€‚è‰¯ã„æ„Ÿã˜ã§ã™ã­ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æœ€é©åŒ–3-find_each-ã‚’ä½¿ã†&quot;&gt;æœ€é©åŒ–3: find_each ã‚’ä½¿ã†&lt;/h2&gt;

&lt;p&gt;ã¡ã‚‡ã£ã¨å¾…ã£ã¦ä¸‹ã•ã„ã€å¤§é‡ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€åº¦ã«ãƒ­ãƒ¼ãƒ‰ã—ãªãã¦ã‚‚ã„ã„ã‚ˆã†ã«ã€ActiveRecordãŒ&lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/Batches.html#method-i-find_each&quot;&gt;find_each&lt;/a&gt;ã¨ã„ã†ä¾¿åˆ©ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã‚‹ã®ã§ã—ãŸã€‚ã“ã‚Œã‚’ä½¿ã‚ãªã„æ‰‹ã¯ãªã„ã§ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Task: batch:improvement3&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;created_at &amp;gt;= ?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;POINT_DATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find_each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;point&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã“ã‚Œã§å°‘ã—ã¤ã¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦å‡¦ç†ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€ãƒ¡ãƒ¢ãƒªã«å„ªã—ã„ã‚³ãƒ¼ãƒ‰ã«ãªã£ãŸã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯-3&quot;&gt;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ rake batch:improvement3
Time: 290.88 secs
Memory: 31.41 MB
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å®Ÿè¡Œæ™‚é–“ãŒå‰ã®çµæœã¨å¤‰ã‚ã‚‰ãªã„ã“ãã™ã‚Œã€&lt;strong&gt;ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¯å‰ã®çµæœã®50åˆ†ã®ä¸€ã¨ãªã‚Šã¾ã—ãŸã€‚&lt;/strong&gt; å¤§ããªæ”¹å–„ã¨è¨€ã£ã¦ã„ã„ã§ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æœ€é©åŒ–4-in_batches--update_all-ã‚’ä½¿ã†&quot;&gt;æœ€é©åŒ–4: in_batches &amp;amp; update_all ã‚’ä½¿ã†&lt;/h2&gt;

&lt;p&gt;ã“ã“ã§ä¸€ä»¶ä¸€ä»¶&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;update&lt;/code&gt;ãŒèµ°ã‚‹ç‚¹ãŒæ°—ã«ãªã£ã¦ãã¾ã—ãŸã€‚ãã“ã¯ActiveRecordã®&lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-update_all&quot;&gt;update_all&lt;/a&gt;ã‚’ä½¿ã£ã¦ã¾ã¨ã‚ã¦æ›´æ–°ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã’ã‚Œã°è§£æ±ºã§ããã†ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã¾ãŸ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;update_all&lt;/code&gt;ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ActiveRecord::Relation&lt;/code&gt;ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ãŒã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ActiveRecord::Relation&lt;/code&gt;ã‚’å…ˆã®&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;find_each&lt;/code&gt;ã®ã‚ˆã†ã«è¿”ã—ã¦ãã‚Œã‚‹ä¾¿åˆ©ãƒ¡ã‚½ãƒƒãƒ‰ãŒ&lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/Batches.html#method-i-in_batches&quot;&gt;in_batches&lt;/a&gt;ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;ã“ã®&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;in_batches&lt;/code&gt;ã¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;update_all&lt;/code&gt;ã‚’çµ„ã¿åˆã‚ã›ã¦å‡¦ç†ã—ã¦ã‚ã’ã‚Œã°åŠ¹ç‡è‰¯ãæ›´æ–°ã§ããã†ãªæ°—ãŒã—ã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Task: batch:improvement4&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;created_at &amp;gt;= ?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;POINT_DATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;in_batches&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;update_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;point = point + 100&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯-4&quot;&gt;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯&lt;/h3&gt;

&lt;div class=&quot;language-console highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;rake batch:improvement4
&lt;span class=&quot;go&quot;&gt;Time: 2.46 secs
Memory: 7.26 MB
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;å®Ÿè¡Œæ™‚é–“ãŒ100å€é€Ÿããªã‚Šã¾ã—ãŸã€‚&lt;/strong&gt; åŠ‡çš„ãªæ”¹å–„ã¨è¨€ã£ã¦ã„ã„ã§ã—ã‚‡ã†ã€‚ã¾ãŸãƒ¡ãƒ¢ãƒªã®ä½¿ç”¨é‡ã‚‚å‰ã®çµæœã‚ˆã‚Šã•ã‚‰ã«æŠ‘ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æœ€é©åŒ–5-where--update_all&quot;&gt;æœ€é©åŒ–5: where &amp;amp; update_all&lt;/h2&gt;

&lt;p&gt;å‹˜ã®è‰¯ã„æ–¹ãªã‚‰æ—¢ã«ãŠæ°—ã¥ãã§ã™ã­ã€‚â€¦ãƒã‚¤ã€å…ˆã®ã‚³ãƒ¼ãƒ‰ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;in_batches&lt;/code&gt;ã™ã‚‰ä¸è¦ã§ã™ã€‚å˜ç´”ã«updateå¯¾è±¡ã‚’&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;where&lt;/code&gt;ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã—ãŸä¸Šã§&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;update_all&lt;/code&gt;ã™ã‚Œã°è‰¯ã•ãã†ã§ã™ã€‚å‡ºæ¥ä¸ŠãŒã£ãŸã‚³ãƒ¼ãƒ‰ãŒã“ã¡ã‚‰ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Task: batch:improvement5&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;created_at &amp;gt;= ?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;POINT_DATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;update_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;point = point + 100&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸€è¡Œã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ¼ãƒ‰ã«ä»•ä¸ŠãŒã‚Šã¾ã—ãŸã€‚&lt;/p&gt;

&lt;h3 id=&quot;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯-5&quot;&gt;ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ rake batch:improvement5
Time: 0.78 secs
Memory: 0.82 MB
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;å®Ÿè¡Œæ™‚é–“ã¯å‰ã®çµæœã‚ˆã‚Š3å€æ—©ããªã‚Šã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚‚ã•ã‚‰ã«10åˆ†ã®ä¸€ã¾ã§æŠ‘ãˆã‚‰ã‚Œã¾ã—ãŸã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ã“ã‚Œã‚’ä»Šå›ã®æœ€é©åŒ–ã‚³ãƒ¼ãƒ‰ã®æœ€çµ‚å½¢ã¨ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;em&gt;è¿½è¨˜ã“ã“ã‹ã‚‰&lt;/em&gt;&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;en&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;ã“ã‚Œcreated_atã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒã‚ã‚ã†ãŒãªã‹ã‚ã†ãŒå…¨èˆã‚ã—ã¦1ç§’å¼±ã§çµ‚ã‚ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ãªã‚‰ã„ã„ã®ã ã‘ã©ã€ãã†ã ã¨ã—ã¦ã‚‚saveã‚’update_allã«ã—ãŸæ™‚ç‚¹ã§callbackãŒèµ·ããªããªã£ã¦å…ƒã¨ç­‰ä¾¡ã§ã¯ãªããªã‚‹ã‹ã‚‰ä»•äº‹ã§çœŸä¼¼ã™ã‚‹ã¨ãã¯è©³ã—ã„äººã«ã¡ã‚ƒã‚“ã¨ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã‚‚ã‚‰ã£ã¦ã‹ã‚‰æŠ•å…¥ã—ãŸã»ã†ãŒã‚ˆã•ãã†ã€‚&lt;/p&gt;&amp;mdash; Ryuta Kamizono (@kamipo) &lt;a href=&quot;https://twitter.com/kamipo/status/970574529452900352?ref_src=twsrc%5Etfw&quot;&gt;March 5, 2018&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;kamipoã•ã‚“ã‹ã‚‰ã”æŒ‡æ‘˜é ‚ã„ãŸã¨ãŠã‚Šã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;update_all&lt;/code&gt;ã¯é€šå¸¸ã®ActiveRecordã®æ›´æ–°ã¨ã¯ç•°ãªã‚Šcallback, validationã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã¨ã„ã†ä»•æ§˜ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚ã‚ˆã£ã¦ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ¼ãƒ‰ã¨ã¯ç­‰ä¾¡ãªå‡¦ç†ã§ã¯ç„¡ããªã£ã¦ã„ã‚‹ã®ã§ã€å®Ÿéš›ã®ç¾å ´ã«ãŠã„ã¦ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;save&lt;/code&gt;ã‹ã‚‰&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;update_all&lt;/code&gt;ã«å¤‰æ›´ã™ã‚‹éš›ã¯ã€Œæœ¬å½“ã«callback, validationã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã‚‚å¤§ä¸ˆå¤«ãªã‚“ã ã£ã‘ï¼Ÿã€ã¨ã„ã†ã“ã¨ã‚’ã—ã£ã‹ã‚Šè€ƒãˆã¦ã‹ã‚‰å®Ÿæ–½ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;it does not trigger Active Record callbacks or validations&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;http://api.rubyonrails.org/classes/ActiveRecord/Relation.html#method-i-update_all&lt;/p&gt;

&lt;p&gt;ãªãŠä»Šå›ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã§ã¯ãƒ¢ãƒ‡ãƒ«ã®callback, validationã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã‚‚å•é¡Œãªã„ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦è©±ã‚’é€²ã‚ã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;åŠ ãˆã¦ã€ä»Šå›ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æœ€é©åŒ–ã¯æœ€é©åŒ–ã®ç¯„å›²å¤–ã¨ã—ãŸã®ã§&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;created_at&lt;/code&gt;ã‚«ãƒ©ãƒ ã®indexã¯è²¼ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚å®Ÿéš›ã®ç¾å ´ã«ãŠã„ã¦ã¯Rubyã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®æœ€é©åŒ–ã«åŠ ãˆã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æœ€é©åŒ–ã‚‚è€ƒãˆã¦INDEXã‚’è²¼ã‚‹ã“ã¨ã‚‚æ¤œè¨ã—ãŸã»ã†ãŒã„ã„ã§ã—ã‚‡ã†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;è¿½è¨˜ã“ã“ã¾ã§&lt;/em&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;æœ€çµ‚çµæœ&quot;&gt;æœ€çµ‚çµæœ&lt;/h2&gt;

&lt;p&gt;ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ¼ãƒ‰ã¨æœ€é©åŒ–æ¸ˆã¿ã®æœ€çµ‚ã‚³ãƒ¼ãƒ‰ã‚’æ¯”è¼ƒã™ã‚‹ã¨ä¸‹è¨˜ã®é€šã‚Šã®æ”¹å–„ãŒç¢ºèªã§ãã¾ã—ãŸã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Â &lt;/th&gt;
      &lt;th&gt;å®Ÿè¡Œæ™‚é–“&lt;/th&gt;
      &lt;th&gt;ãƒ¡ãƒ¢ãƒªæ¶ˆè²»&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ¼ãƒ‰&lt;/td&gt;
      &lt;td&gt;339.42 secs&lt;/td&gt;
      &lt;td&gt;2219.72 MB&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;æœ€é©åŒ–ã‚³ãƒ¼ãƒ‰&lt;/td&gt;
      &lt;td&gt;0.78 secs&lt;/td&gt;
      &lt;td&gt;0.82 MB&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;æ”¹å–„çµæœ&lt;/td&gt;
      &lt;td&gt;:rocket: &lt;strong&gt;435å€é«˜é€ŸåŒ–&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;:recycle: &lt;strong&gt;ç´„2700åˆ†ã®ä¸€ã¾ã§çœãƒ¡ãƒ¢ãƒªåŒ–&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;activerecordãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã§ç™ºè¡¨ã—ã¾ã™&quot;&gt;ã€ŒActiveRecordãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã§ç™ºè¡¨ã—ã¾ã™&lt;/h2&gt;

&lt;p&gt;ä¸Šè¿°ã—ãŸã‚ˆã†ãªã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ¼ãƒ‰ã¯æ¥µç«¯ãªä¾‹ã§ã¯ã‚ã‚Šã¾ã™ãŒã€ActiveRecordã§ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã¨ãã¯ãã¡ã‚“ã¨é…ããªã‚‰ãªã„ã‚ˆã†ã«æ„è­˜ã—ã¦ãƒãƒƒãƒå‡¦ç†ã‚’æ›¸ã‹ãªã„ã¨æ¥µç«¯ã«é…ããªã£ã¦ã—ã¾ã†ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;ãã‚“ãªActiveRecordãƒ‡ãƒ¼ã‚¿å‡¦ç†ã§é™¥ã‚ŠãŒã¡ãªç½ ã‚’ãƒ‘ã‚¿ãƒ¼ãƒ³åŒ–ã—ä»Šæœˆã®Rails Develper Meetupã«ã¦ç™ºè¡¨ã™ã‚‹äºˆå®šã§ã™ã€‚ã”èˆˆå‘³ã‚ã‚Œã°æ˜¯éã€‚&lt;/p&gt;

&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;en&quot;&gt;&lt;p lang=&quot;ja&quot; dir=&quot;ltr&quot;&gt;3æœˆ25æ—¥ã«ã€ŒActiveRecordã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã€çš„ãªå†…å®¹ã§ç™ºè¡¨ã—ã¾ã™ãƒ¼ | Rails Developers Meetup 2018: Day 2ï½œITå‹‰å¼·ä¼šãªã‚‰TECH PLAYï¼»ãƒ†ãƒƒã‚¯ãƒ—ãƒ¬ã‚¤ï¼½ &lt;a href=&quot;https://t.co/QJgdMF92Sr&quot;&gt;https://t.co/QJgdMF92Sr&lt;/a&gt;&lt;/p&gt;&amp;mdash; toshimaru (@toshimaru_e) &lt;a href=&quot;https://twitter.com/toshimaru_e/status/960340809005506561?ref_src=twsrc%5Etfw&quot;&gt;February 5, 2018&lt;/a&gt;&lt;/blockquote&gt;

&lt;h2 id=&quot;å‚è€ƒãƒªãƒ³ã‚¯&quot;&gt;å‚è€ƒãƒªãƒ³ã‚¯&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/Relation.html&quot;&gt;ActiveRecord::Relation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/Batches.html&quot;&gt;ActiveRecord::Batches&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Toshimaru</name></author><category term="rails" /><category term="activerecord" /><summary type="html">Railsã®ãƒãƒƒãƒå‡¦ç†æœ€é©åŒ–ã®è¨˜äº‹æ›¸ã„ãŸã‚‰éœ€è¦ã‚ã‚‹ã‹ãª&amp;mdash; toshimaru (@toshimaru_e) December 2, 2017</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/railsdm/ar-optimization.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/railsdm/ar-optimization.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Railsã®find_eachã®æŒ™å‹•ã«ã¤ã„ã¦èª¿ã¹ãŸ</title><link href="https://blog.toshimaru.net/rails-find_each/" rel="alternate" type="text/html" title="Railsã®find_eachã®æŒ™å‹•ã«ã¤ã„ã¦èª¿ã¹ãŸ" /><published>2015-11-12T00:00:00+09:00</published><updated>2015-11-12T00:00:00+09:00</updated><id>https://blog.toshimaru.net/rails-find_each</id><content type="html" xml:base="https://blog.toshimaru.net/rails-find_each/">&lt;p&gt;Railsã®&lt;a href=&quot;http://apidock.com/rails/ActiveRecord/Batches/ClassMethods/find_each&quot;&gt;find_each&lt;/a&gt;ãŒã©ã‚“ãªæŒ™å‹•ã‚’ã™ã‚‹ã‹æ°—ã«ãªã£ãŸã®ã§èª¿ã¹ã¦ã¿ãŸã€‚&lt;/p&gt;

&lt;h2 id=&quot;find_each-ã¨ã¯&quot;&gt;find_each ã¨ã¯&lt;/h2&gt;

&lt;p&gt;ãƒãƒƒãƒå‡¦ç†ãªã©ã«ãŠã„ã¦ActiveRecordã§åŠ¹ç‡çš„ã«å¤§é‡ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã—ãŸã„ã¨ãã«ä½¿ã†ãƒ¡ã‚½ãƒƒãƒ‰ã€‚å¤§é‡ãƒ‡ãƒ¼ã‚¿ã¾ã‚‹ã£ã¨å…¨éƒ¨å–ã£ã¦ãã¦ãƒ¡ãƒ¢ãƒªå±•é–‹ã—ã¦å‡¦ç†ã—ã¡ã‚ƒã‚ã‚¢ã‚«ãƒ³ã‚ˆã­ã£ã¦ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’å¾ã€…ã«å±•é–‹ã—ã¦å‡¦ç†ã—ãŸã„ã¨ãã«ä½¿ã†ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Railsã«ã¯ find_each ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚é€šå¸¸ã® each ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦ãƒ¡ãƒ¢ãƒªã«å±•é–‹ã—ã¦ã‹ã‚‰å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™ã€‚ãã®ãŸã‚ã€ååˆ†ã«ãƒ¡ãƒ¢ãƒªã«è¼‰ã‚‹ãƒ‡ãƒ¼ã‚¿é‡ã§ã‚ã‚Œã°ä½•ã‚‚å•é¡Œãªã„ã§ã™ãŒã€æ•°ç™¾ä¸‡ã€æ•°åƒä¸‡ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿é‡ã«ãªã£ã¦ãã‚‹ã¨ãƒ¡ãƒ¢ãƒªã«è¼‰ã‚Šãã‚‰ãšã«æº¢ã‚Œã¦ã—ã¾ã£ã¦å¤§å¤‰ãªã“ã¨ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;find: å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒ¢ãƒªã«å±•é–‹ã—ã¦ã‹ã‚‰å‡¦ç†&lt;/li&gt;
    &lt;li&gt;find_each: å°‘ã—ãšã¤ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒ¢ãƒªã«å±•é–‹ã—ã¤ã¤å‡¦ç†&lt;/li&gt;
  &lt;/ul&gt;

  &lt;p&gt;ãã†ã„ã†ã¨ãã«ã¯ find_each ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.livedoor.jp/sasata299/archives/51882704.html&quot;&gt;Railsã§å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦æ›´æ–°ã™ã‚‹ãªã‚‰find_eachä½¿ã†ã‚ˆã­ - (ï¾Ÿâˆ€ï¾Ÿ)oå½¡ sasata299â€™s blog&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;ç´ ã®-find_each&quot;&gt;ç´ ã® find_each&lt;/h2&gt;

&lt;p&gt;ã¾ãšã¯Userãƒ†ãƒ¼ãƒ–ãƒ«ã«1ä¸‡ä»¶ãã‚‰ã„ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã£ã¦ç´ ç›´ã«&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;find_each&lt;/code&gt;ã—ã¦ã¿ã‚‹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; User.find_each{|a|}
  User Load (2.7ms)  SELECT  `users`.* FROM `users`  ORDER BY `users`.`id` ASC LIMIT 1000
  User Load (2.6ms)  SELECT  `users`.* FROM `users` WHERE (`users`.`id` &amp;gt; 1001)  ORDER BY `users`.`id` ASC LIMIT 1000
  User Load (4.7ms)  SELECT  `users`.* FROM `users` WHERE (`users`.`id` &amp;gt; 2001)  ORDER BY `users`.`id` ASC LIMIT 1000
  ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ORDER BY id&lt;/code&gt;ã§å…¨ä»¶å–å¾—ã—ã¦1000ä»¶ãšã¤åˆ†å‰²(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;limit 1000&lt;/code&gt;)ã—ã¦å‡¦ç†ã—ã¦ã„ãã‚ˆã†ãªã‹ãŸã¡ã€‚&lt;/p&gt;

&lt;h2 id=&quot;orderä»˜ã-find_each&quot;&gt;orderä»˜ã find_each&lt;/h2&gt;

&lt;p&gt;ã§ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;order&lt;/code&gt;ã‚’ä»˜ã‘ã¦&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;find_each&lt;/code&gt;ã—ãŸã‚‰ã©ã†ãªã‚‹ã®ã ã‚ã†ï¼Ÿ&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; User.order(created_at: :desc).find_each{|a|}
Scoped order and limit are ignored, it's forced to be batch order and batch size
  User Load (3.8ms)  SELECT  `users`.* FROM `users`  ORDER BY `users`.`id` ASC LIMIT 1000
  User Load (3.0ms)  SELECT  `users`.* FROM `users` WHERE (`users`.`id` &amp;gt; 1001)  ORDER BY `users`.`id` ASC LIMIT 1000
  User Load (2.3ms)  SELECT  `users`.* FROM `users` WHERE (`users`.`id` &amp;gt; 2001)  ORDER BY `users`.`id` ASC LIMIT 1000
  ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Scoped order and limit are ignored&lt;/code&gt;ã¨ã„ã†ã“ã¨ã§&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;order&lt;/code&gt;ã¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;limit&lt;/code&gt;ã¯ç„¡è¦–ã•ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;limitä»˜ã-find_each&quot;&gt;limitä»˜ã find_each&lt;/h2&gt;

&lt;p&gt;ã˜ã‚ƒã‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;limit&lt;/code&gt;ã‚‚è©¦ã—ã¦ã¿ã‚ˆã†ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; User.limit(2000).find_each{|a|}
Scoped order and limit are ignored, it's forced to be batch order and batch size
  User Load (3.0ms)  SELECT  `users`.* FROM `users`  ORDER BY `users`.`id` ASC LIMIT 1000
  User Load (3.5ms)  SELECT  `users`.* FROM `users` WHERE (`users`.`id` &amp;gt; 11003)  ORDER BY `users`.`id` ASC LIMIT 1000
  User Load (3.4ms)  SELECT  `users`.* FROM `users` WHERE (`users`.`id` &amp;gt; 12003)  ORDER BY `users`.`id` ASC LIMIT 1000
  ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã‚„ã£ã±ã‚Šãƒ¯ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ç„¡è¦–ã•ã‚ŒãŸã€‚&lt;/p&gt;

&lt;h2 id=&quot;whereä»˜ã-find_each&quot;&gt;whereä»˜ã find_each&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;where&lt;/code&gt;ã‚’ä½¿ã£ã¦å‡¦ç†å¯¾è±¡ã«æ¡ä»¶ã‚’ä»˜ã‘ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; User.where(notes: &quot;1&quot;).find_each{|a|}
  User Load (4.3ms)  SELECT  `users`.* FROM `users` WHERE `users`.`notes` = '1'  ORDER BY `users`.`id` ASC LIMIT 1000
  User Load (4.8ms)  SELECT  `users`.* FROM `users` WHERE `users`.`notes` = '1' AND (`users`.`id` &amp;gt; 11955)  ORDER BY `users`.`id` ASC LIMIT 1000
  User Load (4.9ms)  SELECT  `users`.* FROM `users` WHERE `users`.`notes` = '1' AND (`users`.`id` &amp;gt; 13954)  ORDER BY `users`.`id` ASC LIMIT 1000
  User Load (4.7ms)  SELECT  `users`.* FROM `users` WHERE `users`.`notes` = '1' AND (`users`.`id` &amp;gt; 18067)  ORDER BY `users`.`id` ASC LIMIT 1000
  ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã—ã£ã‹ã‚Šå…¨ã¦ã®ã‚¯ã‚¨ãƒªã«&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;users&lt;/code&gt;.&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;notes&lt;/code&gt; = â€˜1â€™ã¨ã„ã†æ¡ä»¶ãŒä»˜ã„ã¦ã„ã¾ã™ã­ã€‚&lt;/p&gt;

&lt;p&gt;ã¨ã“ã‚ã§ã€ã“ã®`users`.`id` &amp;gt; 11955 ã®&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;11955&lt;/code&gt;ã¨ã„ã†idã¯ã©ã“ã‹ã‚‰å‡ºã¦ããŸã‚“ã ã‚ã†ï¼Ÿ&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;records&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;any?&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;records_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;records&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;size&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;primary_key_offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;records&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;last&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;id&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Primary key not included in the custom select clause&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;primary_key_offset&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;records&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;records_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;records&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;relation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;primary_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;primary_key_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_a&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ãƒã‚¤ãƒ³ãƒˆã¨ãªã£ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ç®‡æ‰€ã‚’æŠœãå‡ºã™ã¨ã“ã“ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;primary_key_offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;records&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;last&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;relation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;primary_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;primary_key_offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æœ€åˆã«å–å¾—ã—ãŸ1000ä»¶ã®ã†ã¡ã®&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;last.id&lt;/code&gt;ã‚’å–å¾—ã—ã¦ãã‚Œã‚ˆã‚Šå¤§ãã„idã‚’æ¡ä»¶ã¨ã—ã¦æ¬¡ã®1000ä»¶ã‚’å–å¾—ã™ã‚‹ã€ã¨ã„ã†ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ã¾ã¨ã‚&quot;&gt;ã¾ã¨ã‚&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;find_eachã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§1000ä»¶ãšã¤å‡¦ç†ã™ã‚‹&lt;/li&gt;
  &lt;li&gt;find_eachã«ãŠã„ã¦orderã¨limitã¯ç„¡è¦–ã•ã‚Œã‚‹&lt;/li&gt;
  &lt;li&gt;whereä»˜ãã®å ´åˆã¯1000ä»¶å–å¾—ã—ã¦ãã®ä¸­ã®last.idã‚’ä½¿ã£ã¦ã•ã‚‰ã«æ¬¡ã®1000ä»¶ã‚’å–å¾—ã—ã¦ãƒ«ãƒ¼ãƒ—ã‚’å›ã—ã¦ã„ã&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;å‚è€ƒ&quot;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/Batches.html&quot;&gt;ActiveRecord::Batches&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Toshimaru</name></author><category term="rails" /><category term="activerecord" /><summary type="html">Railsã®find_eachãŒã©ã‚“ãªæŒ™å‹•ã‚’ã™ã‚‹ã‹æ°—ã«ãªã£ãŸã®ã§èª¿ã¹ã¦ã¿ãŸã€‚</summary></entry><entry><title type="html">SQLãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹Rails DBã‚¹ã‚­ãƒ¼ãƒç®¡ç†</title><link href="https://blog.toshimaru.net/manage-schema-with-sql-in-rails/" rel="alternate" type="text/html" title="SQLãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã‚‹Rails DBã‚¹ã‚­ãƒ¼ãƒç®¡ç†" /><published>2015-07-03T00:00:00+09:00</published><updated>2019-11-10T00:00:00+09:00</updated><id>https://blog.toshimaru.net/manage-schema-with-sql-in-rails</id><content type="html" xml:base="https://blog.toshimaru.net/manage-schema-with-sql-in-rails/">&lt;p&gt;Railsã§ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;db:migrate&lt;/code&gt;ã™ã‚‹ã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;db/schema.rb&lt;/code&gt;ã‚’ç”Ÿæˆã—ã¾ã™ãŒã€SQLã§ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ã«&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config/application.rb&lt;/code&gt;å†…ã§&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;active_record.schema_format&lt;/code&gt;ã‚’&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:sql&lt;/code&gt;ã¨è¨­å®šã™ã‚‹ã“ã¨ã§å¯èƒ½ã«ãªã‚Šã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:ruby&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# config/application.rb&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;RailsApp&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Application&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Application&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;active_record&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;schema_format&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:sql&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã“ã‚Œã§&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;db/migrate&lt;/code&gt;ã™ã‚‹ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;schema.rb&lt;/code&gt;ã§ã¯ãªãã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;db/structure.sql&lt;/code&gt;ã¨ã„ã†SQLãƒ•ã‚¡ã‚¤ãƒ«ã‚’åãã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;structuresqlã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹&quot;&gt;structure.sqlã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹&lt;/h2&gt;

&lt;p&gt;ç”Ÿæˆã•ã‚ŒãŸ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;structure.sql&lt;/code&gt;ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-console highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;rails db:structure:load
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;sqlãƒ•ã‚¡ã‚¤ãƒ«ã ã‘æ¬²ã—ã„å ´åˆ&quot;&gt;SQLãƒ•ã‚¡ã‚¤ãƒ«ã ã‘æ¬²ã—ã„å ´åˆ&lt;/h2&gt;

&lt;p&gt;SQLãƒ€ãƒ³ãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒæ¬²ã—ã„å ´åˆã¯ã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config.active_record.schema_format&lt;/code&gt;ã®è¨­å®šã‚’å¤‰ãˆãšã¨ã‚‚ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;structure.sql&lt;/code&gt;ã®ã¿ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-console highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;rails db:structure:dump
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å‚è€ƒ&quot;&gt;å‚è€ƒ&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://tech-kazuhisa.hatenablog.com/entry/20130902/1378126825&quot;&gt;schema.rbã˜ã‚ƒãªãã¦structure.sqlã§ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ã‚’ç®¡ç†ã—ã‚ˆã† - tech-kazuhisaâ€™s blog&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://edgeguides.rubyonrails.org/active_record_migrations.html#types-of-schema-dumps&quot;&gt;Active Record Migrations â€” Ruby on Rails Guides&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Toshimaru</name></author><category term="rails" /><category term="activerecord" /><summary type="html">Railsã§ã¯db:migrateã™ã‚‹ã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§db/schema.rbã‚’ç”Ÿæˆã—ã¾ã™ãŒã€SQLã§ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ä¸‹è¨˜ã®ã‚ˆã†ã«config/application.rbå†…ã§active_record.schema_formatã‚’:sqlã¨è¨­å®šã™ã‚‹ã“ã¨ã§å¯èƒ½ã«ãªã‚Šã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯:rubyï¼‰ã€‚</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/schema_format-sql-og.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/schema_format-sql-og.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">ActiveRecordã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®é †åºãƒ»ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å†…ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã«ã¤ã„ã¦</title><link href="https://blog.toshimaru.net/active-record-callbacks/" rel="alternate" type="text/html" title="ActiveRecordã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®é †åºãƒ»ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å†…ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã«ã¤ã„ã¦" /><published>2015-03-01T00:00:00+09:00</published><updated>2015-03-01T00:00:00+09:00</updated><id>https://blog.toshimaru.net/active-record-callbacks</id><content type="html" xml:base="https://blog.toshimaru.net/active-record-callbacks/">&lt;p&gt;ActiveRecordã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹é †åºã€ãŠã‚ˆã³ãã‚Œã‚‰ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ãŸã‚ã®ã‚„ã‚Šæ–¹ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚&lt;/p&gt;

&lt;h2 id=&quot;callback-ã‚¿ã‚¤ãƒŸãƒ³ã‚°&quot;&gt;Callback ã‚¿ã‚¤ãƒŸãƒ³ã‚°&lt;/h2&gt;

&lt;p&gt;ã¾ãšã¯é †åºã«ã¤ã„ã¦ã€‚ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;before_validation&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;after_validation&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;before_save&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;before_create&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;before_update&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;after_create&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;after_update&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;after_save&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;after_commit&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã§è©¦ã—ã¦ã¿ã‚‹&quot;&gt;å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã§è©¦ã—ã¦ã¿ã‚‹&lt;/h2&gt;

&lt;p&gt;ãã‚Œãã‚Œã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã‚³ãƒ¼ãƒ‰ã§è©¦ã—ã¦ã¿ã‚‹ã€‚ã“ã‚“ãªã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¨­å®šã—ãŸUserãƒ¢ãƒ‡ãƒ«ã‚’ä½œã‚‹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_validation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before_validation is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_validation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_validation is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_save&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before_save is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_update&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before_update is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_create&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before_create is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_create&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_create is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_update&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_update is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_save&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_save is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_commit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_commit is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æ–°è¦ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ™‚&quot;&gt;æ–°è¦ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ™‚&lt;/h3&gt;

&lt;p&gt;ã“ã®ãƒ¢ãƒ‡ãƒ«ã‚’newã—ã¦saveã—ã¦ã¿ã‚‹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; User.new.save
   (0.1ms)  begin transaction
before_validation is called
after_validation is called
before_save is called
before_create is called
  SQL (0.6ms)  INSERT INTO &quot;users&quot; (&quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?)  [[&quot;created_at&quot;, &quot;2015-02-28 15:53:53.000058&quot;], [&quot;updated_at&quot;, &quot;2015-02-28 15:53:53.000058&quot;]]
after_create is called
after_save is called
   (485.3ms)  commit transaction
after_commit is called
 =&amp;gt; true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ–°è¦ä½œæˆãªã®ã§ã€æ›´æ–°æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ã‚ã‚‹&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;before_update&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;after_update&lt;/code&gt;ã¯å‘¼ã°ã‚Œãªã„ã€‚&lt;/p&gt;

&lt;p&gt;ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒé–‹å§‹ã•ã‚Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;before_create&lt;/code&gt;å¾Œã«ã‚¯ã‚¨ãƒªãŒèµ°ã‚‹ã€‚ãã®å¾Œã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;after_save&lt;/code&gt;ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã°ã‚Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°æ™‚&quot;&gt;ãƒ¬ã‚³ãƒ¼ãƒ‰æ›´æ–°æ™‚&lt;/h3&gt;

&lt;p&gt;åŒãƒ¢ãƒ‡ãƒ«ã®updateã®å ´åˆã¯ã“ã‚“ãªæ„Ÿã˜ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; user.update(name: &quot;toshi&quot;)
  (0.1ms)  begin transaction
before_validation is called
after_validation is called
before_save is called
before_update is called
 SQL (0.3ms)  UPDATE &quot;users&quot; SET &quot;name&quot; = ?, &quot;updated_at&quot; = ? WHERE &quot;users&quot;.&quot;id&quot; = ?  [[&quot;name&quot;, &quot;toshi&quot;], [&quot;updated_at&quot;, &quot;2016-01-21 08:04:19.290079&quot;], [&quot;id&quot;, 1]]
after_update is called
after_save is called
   (2.5ms)  commit transaction
after_commit is called
=&amp;gt; true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ›´æ–°ãªã®ã§ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;before_create&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;after_create&lt;/code&gt; ã¯å‘¼ã°ã‚Œãªã„ã€‚ãã®ä»£ã‚ã‚Šã«&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;before_update&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;after_update&lt;/code&gt;ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;h2 id=&quot;saveupdate-ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å®Ÿè¡Œã•ã‚Œã‚‹&quot;&gt;save/update ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å®Ÿè¡Œã•ã‚Œã‚‹&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/Callbacks.html&quot;&gt;ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ&lt;/a&gt;ã«ã¯ã“ã†æ›¸ã„ã¦ã‚ã‚‹ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The entire callback chain of a save, save!, or destroy call runs within a transaction. That includes after_* hooks. If everything goes fine a COMMIT is executed once the chain has been completed.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ã¤ã¾ã‚Šã€&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;save&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;save!&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;destroy&lt;/code&gt;ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç¾¤ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å‡¦ç†ã•ã‚Œã€å…¨ã¦ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå•é¡Œãªãé€šã‚Œã°ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¾ã™ã‚ˆã€ã¨ã€‚&lt;/p&gt;

&lt;h2 id=&quot;ç‰¹å®šã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å‡¦ç†ã‚’ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã›ãŸã„&quot;&gt;ç‰¹å®šã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å‡¦ç†ã‚’ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã›ãŸã„&lt;/h2&gt;

&lt;p&gt;ãã‚Œã‚‰ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ã®ä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã€‚ã©ã†ã‚„ã‚Œã°è‰¯ã„ã®ã‹èª¿ã¹ã¦ã¿ãŸã€‚&lt;/p&gt;

&lt;h3 id=&quot;before_-ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹å ´åˆ&quot;&gt;before_* ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹å ´åˆ&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;before_*&lt;/code&gt;ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ false ã‚’è¿”ã™ã¨å‡¦ç†ã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã‚Œã‚‹ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_validation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before_validation is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_validation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_validation is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_save&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before_save is called&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_create&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before_create is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_create&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_create is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_save&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_save is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_commit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_commit is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; User.new.save
(0.1ms)  begin transaction
before_validation is called
after_validation is called
before_save is called
(0.1ms)  rollback transaction
=&amp;gt; false
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã—ã‹ã—&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;after_*&lt;/code&gt;ã§ false ã‚’è¿”ã—ã¦ã‚‚å‡¦ç†ã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã‚Œãªã„ã‚ˆã†ã ã€‚&lt;/p&gt;

&lt;h3 id=&quot;after_-ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹å ´åˆ&quot;&gt;after_* ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹å ´åˆ&lt;/h3&gt;

&lt;p&gt;after_* ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ãŸã„å ´åˆã¯ã€æ˜ç¤ºçš„ã«Rollbackã‚’raiseã—ã¦ã‚„ã‚Œã° :ok:&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_validation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before_validation is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_validation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_validation is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_save&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before_save is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;before_create&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;before_create is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_create&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_create is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_save&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_save is called&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Rollback&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;after_commit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;after_commit is called&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; User.new.save
   (0.1ms)  begin transaction
before_validation is called
after_validation is called
before_save is called
before_create is called
  SQL (0.4ms)  INSERT INTO &quot;users&quot; (&quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?)  [[&quot;created_at&quot;, &quot;2015-02-28 16:49:35.344885&quot;], [&quot;updated_at&quot;, &quot;2015-02-28 16:49:35.344885&quot;]]
after_create is called
after_save is called
   (2.4ms)  rollback transaction
 =&amp;gt; nil
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;update ã‚‚åŒæ§˜ã«ã“ã®æ–¹æ³•ã§ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ãã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å‚è€ƒ&quot;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/Callbacks.html&quot;&gt;ActiveRecord::Callbacks&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.techscore.com/blog/2012/12/25/rails%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%BE%E3%81%A8%E3%82%81/&quot;&gt;Â» Railsã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¾ã¨ã‚ TECHSCORE BLOG&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Toshimaru</name></author><category term="rails" /><category term="activerecord" /><summary type="html">ActiveRecordã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹é †åºã€ãŠã‚ˆã³ãã‚Œã‚‰ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ãŸã‚ã®ã‚„ã‚Šæ–¹ã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚</summary></entry><entry><title type="html">Rails ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šã™ã‚‹æ–¹æ³•</title><link href="https://blog.toshimaru.net/rails-4-transaction-isolation/" rel="alternate" type="text/html" title="Rails ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šã™ã‚‹æ–¹æ³•" /><published>2015-01-19T00:00:00+09:00</published><updated>2019-09-21T00:00:00+09:00</updated><id>https://blog.toshimaru.net/rails-4-transaction-isolation</id><content type="html" xml:base="https://blog.toshimaru.net/rails-4-transaction-isolation/">&lt;div class=&quot;info&quot;&gt;
  &lt;h5&gt;è¿½è¨˜&lt;/h5&gt;
  &lt;p&gt;Rails5, Rails6 å‘ã‘ã«è¨˜äº‹ã®å†…å®¹ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã—ãŸï¼ˆ2019/09/21ï¼‰&lt;/p&gt;
&lt;/div&gt;

&lt;h2 id=&quot;mysqlã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«&quot;&gt;MySQLã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«&lt;/h2&gt;

&lt;p&gt;çªç„¶ã§ã™ãŒå•é¡Œã§ã™ã€‚MySQLã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;REPEATABLE READ&lt;/strong&gt;&lt;/p&gt;

  &lt;p&gt;This is the default isolation level for InnoDB.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;via. &lt;a href=&quot;https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html#isolevel_repeatable-read&quot;&gt;MySQL :: MySQL 8.0 Reference Manual :: 15.7.2.1 Transaction Isolation Levels&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ãƒã‚¤ã€ç­”ãˆã¯ã€Œ&lt;strong&gt;REPEATABLE READ&lt;/strong&gt;ã€ã§ã™ãƒã€‚&lt;/p&gt;

&lt;h2 id=&quot;railsã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®š&quot;&gt;Railsã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®š&lt;/h2&gt;

&lt;p&gt;ç¶šã„ã¦ã®å•é¡Œã§ã™ã€‚Railsã«ãŠã„ã¦ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šã™ã‚‹ã«ã¯ã©ã†ã—ãŸã‚‰ã‚ˆã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ å®Ÿã¯ Rails 3 ã¨ Rails 4 ã¨ Rails 5 ä»¥é™ã§ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã®è¨­å®šæ–¹æ³•ã¯ãã‚Œãã‚Œç•°ãªã£ã¦ã„ã¾ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;rails-3&quot;&gt;Rails 3&lt;/h3&gt;

&lt;p&gt;Rails 3ã®æ™‚ä»£ã§ã¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;execute&lt;/code&gt; ã§ç›´æ¥ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'SET TRANSACTION ISOLATION LEVEL READ COMMITTED'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;transaction&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;rails-4x&quot;&gt;Rails 4.x&lt;/h3&gt;

&lt;p&gt;Rails 4ã‹ã‚‰ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;transaction&lt;/code&gt;ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®šå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;transaction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;isolation: :read_committed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;rails-5-ä»¥é™&quot;&gt;Rails 5 ä»¥é™&lt;/h3&gt;

&lt;p&gt;Rails 5ã‹ã‚‰ã¯ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ActiveRecord::Base&lt;/code&gt; ã®ä»£ã‚ã‚Šã« &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ApplicationRecord&lt;/code&gt; ãŒä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ApplicationRecord is a new superclass for all app models&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;via. &lt;a href=&quot;https://edgeguides.rubyonrails.org/5_0_release_notes.html&quot;&gt;Ruby on Rails 5.0 Release Notes â€” Ruby on Rails Guides&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;transaction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;isolation: :read_committed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; 
  &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;update!&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;name: &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;TEST&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ pry ã§å®Ÿè¡Œã—ãŸéš›ã«æµã‚Œã‚‹ã‚¯ã‚¨ãƒªã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   (0.5ms)  SET TRANSACTION ISOLATION LEVEL READ COMMITTED
   (0.3ms)  BEGIN
  User Load (0.9ms)  SELECT  `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1 FOR UPDATE
  User Update (0.4ms)  UPDATE `users` SET `name` = 'TEST', `updated_at` = '2019-09-20 16:34:31' WHERE `users`.`id` = 1
   (1.5ms)  COMMIT
=&amp;gt; true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;æœ‰åŠ¹ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«&quot;&gt;æœ‰åŠ¹ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«&lt;/h2&gt;

&lt;p&gt;Railsã§è¨­å®šå¯èƒ½ã‹ã¤æœ‰åŠ¹ãª&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;isolation&lt;/code&gt;ãƒ¬ãƒ™ãƒ«ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿã€€ç­”ãˆã¯ä¸‹è¨˜ï¼”ã¤ã«ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Valid isolation levels are:&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:read_uncommitted&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:read_committed&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:repeatable_read&lt;/code&gt;&lt;/li&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;:serializable&lt;/code&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;via. &lt;a href=&quot;https://railsdoc.github.io/classes/ActiveRecord/ConnectionAdapters/DatabaseStatements.html#method-i-transaction-label-Transaction+isolation&quot;&gt;ActiveRecord::ConnectionAdapters::DatabaseStatements | RailsDoc&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã¨ãƒ€ãƒ¼ãƒ†ã‚£ãƒªãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¸ãƒ¼ãƒªãƒ¼ãƒ‰ãƒ•ã‚¡ãƒ³ãƒˆãƒ ãƒªãƒ¼ãƒ‰ã®é–¢ä¿‚&quot;&gt;åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã¨ãƒ€ãƒ¼ãƒ†ã‚£ãƒªãƒ¼ãƒ‰ã€ãƒ•ã‚¡ã‚¸ãƒ¼ãƒªãƒ¼ãƒ‰ã€ãƒ•ã‚¡ãƒ³ãƒˆãƒ ãƒªãƒ¼ãƒ‰ã®é–¢ä¿‚&lt;/h2&gt;

&lt;p&gt;åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã¨ãƒ€ãƒ¼ãƒ†ã‚£ãƒªãƒ¼ãƒ‰ã€ãƒ•ã‚¡ã‚¸ãƒ¼ãƒªãƒ¼ãƒ‰ã€ãƒ•ã‚¡ãƒ³ãƒˆãƒ ãƒªãƒ¼ãƒ‰ãã‚Œãã‚Œã®é–¢ä¿‚æ€§ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«&lt;/th&gt;
      &lt;th&gt;ãƒ€ãƒ¼ãƒ†ã‚£ãƒªãƒ¼ãƒ‰&lt;/th&gt;
      &lt;th&gt;ãƒ•ã‚¡ã‚¸ãƒ¼ãƒªãƒ¼ãƒ‰&lt;/th&gt;
      &lt;th&gt;ãƒ•ã‚¡ãƒ³ãƒˆãƒ ãƒªãƒ¼ãƒ‰&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;READ UNCOMMITTED&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ğŸ’€ç™ºç”Ÿã™ã‚‹&lt;/td&gt;
      &lt;td&gt;ğŸ’€ç™ºç”Ÿã™ã‚‹&lt;/td&gt;
      &lt;td&gt;ğŸ’€ç™ºç”Ÿã™ã‚‹&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;READ COMMITTED&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ç™ºç”Ÿã—ãªã„&lt;/td&gt;
      &lt;td&gt;ğŸ’€ç™ºç”Ÿã™ã‚‹&lt;/td&gt;
      &lt;td&gt;ğŸ’€ç™ºç”Ÿã™ã‚‹&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;REPEATABLE READ&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ç™ºç”Ÿã—ãªã„&lt;/td&gt;
      &lt;td&gt;ç™ºç”Ÿã—ãªã„&lt;/td&gt;
      &lt;td&gt;ğŸ’€ç™ºç”Ÿã™ã‚‹&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;SERIALIZABLE&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ç™ºç”Ÿã—ãªã„&lt;/td&gt;
      &lt;td&gt;ç™ºç”Ÿã—ãªã„&lt;/td&gt;
      &lt;td&gt;ç™ºç”Ÿã—ãªã„&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;via. &lt;a href=&quot;https://qiita.com/PruneMazui/items/4135fcf7621869726b4b&quot;&gt;[RDBMS][SQL]ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã«ã¤ã„ã¦æ¥µåŠ›åˆ†ã‹ã‚Šã‚„ã™ãè§£èª¬ - Qiita&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;æœ€å¾Œã«&quot;&gt;æœ€å¾Œã«&lt;/h2&gt;

&lt;p&gt;é©åˆ‡ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã§é©åˆ‡ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’ã—ã¾ã—ã‚‡ã†ï¼&lt;/p&gt;

&lt;h2 id=&quot;å‚è€ƒ&quot;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://tkrd.hatenadiary.org/entry/20131121/1385044179&quot;&gt;Rails &amp;amp; MySQL: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«è¨­å®šã™ã‚‹&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://railsdoc.github.io/classes/ActiveRecord/ConnectionAdapters/DatabaseStatements.html#method-i-transaction-label-Transaction+isolation&quot;&gt;ActiveRecord::ConnectionAdapters::DatabaseStatements | RailsDoc&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://qiita.com/PruneMazui/items/4135fcf7621869726b4b&quot;&gt;[RDBMS][SQL]ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ†é›¢ãƒ¬ãƒ™ãƒ«ã«ã¤ã„ã¦æ¥µåŠ›åˆ†ã‹ã‚Šã‚„ã™ãè§£èª¬ - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Toshimaru</name></author><category term="rails" /><category term="activerecord" /><category term="mysql" /><summary type="html">è¿½è¨˜ Rails5, Rails6 å‘ã‘ã«è¨˜äº‹ã®å†…å®¹ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã—ãŸï¼ˆ2019/09/21ï¼‰</summary></entry><entry><title type="html">ActiveRecordã§has_many, throughã¨ã¯é€†ã®é–¢é€£ã‚’å®šç¾©ã™ã‚‹</title><link href="https://blog.toshimaru.net/belongs_to-through/" rel="alternate" type="text/html" title="ActiveRecordã§has_many, throughã¨ã¯é€†ã®é–¢é€£ã‚’å®šç¾©ã™ã‚‹" /><published>2014-08-12T00:00:00+09:00</published><updated>2019-11-04T00:00:00+09:00</updated><id>https://blog.toshimaru.net/belongs_to-through</id><content type="html" xml:base="https://blog.toshimaru.net/belongs_to-through/">&lt;h2 id=&quot;tldr&quot;&gt;TL;DR&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_many&lt;/code&gt;+&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt;ã®é€†ã®é–¢é€£ã®å®šç¾©ã«ã¯:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;belongs_to&lt;/code&gt;+&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt;ã¯ä½¿ãˆãªã„&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;delegate&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_one&lt;/code&gt;+&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt; ãŒä½¿ãˆã‚‹&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_one&lt;/code&gt;+&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt; ã®æ–¹ãŒåŠ¹ç‡ã‚‚ã‚ˆãã€ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;includes&lt;/code&gt; ã‚‚ä½¿ãˆã¦ã‚ªã‚¹ã‚¹ãƒ¡&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ&quot;&gt;ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ&lt;/h2&gt;

&lt;p&gt;ã¨ã‚ã‚‹Railsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã“ã‚“ãªãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆãŒã‚ã£ãŸã¨ã—ã¾ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/posts/has-many-through/user-post-comment.png&quot; alt=&quot;User Post Comment&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;railsãƒ¢ãƒ‡ãƒ«æ§‹æˆ&quot;&gt;Railsãƒ¢ãƒ‡ãƒ«æ§‹æˆ&lt;/h3&gt;

&lt;p&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User&lt;/code&gt;ï¼‰ã¯è¤‡æ•°ã®è¨˜äº‹ï¼ˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Post&lt;/code&gt;ï¼‰ã‚’ã‚‚ã£ã¦ã„ã¦ã€ãã®è¨˜äº‹ã¯è¤‡æ•°ã®ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Comment&lt;/code&gt;ï¼‰ã‚’æŒã£ã¦ã„ã‚‹ã€ã¨ã„ã†çŠ¶æ…‹ã§ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Post&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:comments&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Comment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:post&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;has_many-through-ã®å®šç¾©&quot;&gt;has_many, through ã®å®šç¾©&lt;/h2&gt;

&lt;p&gt;ä¸Šè¨˜ã®ã‚ˆã†ãªãƒ¢ãƒ‡ãƒ«å®šç¾©ã«ãŠã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰ç›´æ¥ã‚³ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«ã¸ã®é–¢é€£ã‚’å®šç¾©ã™ã‚‹ã«ã¯ã©ã†ã—ãŸã‚‰ã‚ˆã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ&lt;/p&gt;

&lt;p&gt;ç­”ãˆã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_many&lt;/code&gt;+&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt;ã‚’ä½¿ã†ã“ã¨ã§ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;through: :posts&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Post&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:comments&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Comment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:post&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸‹è¨˜ä¸€è¡ŒãŒå¤‰æ›´ç‚¹ã¨ãªã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;through: :posts&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã“ã®å¤‰æ›´ã«ã‚ˆã‚Šã€ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã‚“ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã‹ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«ä¸€ç™ºã§å¼•ãã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# User Load (0.3ms)  SELECT  `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;comments&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Comment Load (0.5ms)  SELECT  `comments`.* FROM `comments` INNER JOIN `posts` ON `comments`.`post_id` = `posts`.`id` WHERE `posts`.`user_id` = 1 LIMIT 11&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã§ã¯ã“ã“ã§ç–‘å•ã€‚é€†ã«ã‚³ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«ã‹ã‚‰&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Post&lt;/code&gt;ãƒ¢ãƒ‡ãƒ«ã‚’çœã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å¼•ãã“ã¨ã¯ã§ããªã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ ã¤ã¾ã‚Š &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_many&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt;ã®é€†ã®é–¢é€£ã¯ã©ã†å®šç¾©ã—ãŸã‚‰ã‚ˆã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;belongs_to-through-ã¯ä½¿ãˆãªã„&quot;&gt;belongs_to, through ã¯ä½¿ãˆãªã„ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_many&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt;ãŒä½¿ãˆã‚‹ã‚“ã ã‹ã‚‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;belongs_to&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt; ã‚‚ä½¿ãˆã‚‹ã¨æ€ã†ã§ã—ã‚‡ã†ï¼Ÿã€€ã—ã‹ã—å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã‚‹ã¨ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã—ã¾ã—ã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Comment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:post&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;through: :post&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# =&amp;gt; ArgumentError (Unknown key: :through. Valid keys are: :class_name, ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;æ®‹å¿µãªãŒã‚‰&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;belongs_to&lt;/code&gt;ã«ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt;ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ç„¡ã„ã‚ˆã†ã§ã™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_many&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt;ã®é€†ã®é–¢é€£ã‚’å®šç¾©ã™ã‚‹ã«ã¯ï¼’ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;1-delegate-ã‚’ä½¿ã†æ–¹æ³•&quot;&gt;1. delegate ã‚’ä½¿ã†æ–¹æ³•&lt;/h2&gt;

&lt;p&gt;ï¼‘ã¤ç›®ã®æ–¹æ³•ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;delegate&lt;/code&gt;ã‚’ä½¿ã†ã“ã¨ã§ã™ã€‚å…·ä½“çš„ã«ã¯ã‚³ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;through: :posts&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Post&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:comments&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Comment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:post&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;to: :post&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¸‹è¨˜ã®ã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å¼•ãã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Comment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;user&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  Comment Load (0.3ms)  SELECT  `comments`.* FROM `comments` ORDER BY `comments`.`id` ASC LIMIT 1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  Post Load (0.4ms)  SELECT  `posts`.* FROM `posts` WHERE `posts`.`id` = 1 LIMIT 1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  User Load (0.3ms)  SELECT  `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;User id: 1, name: &quot;TEST&quot;, created_at: &quot;2019-09-20 15:36:46&quot;, updated_at: &quot;2019-09-20 16:34:31&quot;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã”è¦§ã®ã‚ˆã†ã« Comment â†’ Post â†’ User ã¨é †ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;2-has_one-through-ã‚’ä½¿ã†æ–¹æ³•&quot;&gt;2. has_one, through ã‚’ä½¿ã†æ–¹æ³•&lt;/h2&gt;

&lt;p&gt;ï¼’ã¤ç›®ã®æ–¹æ³•ã¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_one&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt;ã‚’ä½¿ã†ã“ã¨ã§ã™ã€‚ã‚³ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:posts&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;through: :posts&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Post&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_many&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:comments&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Comment&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;belongs_to&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:post&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;has_one&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;through: :post&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã“ã¡ã‚‰ã‚‚åŒæ§˜ã«ä¸‹è¨˜ã®ã‚ˆã†ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å¼•ãã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Comment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;user&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  Comment Load (0.3ms)  SELECT  `comments`.* FROM `comments` ORDER BY `comments`.`id` ASC LIMIT 1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  User Load (0.4ms)  SELECT  `users`.* FROM `users` INNER JOIN `posts` ON `users`.`id` = `posts`.`user_id` WHERE `posts`.`id` = 1 LIMIT 1&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;User id: 1, name: &quot;TEST&quot;, created_at: &quot;2019-09-20 15:36:46&quot;, updated_at: &quot;2019-09-20 16:34:31&quot;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ã“ã¡ã‚‰ã®æ–¹æ³•ã®å®šç¾©ã ã¨ã€SQLãŠã‚ˆã³ãƒ¢ãƒ‡ãƒ«ã®LoadãŒ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;delegate&lt;/code&gt;æ–¹å¼ã‚ˆã‚Šã‚‚ä¸€å›åˆ†å°‘ãªãæ¸ˆã‚€ã®ã§ã€ã‚ˆã‚Šä½ã‚³ã‚¹ãƒˆã§ã‚³ãƒ¡ãƒ³ãƒˆã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å¼•ãã“ã¨ãŒã§ãã¾ã™ã€‚&lt;/p&gt;

&lt;h3 id=&quot;includes-ã‚‚ä½¿ã†ã“ã¨ãŒã§ãã‚‹&quot;&gt;includes ã‚‚ä½¿ã†ã“ã¨ãŒã§ãã‚‹&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_one&lt;/code&gt; ã§å®šç¾©ã—ã¦ã„ã‚‹ã¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;includes&lt;/code&gt; ã‚‚ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Comment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;includes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  Comment Load (2.9ms)  SELECT  `comments`.* FROM `comments` WHERE `comments`.`id` = 1 LIMIT 1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  Post Load (0.5ms)  SELECT `posts`.* FROM `posts` WHERE `posts`.`id` = 1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  User Load (0.4ms)  SELECT `users`.* FROM `users` WHERE `users`.`id` = 1&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;Comment id: 1, ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eager_load&lt;/code&gt;ã‚„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;joins&lt;/code&gt;ã‚‚åŒæ§˜ã«ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚&lt;/p&gt;

&lt;div class=&quot;language-rb highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Comment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;joins&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  Comment Load (1.0ms)  SELECT  `comments`.* FROM `comments` INNER JOIN `posts` ON `posts`.`id` = `comments`.`post_id` INNER JOIN `users` ON `users`.`id` = `posts`.`user_id` WHERE `comments`.`id` = 1 LIMIT 1&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;Comment id: 1 ...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Comment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;eager_load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#  SQL (2.4ms)  SELECT  `comments`.`id` AS t0_r0, `comments`.`post_id` AS t0_r1, `comments`.`content` AS t0_r2, `comments`.`created_at` AS t0_r3, `comments`.`updated_at` AS t0_r4, `ube sers`.`id` AS t1_r0, `users`.`name` AS t1_r1, `users`.`created_at` AS t1_r2, `users`.`updated_at` AS t1_r3 FROM `comments` LEFT OUTER JOIN `posts` ON `posts`.`id` = `comments`.`post_id` LEFT OUTER JOIN `users` ON `users`.`id` = `posts`.`user_id` WHERE `comments`.`id` = 1 LIMIT 1&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;Comment id: 1 ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;ã©ã¡ã‚‰ã®æ–¹æ³•ãŒè‰¯ã„ã‹&quot;&gt;ã©ã¡ã‚‰ã®æ–¹æ³•ãŒè‰¯ã„ã‹ï¼Ÿ&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Â &lt;/th&gt;
      &lt;th&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;delegate&lt;/code&gt;&lt;/th&gt;
      &lt;th&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_one&lt;/code&gt;+&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Comment&lt;/code&gt; â†’ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User&lt;/code&gt; å‚ç…§ã®ãŸã‚ã®ç·ã‚¯ã‚¨ãƒªå›æ•°&lt;/td&gt;
      &lt;td&gt;3å›&lt;/td&gt;
      &lt;td&gt;2å›&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;includes&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;joins&lt;/code&gt; ãªã©ãŒä½¿ãˆã‚‹ã‹ï¼Ÿ&lt;/td&gt;
      &lt;td&gt;â˜“ ä½¿ç”¨ä¸å¯&lt;/td&gt;
      &lt;td&gt;â—‹ ä½¿ç”¨å¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;å®šç¾©ã®æ„å‘³&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;comment&lt;/code&gt; ã‹ã‚‰&lt;br /&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; ã¸ã®é–¢é€£ã‚’&lt;br /&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;post&lt;/code&gt; ã«ç§»è­²&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;comment&lt;/code&gt; ã¯&lt;br /&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;post&lt;/code&gt;ã‚’é€šã—ã¦&lt;br /&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt;ã¸ã®é–¢é€£ã‚’ï¼‘ã¤æŒã¤&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ã¨ã„ã†ã“ã¨ã§ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;delegate&lt;/code&gt; ã‚ˆã‚Šã¯  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;has_one&lt;/code&gt;+&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;through&lt;/code&gt; ã‚’ä½¿ã†ã®ãŒã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å‚è€ƒ&quot;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://stackoverflow.com/questions/4021322/belongs-to-through-associations&quot;&gt;belongs_to through associations&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://apidock.com/rails/Module/delegate&quot;&gt;delegate (Module) - APIdock&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://railsdoc.github.io/classes/ActiveRecord/Associations/ClassMethods.html#method-i-has_one&quot;&gt;ActiveRecord::Associations::ClassMethods | RailsDoc&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Toshimaru</name></author><category term="activerecord" /><category term="rails" /><summary type="html">TL;DR</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/has-many-through/og.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/has-many-through/og.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>