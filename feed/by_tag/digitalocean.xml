<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="https://blog.toshimaru.net/feed/by_tag/digitalocean.xml" rel="self" type="application/atom+xml" /><link href="https://blog.toshimaru.net/" rel="alternate" type="text/html" /><updated>2022-03-08T10:36:29+09:00</updated><id>https://blog.toshimaru.net/feed/by_tag/digitalocean.xml</id><title type="html">Hack Your Design!</title><subtitle>toshimaruの技術系なブログ</subtitle><author><name>Toshimaru</name></author><entry><title type="html">terraformでDigitalOceanに簡単ドロップレット作成</title><link href="https://blog.toshimaru.net/terraform/" rel="alternate" type="text/html" title="terraformでDigitalOceanに簡単ドロップレット作成" /><published>2016-04-05T00:00:00+09:00</published><updated>2016-04-05T00:00:00+09:00</updated><id>https://blog.toshimaru.net/terraform</id><content type="html" xml:base="https://blog.toshimaru.net/terraform/"><![CDATA[<p><a href="https://www.terraform.io/">Terraform</a>を使って1円クラウド、<a href="https://m.do.co/c/a79091850c6e">DigitalOcean</a>にドロップレットをさくっと立ててみます。Vagrantに似たツールではありますが、Vagrantよりシンプルでかつ軽量に動作します。</p>

<h2 id="環境">環境</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ terraform version
Terraform v0.6.14
</code></pre></div></div>

<p>上記のバージョンの terraform を使っていきます。</p>

<h2 id="tfファイル作成">tfファイル作成</h2>

<p>terraformファイル、例えば<code class="language-plaintext highlighter-rouge">test.tf</code>ファイルを下記のように作成します（<code class="language-plaintext highlighter-rouge">.tf</code>という拡張子でファイル名はなんでもよいようです）。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Configure the DigitalOcean Provider
provider "digitalocean" {
  token = "your_digitalocean_token"
}

# Create a web server
resource "digitalocean_droplet" "web" {
  image = "ubuntu-14-04-x64"
  name = "web-1"
  region = "sfo1"
  size = "512mb"
  ssh_keys = [123456]
}
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">token</code>にはDigitalOceanのあなた自身のトークンをセットしてください。</p>

<p>ちなみに上記にある <code class="language-plaintext highlighter-rouge">ssh_keys</code> の id は下記のようにAPI経由で取得できます（jqを使ってます）。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl "https://api.digitalocean.com/v2/account/keys" -H "Authorization: Bearer your_token" | jq ".ssh_keys[0].id"
</code></pre></div></div>

<h2 id="terraform-実行プラン表示">terraform 実行プラン表示</h2>

<p><code class="language-plaintext highlighter-rouge">terraform plan</code>で実行プランを表示できます。これで何が作成されるかを確認しましょう。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ terraform plan
Refreshing Terraform state prior to plan...


The Terraform execution plan has been generated and is shown below.
Resources are shown in alphabetical order for quick scanning. Green resources
will be created (or destroyed and then created if an existing resource
exists), yellow resources are being changed in-place, and red resources
will be destroyed.

Note: You didn't specify an "-out" parameter to save this plan, so when
"apply" is called, Terraform can't guarantee this is what will execute.

+ digitalocean_droplet.web
    image:                "" =&gt; "ubuntu-14-04-x64"
    ipv4_address:         "" =&gt; "&lt;computed&gt;"
    ipv4_address_private: "" =&gt; "&lt;computed&gt;"
    ipv6_address:         "" =&gt; "&lt;computed&gt;"
    ipv6_address_private: "" =&gt; "&lt;computed&gt;"
    locked:               "" =&gt; "&lt;computed&gt;"
    name:                 "" =&gt; "web-1"
    region:               "" =&gt; "sfo1"
    size:                 "" =&gt; "512mb"
    ssh_keys.#:           "" =&gt; "1"
    ssh_keys.0:           "" =&gt; "123456"
    status:               "" =&gt; "&lt;computed&gt;"


Plan: 1 to add, 0 to change, 0 to destroy.
</code></pre></div></div>

<h2 id="プラン実行">プラン実行</h2>

<p>確認後は<code class="language-plaintext highlighter-rouge">terraform apply</code>で実際に作成を行えます。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ terraform apply
digitalocean_droplet.web: Creating...
image:                "" =&gt; "ubuntu-14-04-x64"
ipv4_address:         "" =&gt; "&lt;computed&gt;"
ipv4_address_private: "" =&gt; "&lt;computed&gt;"
ipv6_address:         "" =&gt; "&lt;computed&gt;"
ipv6_address_private: "" =&gt; "&lt;computed&gt;"
locked:               "" =&gt; "&lt;computed&gt;"
name:                 "" =&gt; "web-1"
region:               "" =&gt; "sfo1"
size:                 "" =&gt; "512mb"
ssh_keys.#:           "" =&gt; "1"
ssh_keys.0:           "" =&gt; "123456"
status:               "" =&gt; "&lt;computed&gt;"
digitalocean_droplet.web: Creation complete

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

The state of your infrastructure has been saved to the path
below. This state is required to modify and destroy your
infrastructure, so keep it safe. To inspect the complete state
use the `terraform show` command.

State path: terraform.tfstate
</code></pre></div></div>

<h2 id="作成物の情報表示">作成物の情報表示</h2>

<p><code class="language-plaintext highlighter-rouge">terraform show</code> で作成物の情報を表示できます。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ terraform show
digitalocean_droplet.web:
  id = 12808253
  image = ubuntu-14-04-x64
  ipv4_address = 1.2.3.4
  locked = false
  name = web-1
  region = sfo1
  size = 512mb
  ssh_keys.# = 1
  ssh_keys.0 = 123456
  status = active
</code></pre></div></div>

<p>確かにできあがってます。</p>

<h2 id="ドロップレット削除">ドロップレット削除</h2>

<p>ほっとくとどんどん課金されていきますので使い終わったら削除しましょう。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ terraform destroy
Do you really want to destroy?
  Terraform will delete all your managed infrastructure.
  There is no undo. Only 'yes' will be accepted to confirm.

  Enter a value: yes

digitalocean_droplet.web: Refreshing state... (ID: 12808253)
digitalocean_droplet.web: Destroying...
digitalocean_droplet.web: Destruction complete

Apply complete! Resources: 0 added, 0 changed, 1 destroyed.
</code></pre></div></div>

<hr />

<p>この記事を気に入っていただけたなら下記のリファラルリンクよりDigital Oceanにご登録いただけますと筆者が喜びます(*´ω｀*)</p>

<p><a href="https://m.do.co/c/a79091850c6e"><img src="/images/digitalocean.png" alt="digitalocean" /></a></p>]]></content><author><name>Toshimaru</name></author><category term="digitalocean" /><category term="terraform" /><summary type="html"><![CDATA[Terraformを使って1円クラウド、DigitalOceanにドロップレットをさくっと立ててみます。Vagrantに似たツールではありますが、Vagrantよりシンプルでかつ軽量に動作します。]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/terraform.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/terraform.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">packerを使ってDigital Ocean上にイメージを作成する</title><link href="https://blog.toshimaru.net/digitalocean-image-with-packer/" rel="alternate" type="text/html" title="packerを使ってDigital Ocean上にイメージを作成する" /><published>2014-03-16T00:00:00+09:00</published><updated>2014-03-16T00:00:00+09:00</updated><id>https://blog.toshimaru.net/digitalocean-image-with-packer</id><content type="html" xml:base="https://blog.toshimaru.net/digitalocean-image-with-packer/"><![CDATA[<p>＜前回のあらすじ＞<br />
<a href="/digital-ocean-vagrant-puppet/">1円クラウド・DigitalOceanのインスタンスをVagrantで上げて、puppetでプロビジョニングする</a></p>

<p><a href="http://www.packer.io/">packer</a>を使ってDigital Ocean上にイメージを作成してみたのでそのときのメモ。</p>

<h2 id="packerとは">Packerとは？</h2>

<p><a href="http://www.vagrantup.com/">Vagrant</a>がVMの構築とかAWS/Digitgal Oceanでのインスタンス作成とかを抽象化して、プログラマブルにすることが可能なツールだとしたら、Packerはそれをさらに抽象化して、1つの設定ファイル(JSON)からAWS, Digital Ocean, VirtualBox向けのイメージを作成できるツール。</p>

<h2 id="digital-oceanにイメージ作成する">Digital Oceanにイメージ作成する</h2>

<p>今回はDigital Oceanにイメージを作成した。まずはpakcer用のディレクトリを用意。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir packer-test
$ cd packer-test
</code></pre></div></div>

<p>次にpackerの設定ファイルを用意。ファイル名は何でもよいっぽい。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ touch Packer.json
</code></pre></div></div>

<p>このように書く。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "builders": [
    {
      "type": "digitalocean",
      "client_id": "your_client_id",
      "api_key": "your_api_key",
      "image_id": 1505447,
      "region_id": 3,
      "size_id": 66
    }
  ],

  "provisioners": [
    {
      "type": "shell",
      "script": "setup.sh"
    }
  ]
}
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">builder</code>でタイプをチョイス。今回は<code class="language-plaintext highlighter-rouge">digitalocean</code>を選択。<code class="language-plaintext highlighter-rouge">client_id</code>, <code class="language-plaintext highlighter-rouge">api_key</code>を設定。<code class="language-plaintext highlighter-rouge">image_id</code>,<code class="language-plaintext highlighter-rouge">region_id</code>,<code class="language-plaintext highlighter-rouge">size_id</code>のint値については<a href="https://developers.digitalocean.com/">こちらのDigitalOcean API</a>を見るとよいっぽい。</p>

<p>プロビジョニングのタイプは今回はシンプルにshellを設定。適当に<code class="language-plaintext highlighter-rouge">setup.sh</code>を作る。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ echo "echo 'hello world'" &gt; setup.sh
</code></pre></div></div>

<h2 id="packer">Packer!</h2>

<p>packerビルドしてみる。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ packer build Packer.json
digitalocean output will be in this color.

==&gt; digitalocean: Creating temporary ssh key for droplet...
==&gt; digitalocean: Creating droplet...
==&gt; digitalocean: Waiting for droplet to become active...
==&gt; digitalocean: Waiting for SSH to become available...
==&gt; digitalocean: Connected to SSH!
==&gt; digitalocean: Provisioning with shell script: setup.sh
    digitalocean: hello world!
    digitalocean:
==&gt; digitalocean: Gracefully shutting down droplet...
==&gt; digitalocean: Creating snapshot: packer-1395033724
==&gt; digitalocean: Waiting for snapshot to complete...
==&gt; digitalocean: Destroying droplet...
==&gt; digitalocean: Deleting temporary ssh key...
Build 'digitalocean' finished.

==&gt; Builds finished. The artifacts of successful builds are:
--&gt; digitalocean: A snapshot was created: 'packer-1395033724' in region 'San Francisco 1'
</code></pre></div></div>

<h2 id="結果">結果</h2>

<p>Before,Afterで見てみる。</p>

<p>Before:</p>

<p><img src="/images/posts/packer/do-before.png" alt="before" /></p>

<p>After:</p>

<p><img src="/images/posts/packer/do-after.png" alt="after" /></p>

<p>イメージのスナップショット（<code class="language-plaintext highlighter-rouge">packer-1395033724</code>）が作成されてますね。</p>

<h2 id="最後に">最後に</h2>

<p>packerはあくまでもイメージを作成するツールであり、イメージを管理するツールではないようです。</p>

<blockquote>
  <p>Packer only builds images. It does not attempt to manage them in any way.</p>
</blockquote>

<p>See. <a href="http://www.packer.io/intro/getting-started/build-image.html">http://www.packer.io/intro/getting-started/build-image.html</a></p>

<p>また、<code class="language-plaintext highlighter-rouge">builders</code>の設定を変更することで、<a href="http://www.packer.io/docs/builders/amazon.html">Amazon EC2</a>や<a href="http://www.packer.io/docs/builders/googlecompute.html">Google Compute Engine</a>とかにもイメージ作成できるようですね。</p>

<h3 id="github-repo">Github Repo</h3>

<p>今回使ったものをGithubにおいておきます。</p>

<p><a href="https://github.com/toshimaru/packer-digitalocean-sample">https://github.com/toshimaru/packer-digitalocean-sample</a></p>

<h3 id="参考">参考</h3>

<ul>
  <li><a href="http://rebuild.fm/25/">Rebuild: 25: Immutable Infrastructure (Naoya Ito, Gosuke Miyashita)</a></li>
</ul>

<hr />

<p>この記事を気に入っていただけたなら下記のリファラルリンクよりDigital Oceanにご登録いただけますと筆者が喜びます(*´ω｀*)</p>

<p><a href="https://m.do.co/c/a79091850c6e"><img src="/images/digitalocean.png" alt="digitalocean" /></a></p>]]></content><author><name>Toshimaru</name></author><category term="digitalocean" /><category term="packer" /><summary type="html"><![CDATA[packerを使ってDigital Ocean上にイメージを作成してみたのでそのときのメモ。 Packerとは？ VagrantがVMの構築とかAWS/Digitgal Oceanでのインスタンス作成とかを抽象化して、プログラマブルにすることが可能なツールだとしたら、Packerはそれをさらに抽象化して、1つの設定ファイル(JSON)からAWS, Digital Ocean, VirtualBox向けのイメージを作成できるツール。]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/packer/packer.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/packer/packer.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">1円クラウド・DigitalOceanのインスタンスをVagrantで上げて、puppetでプロビジョニングする</title><link href="https://blog.toshimaru.net/digital-ocean-vagrant-puppet/" rel="alternate" type="text/html" title="1円クラウド・DigitalOceanのインスタンスをVagrantで上げて、puppetでプロビジョニングする" /><published>2014-03-12T00:00:00+09:00</published><updated>2014-03-12T00:00:00+09:00</updated><id>https://blog.toshimaru.net/digital-ocean-vagrant-puppet</id><content type="html" xml:base="https://blog.toshimaru.net/digital-ocean-vagrant-puppet/"><![CDATA[<p>流行りの1円クラウド、<a href="https://m.do.co/c/a79091850c6e">DigitalOcean</a>上にVagrantでインスタンス(DigitalOcean的にはDroplet)を立ててみて、それが感動的にラクだったので書き残しておく。</p>

<h2 id="install-vagrant-command">Install vagrant command</h2>

<p>Mac使っているのであれば<a href="https://github.com/phinze/homebrew-cask">homebrew-cask</a>を使うのが便利。</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>brew cask <span class="nb">install </span>vagrant
</code></pre></div></div>

<p>バージョンは1.5.1</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>vagrant <span class="nt">-v</span>
<span class="go">Vagrant 1.5.1
</span></code></pre></div></div>

<h2 id="install-vagrant-digitalocean-plugin">Install vagrant-digitalocean plugin</h2>

<p>そのままではDigitalOceanは使えないので、次にvagrantのDigitalOceanプラグインをインストール。</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>vagrant plugin <span class="nb">install </span>vagrant-digitalocean
</code></pre></div></div>

<h2 id="vagrantfile-configuration">Vagrantfile Configuration</h2>

<p>まずはVagrantfileを用意。</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">mkdir </span>vagrant-digitalocean-test
<span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>vagrant-digitalocean-test
<span class="gp">$</span><span class="w"> </span><span class="nb">touch </span>Vagrantfile
</code></pre></div></div>

<p>次に<code class="language-plaintext highlighter-rouge">Vagrantfile</code>に書く設定。</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s1">'2'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="ss">:digital_ocean</span> <span class="k">do</span> <span class="o">|</span><span class="n">provider</span><span class="p">,</span> <span class="n">override</span><span class="o">|</span>
    <span class="n">override</span><span class="p">.</span><span class="nf">ssh</span><span class="p">.</span><span class="nf">private_key_path</span> <span class="o">=</span> <span class="s1">'~/.ssh/id_rsa'</span>
    <span class="n">override</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s1">'digital_ocean'</span>
    <span class="n">override</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"https://github.com/smdahlen/vagrant-digitalocean/raw/master/box/digital_ocean.box"</span>

    <span class="n">provider</span><span class="p">.</span><span class="nf">client_id</span> <span class="o">=</span> <span class="s1">'{your_client_id}'</span>
    <span class="n">provider</span><span class="p">.</span><span class="nf">api_key</span> <span class="o">=</span> <span class="s1">'{your_api_key}'</span>

    <span class="n">provider</span><span class="p">.</span><span class="nf">image</span>                <span class="o">=</span> <span class="s1">'CentOS 6.4 x64'</span>
    <span class="n">provider</span><span class="p">.</span><span class="nf">region</span>               <span class="o">=</span> <span class="s1">'San Francisco 1'</span>
    <span class="n">provider</span><span class="p">.</span><span class="nf">size</span>                 <span class="o">=</span> <span class="s1">'512MB'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">provider.client_id</code>, <code class="language-plaintext highlighter-rouge">provider.api_key</code>の値はアカウント作成後、下記URLより生成できる。</p>

<p><a href="https://cloud.digitalocean.com/api_access">https://cloud.digitalocean.com/api_access</a></p>

<p>今回はCentOS6.4、場所はサンフランシスコ、サイズは512で作ってみる。</p>

<h2 id="インスタンス作成">インスタンス作成！</h2>

<p>あとはこのコマンドのみ。</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>vagrant up <span class="nt">--provider</span> digital_ocean
</code></pre></div></div>

<p>これで一分くらい待つと立ち上がりました。動いてます。</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>vagrant status
<span class="go">Current machine states:

default                   active (digital_ocean)

active
</span></code></pre></div></div>

<p>あとは<code class="language-plaintext highlighter-rouge">vagrant ssh</code>するなり<code class="language-plaintext highlighter-rouge">vagrant destroy</code>（インスタンス破棄[重要！]）するなり。</p>

<h2 id="プロビジョニング">プロビジョニング</h2>

<p>これだけでは最小パッケージで必要なパッケージが入ってなく片手落ち。そうだ、puppetでプロビジョニングしてみよう。<code class="language-plaintext highlighter-rouge">Vagrantfile</code>をこうしてみる。</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s1">'2'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">inline: </span><span class="s2">"rpm -Uvh http://ftp-srv2.kddilabs.jp/Linux/distributions/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm --force"</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">inline: </span><span class="s2">"yum -y install puppet"</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="ss">:digital_ocean</span> <span class="k">do</span> <span class="o">|</span><span class="n">provider</span><span class="p">,</span> <span class="n">override</span><span class="o">|</span>
    <span class="n">override</span><span class="p">.</span><span class="nf">ssh</span><span class="p">.</span><span class="nf">private_key_path</span> <span class="o">=</span> <span class="s1">'~/.ssh/id_rsa'</span>
    <span class="n">override</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s1">'digital_ocean'</span>
    <span class="n">override</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"https://github.com/smdahlen/vagrant-digitalocean/raw/master/box/digital_ocean.box"</span>

    <span class="n">provider</span><span class="p">.</span><span class="nf">client_id</span> <span class="o">=</span> <span class="s1">'{client_id}'</span>
    <span class="n">provider</span><span class="p">.</span><span class="nf">api_key</span> <span class="o">=</span> <span class="s1">'{api_key}'</span>

    <span class="n">provider</span><span class="p">.</span><span class="nf">image</span>                <span class="o">=</span> <span class="s1">'CentOS 6.4 x64'</span>
    <span class="n">provider</span><span class="p">.</span><span class="nf">region</span>               <span class="o">=</span> <span class="s1">'San Francisco 1'</span>
    <span class="n">provider</span><span class="p">.</span><span class="nf">size</span>                 <span class="o">=</span> <span class="s1">'512MB'</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"puppet"</span> <span class="k">do</span> <span class="o">|</span><span class="n">puppet</span><span class="o">|</span>
    <span class="n">puppet</span><span class="p">.</span><span class="nf">options</span>                <span class="o">=</span> <span class="s2">"--verbose"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>最初にpuppetをインストールコマンドを追加。そして</p>

<h2 id="puppet-manifest">puppet manifest</h2>

<p>puppetのmanifestファイルを定義します。</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">mkdir </span>manifests
<span class="gp">$</span><span class="w"> </span><span class="nb">touch </span>manifests/default.pp
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">manifests/default.pp</code>はこう。vimとgitのパッケージを追加。必要に応じて追加したりする。</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">package</span> <span class="p">{</span>
  <span class="p">[</span>
    <span class="s1">'vim-enhanced'</span><span class="p">,</span>
    <span class="s1">'git'</span><span class="p">,</span>
  <span class="p">]:</span>
  <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">installed</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="lets-provision">Let’s provision!</h2>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>vagrant provision
</code></pre></div></div>

<p>これでpuppet経由で、vimやらgitが入る。良い。</p>

<h2 id="本当に１円">本当に１円？</h2>

<p>はい。１円です。</p>

<p>検証環境として使ったあとに、Dropletをちゃんと破棄していればこうなります。</p>

<p><img src="/images/posts/vagrant/bill.png" alt="bill" /></p>

<p>現時点で<code class="language-plaintext highlighter-rouge">1USD</code> = <code class="language-plaintext highlighter-rouge">102JPY</code>くらいなので<code class="language-plaintext highlighter-rouge">0.01USD</code>=約１円ですね。</p>

<h2 id="github-repository">GitHub Repository</h2>

<p>Githubに今回のサンプルの最終形を置いておく。</p>

<p><a href="https://github.com/toshimaru/vagrant-digitalocean-puppet">https://github.com/toshimaru/vagrant-digitalocean-puppet</a></p>

<h3 id="参考">参考</h3>

<ul>
  <li><a href="https://m.do.co/c/a79091850c6e">Simple Cloud Computing, Built for Developers | DigitalOcean</a></li>
  <li><a href="http://blog.glidenote.com/blog/2013/12/05/digital-ocean-with-vagrant/">VagrantとSSDなVPS(Digital Ocean)で1時間1円の使い捨て高速サーバ環境を構築する</a></li>
</ul>

<hr />

<p>この記事を気に入っていただけたなら下記のリファラルリンクよりDigital Oceanにご登録いただけますと筆者が喜びます(*´ω｀*)</p>

<p><a href="https://m.do.co/c/a79091850c6e"><img src="/images/digitalocean.png" alt="digitalocean" /></a></p>]]></content><author><name>Toshimaru</name></author><category term="digitalocean" /><category term="vagrant" /><summary type="html"><![CDATA[流行りの1円クラウド、DigitalOcean上にVagrantでインスタンス(DigitalOcean的にはDroplet)を立ててみて、それが感動的にラクだったので書き残しておく。]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://blog.toshimaru.net/images/posts/vagrant/vagrant.png" /><media:content medium="image" url="https://blog.toshimaru.net/images/posts/vagrant/vagrant.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>