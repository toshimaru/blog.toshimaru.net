<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.1">Jekyll</generator><link href="https://blog.toshimaru.net/feed/by_tag/jquery.xml" rel="self" type="application/atom+xml" /><link href="https://blog.toshimaru.net/" rel="alternate" type="text/html" /><updated>2023-04-21T11:44:23+09:00</updated><id>https://blog.toshimaru.net/feed/by_tag/jquery.xml</id><title type="html">Hack Your Design!</title><subtitle>toshimaruの技術系なブログ</subtitle><author><name>Toshimaru</name></author><entry><title type="html">jQueryでHTMLタグ要素をcreateElement使わずに生成する</title><link href="https://blog.toshimaru.net/jqueryhidden-inputjquery/" rel="alternate" type="text/html" title="jQueryでHTMLタグ要素をcreateElement使わずに生成する" /><published>2016-01-17T00:00:00+09:00</published><updated>2016-01-17T00:00:00+09:00</updated><id>https://blog.toshimaru.net/jqueryhidden-inputjquery</id><content type="html" xml:base="https://blog.toshimaru.net/jqueryhidden-inputjquery/"><![CDATA[<h2 id="やりたいこと">やりたいこと</h2>

<p>とある<code class="language-plaintext highlighter-rouge">&lt;form&gt;</code>があってその中にjQueryで動的にinput hiddenタグ要素を生成&amp;追加して送信したい。</p>

<h2 id="方法">方法</h2>

<p>要素を生成しようと思ったときにぱっと思いつくのは、<code class="language-plaintext highlighter-rouge">document.createElement</code>だが、jQueryを使うと下記のように簡潔にかける。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"targetId"</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;input&gt;</span><span class="dl">'</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hidden</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">input_id</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">value</span><span class="p">:</span> <span class="mi">12345</span>
<span class="p">}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="dl">'</span><span class="s1">#targetId</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>また下記のように<code class="language-plaintext highlighter-rouge">attr</code>を使わずに書くことができる（コメントで教えていただきました taku hhara さん、ありがとうございます）。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;input&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hidden</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">input_id</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">value</span><span class="p">:</span> <span class="mi">12345</span>
<span class="p">}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="dl">'</span><span class="s1">#targetId</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="テキストの入ったdivを生成">テキストの入ったdivを生成</h2>

<p>上述のテクニックを使った下記のようなテキストの入った<code class="language-plaintext highlighter-rouge">div</code>要素も生成できます。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;div&gt;</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span><span class="dl">'</span><span class="s1">hoge</span><span class="dl">'</span><span class="p">,</span> <span class="na">class</span><span class="p">:</span><span class="dl">'</span><span class="s1">fuga</span><span class="dl">'</span><span class="p">,</span> <span class="na">text</span><span class="p">:</span><span class="dl">'</span><span class="s1">piyo</span><span class="dl">'</span> <span class="p">});</span>
</code></pre></div></div>

<p>このコードは下記コードと同じ結果を得られます。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;div id="hoge"&gt;&lt;span class="fuga"&gt;piyo&lt;/span&gt;&lt;/div&gt;</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>(コードは<a href="http://ginpen.com/2012/12/01/jquery-core-func/">jQueryの$()が多機能すぎる件について。5種類も仕事があるよ。</a>より引用)</p>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="http://stackoverflow.com/questions/2408043/jquery-create-hidden-form-element-on-the-fly">Jquery - Create hidden form element on the fly</a></li>
  <li><a href="http://stackoverflow.com/questions/268490/jquery-document-createelement-equivalent">jQuery document.createElement equivalent?</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="javascript" /><category term="jquery" /><summary type="html"><![CDATA[とあるがあってその中にjQueryで動的にinput hiddenタグ要素を生成&追加して送信したい。要素を生成しようと思ったときにぱっと思いつくのは、document.createElementだが、jQueryを使うと簡潔にかける。]]></summary></entry><entry><title type="html">jQueryイベントデリゲーションを利用して遅延取得されるDOMにイベントをアタッチする</title><link href="https://blog.toshimaru.net/jquery-event-delegation/" rel="alternate" type="text/html" title="jQueryイベントデリゲーションを利用して遅延取得されるDOMにイベントをアタッチする" /><published>2015-03-24T00:00:00+09:00</published><updated>2015-03-24T00:00:00+09:00</updated><id>https://blog.toshimaru.net/jquery-event-delegation</id><content type="html" xml:base="https://blog.toshimaru.net/jquery-event-delegation/"><![CDATA[<p>jQueryイベントデリゲーションをコードとともにおさらい。</p>

<h2 id="no-event-delegation">No Event Delegation</h2>

<p>デリゲーションしないパターン。何が問題なのか。</p>

<p>まずは「default item」をクリックする。「clicked!」になったね。「Add List」する。そいつをもう一度クリック。「clicked!」になってほしい。あれ、何も起こらないね？</p>

<p data-height="268" data-theme-id="0" data-slug-hash="MYLYxq" data-default-tab="result" data-user="toshimaru" class="codepen">See the Pen <a href="http://codepen.io/toshimaru/pen/MYLYxq/">No `.on` selector </a> by toshi (<a href="http://codepen.io/toshimaru">@toshimaru</a>) on <a href="http://codepen.io">CodePen</a>.</p>
<script async="" src="//assets.codepen.io/assets/embed/ei.js"></script>

<p>なぜならjQueryのセレクタ<code class="language-plaintext highlighter-rouge">$("#list li")</code>では、初期のDOMにしかイベントがアタッチされないから。後から追加されるDOMに対してはイベントアタッチはされない。</p>

<h2 id="use-event-delegation">Use Event Delegation</h2>

<p>イベントデリゲーションするバターン。こちらではどうでしょう？</p>

<p>まずは「default item」をクリックする。「clicked!」になったね。「Add List」する。そいつをもう一度クリック。「clicked!」になった。Add Listで追加されたDOMに対してもしっかりイベントが補足されるようになっている。</p>

<p data-height="259" data-theme-id="0" data-slug-hash="dPaPEY" data-default-tab="result" data-user="toshimaru" class="codepen">See the Pen <a href="http://codepen.io/toshimaru/pen/dPaPEY/">Use `.on` selector</a> by toshi (<a href="http://codepen.io/toshimaru">@toshimaru</a>) on <a href="http://codepen.io">CodePen</a>.</p>
<script async="" src="//assets.codepen.io/assets/embed/ei.js"></script>

<p><code class="language-plaintext highlighter-rouge">$("#list").on</code>の第二引数としてセレクタ（<code class="language-plaintext highlighter-rouge">li</code>）を渡すことで、しっかり<code class="language-plaintext highlighter-rouge">$("#list")</code>のリスト要素全てにイベントがデリゲートされていますね。 :on:</p>

<h3 id="参考">参考</h3>
<ul>
  <li><a href="https://learn.jquery.com/events/event-delegation/">Understanding Event Delegation | jQuery Learning Center</a></li>
  <li><a href="https://api.jquery.com/on/">.on() | jQuery API Documentation</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="jquery" /><summary type="html"><![CDATA[jQueryイベントデリゲーションをコードとともにおさらい。デリゲーションしないパターン。何が問題なのか。 まずは「default item」をクリックする。「clicked!」になったね。「Add List」する。もう一度クリック。「clicked!」になってほしい。あれ、何も起こらないね？]]></summary></entry><entry><title type="html">jQuery使いが知っておくべきjQueryテクニック8選</title><link href="https://blog.toshimaru.net/jquery-8-tips/" rel="alternate" type="text/html" title="jQuery使いが知っておくべきjQueryテクニック8選" /><published>2013-12-23T00:00:00+09:00</published><updated>2013-12-23T00:00:00+09:00</updated><id>https://blog.toshimaru.net/jquery-8-tips</id><content type="html" xml:base="https://blog.toshimaru.net/jquery-8-tips/"><![CDATA[<p>本記事は<a href="http://www.adventar.org/calendars/135">jQuery Advent Calendar 2013</a>の23日目の記事となります。今回はjQuery使いとして覚えておきたいテクニックを個人的に8つピックアップしてみました。</p>

<p>日本との時差の関係で更新が24日になっているでしょうが気にせずいきましょう。</p>

<h2 id="1-jquery-2x-vs-1x">1. jQuery 2.x vs 1.x</h2>

<p>１つ目はテクニックというよりTipsになります。jQueryには最新版の2.x系と1.x系があります。さてどのようにバージョンを選べばいいでしょうか？</p>

<p>2.x系からの大きな変更点としては<strong>IE6/7/8のサポート廃止</strong>です。一方、1.x系は<strong>IE6/7/8ブラウザをサポート</strong>しています。</p>

<p>よってまとめると<strong>IE6/7/8をサポートしたいのであれば1.x系を使用、サポートしないのであれば2.x系を使用</strong>しましょう。2.x系のほうがサイズも小さく、速度も早いので旧ブラウザを切れるのであれば2.x系を推奨です。</p>

<h2 id="2-イベントハンドリングには-on-を使うべし">2. イベントハンドリングには on() を使うべし</h2>

<p>イベントハンドリングのメソッドがjQuery1.7以前だと<code class="language-plaintext highlighter-rouge">bind()</code>,<code class="language-plaintext highlighter-rouge">live()</code>,<code class="language-plaintext highlighter-rouge">delegate()</code>やらいろいろあったのが、jQuery1.7で<code class="language-plaintext highlighter-rouge">on()</code>でまとめられました。</p>

<p>ではここで疑問。<code class="language-plaintext highlighter-rouge">click()</code>などではなく、<code class="language-plaintext highlighter-rouge">on()</code>を使うことで何が嬉しいのでしょうか？　大きく３つあります。</p>

<p>１つ目は複数のイベントを登録できるということです。下記では<code class="language-plaintext highlighter-rouge">click</code>と<code class="language-plaintext highlighter-rouge">mouseenter</code>の２つのイベントを１つの処理にアタッチしてます。</p>

<script async="" src="http://jsfiddle.net/toshimaru/YDur2/2/embed/"></script>

<p>２つ目、オブジェクトを引数に取ることができ、複数イベントをアタッチできます。</p>

<script async="" src="http://jsfiddle.net/toshimaru/cANuP/1/embed/"></script>

<p>３つ目、第二引数にアタッチ先のセレクターを指定することができます。これでなにが嬉しいかというとAJAXなどで遅延して取得してくるような要素に対しても事前にイベントを設定することができます。</p>

<script async="" src="http://jsfiddle.net/toshimaru/hSZLY/1/embed/"></script>

<p>いわずもがなですが<code class="language-plaintext highlighter-rouge">off()</code>でイベントをデタッチできることも<code class="language-plaintext highlighter-rouge">on()</code>の良い所です。</p>

<h2 id="3-ajaxには-done-fail-を使うべし">3. AJAXには done(), fail() を使うべし</h2>

<p><a href="http://blog.toshimaru.net/jquery-ajaxdeferredajax/">去年のjQuery Advent Calendar</a>で書いた通りです。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ajax.html</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">success!!</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error!!!</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>上記の書き方よりも、</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ajax.html</span><span class="dl">"</span><span class="p">,</span>
<span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">success!!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error!!!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>こっちのほうがPromiseでモダンな形式です。</p>

<h2 id="4-ajaxだけじゃなくショートカットメソッドも活用すべし">4. ajax()だけじゃなくショートカット・メソッドも活用すべし</h2>

<p><code class="language-plaintext highlighter-rouge">ajax()</code>がオプションで色々出来過ぎちゃってついつい<code class="language-plaintext highlighter-rouge">ajax()</code>を使いがちですが、jQueryには<a href="http://api.jquery.com/category/ajax/shorthand-methods/">Ajaxショートカットメソッドがある</a>んです！</p>

<p>例えばデータをPOSTするAJAX。下記に<code class="language-plaintext highlighter-rouge">ajax()</code>と<code class="language-plaintext highlighter-rouge">post()</code>の二通り書き方を載せましたが、<code class="language-plaintext highlighter-rouge">post()</code>のほうがシンプルでよさ気ですね。</p>

<script async="" src="http://jsfiddle.net/toshimaru/BkNfr/2/embed/"></script>

<h2 id="5-find-を使って絞り込むべし">5. find() を使って絞り込むべし</h2>

<p>これもわりと有名ですかね。下記のセレクタは、</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.foo #bar</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">find()</code>を使ったほうが良いとされています。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.foo</span><span class="dl">'</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="dl">'</span><span class="s1">#bar</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="6-カスタムイベントを定義する">6. カスタムイベントを定義する</h2>

<p>下記のコードでは<code class="language-plaintext highlighter-rouge">show.price</code>というカスタムイベントを定義しています。クリック時に<code class="language-plaintext highlighter-rouge">show.price</code>イベントを<code class="language-plaintext highlighter-rouge">trigger()</code>しています。</p>

<script async="" src="http://jsfiddle.net/toshimaru/JHYhR/1/embed/"></script>

<h2 id="7-属性を指定してdomエレメントを生成できる">7. 属性を指定してDOMエレメントを生成できる</h2>

<p>こんな感じでAタグが生成できます。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;a&gt;</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">href</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://google.com/</span><span class="dl">'</span><span class="p">,</span> <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">google</span><span class="dl">'</span><span class="p">}).</span><span class="nx">text</span><span class="p">(</span><span class="dl">'</span><span class="s1">google</span><span class="dl">'</span><span class="p">)</span>
<span class="c1">// [&lt;a href=​"http:​/​/​google.com/​" title=​"google"&gt;​google​&lt;/a&gt;​ ]</span>
</code></pre></div></div>

<p>$.mapと組み合わせるとなかなかよいかもしれません。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">links</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">map</span><span class="p">([</span><span class="dl">'</span><span class="s1">google.com</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">yahoo.com</span><span class="dl">'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;li&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;a&gt;&lt;/a&gt;</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">href</span><span class="p">:</span> <span class="nx">link</span><span class="p">}).</span><span class="nx">text</span><span class="p">(</span><span class="dl">'</span><span class="s1">LINK</span><span class="dl">'</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">list</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">list</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;ul&gt;</span><span class="dl">'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">links</span><span class="p">)</span>
<span class="c1">// =&gt; [&lt;ul&gt;​</span>
<span class="c1">//        &lt;li&gt;​</span>
<span class="c1">//        &lt;a href=​"google.com"&gt;​LINK​&lt;/a&gt;​</span>
<span class="c1">//        &lt;/li&gt;​</span>
<span class="c1">//        &lt;li&gt;​</span>
<span class="c1">//        &lt;a href=​"yahoo.com"&gt;​LINK​&lt;/a&gt;​</span>
<span class="c1">//        &lt;/li&gt;​</span>
<span class="c1">//    &lt;/ul&gt;​ ]</span>
</code></pre></div></div>

<h2 id="8-form送信時は-serialize-を使って値をまとめて取得すべし">8. form送信時は serialize() を使って値をまとめて取得すべし</h2>

<p><code class="language-plaintext highlighter-rouge">serialize()</code>を使うことでform内のinputの値をまとめて取得できます。</p>

<script async="" src="http://jsfiddle.net/toshimaru/3GG3c/3/embed/"></script>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="http://blog.jquery.com/2013/04/18/jquery-2-0-released/">jQuery 2.0 Released</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="jquery" /><summary type="html"><![CDATA[今回はjQuery使いとして覚えておきたいjQueryテクニックを個人的に8つピックアップしてみました。 1. jQuery 2.x vs 1.x 2.　イベントハンドリングには on() を使うべし 3. AJAXには done(), fail() を使うべし 4. ajax()だけじゃなくショートカット・メソッドも活用すべし 5. find() を使って絞り込むべし 6. カスタムイベントを定義する 7. 属性を指定してDOMエレメントを生成できる 8. form送信時は serialize() を使って値をまとめて取得すべし]]></summary></entry><entry><title type="html">jQueryでページ最下部のスクロール時のイベントをキャッチする</title><link href="https://blog.toshimaru.net/jquery-bottom-scroll/" rel="alternate" type="text/html" title="jQueryでページ最下部のスクロール時のイベントをキャッチする" /><published>2013-07-29T00:00:00+09:00</published><updated>2013-07-29T00:00:00+09:00</updated><id>https://blog.toshimaru.net/jquery-bottom-scroll</id><content type="html" xml:base="https://blog.toshimaru.net/jquery-bottom-scroll/"><![CDATA[<p>ユースケースとしては、Twitterのタイムライン表示ページのように最下部までスクロールしたら、そのイベントをキャッチして次ページのツイートをAutoloadして表示させたい！みたいなとき。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">scroll</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">scrollHeight</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">height</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">scrollPosition</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">scrollTop</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">((</span><span class="nx">scrollHeight</span> <span class="o">-</span> <span class="nx">scrollPosition</span><span class="p">)</span> <span class="o">/</span> <span class="nx">scrollHeight</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// when scroll to bottom of the page</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>上コードでは、ウインドウのスクロール時にスクロール位置が今どれだけなのかを差分を見て計算してる。それが0以下になったら次ページを表示させるようなコードを書けばよい。</p>

<p>上記の例では「最下部」をイベントの発火ポイントにしたけど、「下記○○％に入ったら」とかでもよさそう。</p>

<h2 id="参考">参考</h2>
<ul>
  <li><a href="http://www.softel.co.jp/blogs/jquery/archives/742">ページの下までスクロールしたときに何らかの処理を実行する例</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="jquery" /><summary type="html"><![CDATA[ユースケースとしては、twitterのタイムライン表示ページのように最下部までスクロールしたら、そのイベントをキャッチして次ページのツイートを表示させたい！みたいなとき。jQueryでページ最下部のスクロール時のイベントをキャッチする。]]></summary></entry><entry><title type="html">【翻訳】DeferredはjQueryにおける最も重要なクライアントサイドツール</title><link href="https://blog.toshimaru.net/jquerydeferred-is-most-important-client/" rel="alternate" type="text/html" title="【翻訳】DeferredはjQueryにおける最も重要なクライアントサイドツール" /><published>2013-05-08T00:00:00+09:00</published><updated>2013-05-08T00:00:00+09:00</updated><id>https://blog.toshimaru.net/jquerydeferred-is-most-important-client</id><content type="html" xml:base="https://blog.toshimaru.net/jquerydeferred-is-most-important-client/"><![CDATA[<p><a href="http://blog.toshimaru.net/jquery-ajaxdeferredajax/">jQueryのDeferredを用いたモダンなAjax処理の書き方</a>が結構読んでもらっているみたいなので、今回はdeferred第二弾として、<a href="http://eng.wealthfront.com/2012/12/jquerydeferred-is-most-important-client.html">jQuery.Deferred is the most important client-side tool you have</a>の翻訳をしました。</p>

<hr />

<p>jQueryのdeferredの導入は、近年のjQueryの歴史における最もパワフルな拡張だ。jQuery自体はとくに新しい概念ではないが、deferredの導入は多くのクライアントサイド開発者にとってメリットがある。非同期プロセスにおいてdeferredパターンはシンプルでありながらも、パワフルなツールだ。皆さんご承知の通り、クライアントサイドの開発においてそういった非同期を使う状況は数多く存在する。</p>

<p>ここでは、deferredおよびjQueryによって提供されるAPIについて概観する。読者が理解できるよう多くの例を掲載した。あなたはこの記事を読み終わる頃にはdeferredとは何か、いつ使うべきものかが知ることができよう。</p>

<h2 id="概要">概要</h2>

<p>“Deferred”パターンとは、完了するかもしれない、あるいは完了しないかもしれない処理単位のプロキシのように振る舞うオブジェクトを表す。このパターンはどんな非同期処理にでも適応することができる。少し例をあげると、Ajaxリクエスト、アニメーション、Webワーカーだ。ユーザの行動さえも「遅延処理(delayed computation)」の対象とみなすことができるのである。</p>

<p>Deferredの最もシンプルな使い方は、処理が終わったときあるいは失敗したときに何が起こるかを明示できるようにすることだ。jQueryの実装だと、deferedがうまく解決(resolve)したとき、あるいはエラーで拒否(reject)されたとき、あるいはいくつかの進行中の処理から解決状態だと通知(notify)されたとき（後述）に走るであろうコールバック関数の登録が可能となる。</p>

<p>おそらく既に読者はこのDefrredパターンを使っている。なぜならjQuery Ajax関数はdeferredインターフェースを実装したオブジェクトを返すからだ。それはAjaxリクエストが成功したときにresolveされ、HTTPリクエストが失敗したときにrejectされる。</p>

<h2 id="理解すべき１つの重要なこと">理解すべき１つの重要なこと</h2>
<p>deferredは非同期処理における「いつ」を抽象化する。deferredは無制限に繰り返すことができる。この挙動のポイントは、もしdeferredが既にresolveならば、直ちに登録されているコールバックを実行することだ。処理単位(たとえばAjaxリクエスト)が終わっているかどうかは気にする必要がない。単純にコールバックをdeferredにバインドし、それが既にresolveであれば実行し、あるいはそれが未来にresolve状態になったときに実行する。</p>

<h2 id="jqueryでdeferredを使ってみる">jQueryでdeferredを使ってみる</h2>

<h3 id="解決resolution--拒否rejection">解決(resolution) &amp; 拒否(rejection)</h3>
<p>jQuery deferred関数の中核は、deferredの解決(resolve)/拒否(reject)を処理することだ。<code class="language-plaintext highlighter-rouge">$.Deferred().</code>でdeferredオブジェクトを作成できる。deferredオブジェクトの<code class="language-plaintext highlighter-rouge">done()</code>、<code class="language-plaintext highlighter-rouge">fail()</code>はそれぞれオブジェクトのresolveされたとき、rejectされたときに実行される関数を登録できる。</p>

<p>deferredをresolve/rejectすることは実際、<code class="language-plaintext highlighter-rouge">resolve()</code>,<code class="language-plaintext highlighter-rouge">reject()</code>を使うことで実現できる。<code class="language-plaintext highlighter-rouge">jQuery.ajax()</code>メソッドは内部的には、リクエストが正常に完了したときにdeferredの<code class="language-plaintext highlighter-rouge">resolve()</code>をコールし、リクエストが失敗したとき（例えばhttpステータスコードの404）に<code class="language-plaintext highlighter-rouge">reject()</code>をコールする。</p>

<h3 id="deferredへ通知する-notifyとprogress">deferredへ通知する: notify()とprogress()</h3>
<p>jQuery1.7からresolve/rejectに加えて、<code class="language-plaintext highlighter-rouge">progress</code>が導入された。、<code class="language-plaintext highlighter-rouge">progress()</code>により、deferred内で<code class="language-plaintext highlighter-rouge">notify()</code>がコールされたときに実行されるコールバック関数を登録することができ、resolved状態に対する「進捗(progress)」を表現できるようになった。<code class="language-plaintext highlighter-rouge">notify()</code>で事前にコールバックを登録しておくことで例えば、ロードに時間がかかるリソースを持つdeferredオブジェクトの定期的に更新されるプログレスバーを描画できる。deferredはロード中に通知(notify)され、ロード完了時に解決(resolve)される。</p>

<h3 id="promiseを返す">promise()を返す</h3>
<p>deferred利用時のほとんどの場合、deferredの利用者にresolve/rejectを決めてほしくはないだろう。あなた自身でそれを管理したいはずだ。そのような場合には、<code class="language-plaintext highlighter-rouge">promise()</code>を返すのがよい。</p>

<p>jQuery用語的にいうと、promiseは「read-only deferred」だ。promiseはコールバック登録、deferred状態への問い合わせを可能にするが、状態の変更は不可だ(たとえばresolve/reject状態の変更)。 <code class="language-plaintext highlighter-rouge">jQuery.ajax()</code>メソッドはpromise()を返す。なぜならAJAXリクエストが成功したか失敗したかを決定するのは、その内部のコードで完結する話だからだ。</p>

<h3 id="非同期イベントの同期化when">非同期イベントの同期化：when()</h3>

<p><code class="language-plaintext highlighter-rouge">$.when()</code>は１つ以上のdeferredを受け入れ可能で、それら全てのdeferredオブジェクトが正常に完了(resove)したときにのみresolve状態となる新たなdeferredを作り出す。つまり<code class="language-plaintext highlighter-rouge">when()</code>により、非同期イベントを一つに統合することが可能になるのだ。</p>

<p>下記の例を考えてみよう。</p>

<blockquote>
  <p>ある1つのUI表現に対して、2つの分割されたAJAXリクエストのデータが必要であり、UIのレンダリングには、それら２つのリクエストのデータが必須である。</p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">when()</code>がないと、レンダリング前にどちらのリクエストも終わっていることを保証するために、コールバックをネストすることを強要されてしまう。さらに悪いことに、２つのAJAXリクエストが失敗時のエラーハンドリングコードが下記URLに示す通り２つに分散されてしまう。</p>

<iframe width="100%" height="300" src="http://jsfiddle.net/mattbaker/2s4Mg/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>この代替案として、<code class="language-plaintext highlighter-rouge">when()</code>が使用可能なのだ。2つのAJAXリクエストによって分割されてしまったdeferredオブジェクトを1つに統合できる。<code class="language-plaintext highlighter-rouge">when()</code>はこれら2つの両リクエストが完了したときにのみresolveとなる。成功時のコールバックとしてUI要素のレンダリング処理を登録することができる。さらに、失敗時の処理は1つの箇所にまとめることができる（下記URL参照）。</p>

<iframe width="100%" height="300" src="http://jsfiddle.net/mattbaker/wJ4bm/1/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<h3 id="人間もまた非同期だ">人間もまた非同期だ</h3>

<p>Webサイトやアプリーケーション上の数多くのモノは非同期である。これにはあなた自身さえも含まれている。考えてみよう、あなたのサイトはユーザにプロフィールを作成するように依頼する。プロフィールを十分にユーザに埋めさせるよう、あなたはどれくらい入力が完了しているかプログレスバーを表示させる。それらの入力が完了するとプログレスバーを変更させ、全て入力し終えたときには「ありがとうございます」というメッセージを表示させる。</p>

<p>この状況では、プロフィールの遅延入力完了という点でdeferredが使われている。プロフィールを作成、「計算」している本質は実際のところ、人間である。このケースは「非同期である」と見做せる状況とはいえないかもしれないが、まさにdeferredが使える有効な状況である。</p>

<p>ユーザーアクション（これは解決への進捗率を示している）によるdeferredを通知するために、<code class="language-plaintext highlighter-rouge">notify()</code>が使える。そして<code class="language-plaintext highlighter-rouge">resolve()</code>がプロフィール入力完了によるdeferredを通知するのに使える。プログレスバーを更新するには<code class="language-plaintext highlighter-rouge">progress()</code>を使ってコールバックをバインドし、ありがとうメッセージを表示するコールバックをバインドするのには<code class="language-plaintext highlighter-rouge">done()</code>を使う。</p>

<p>下記に例を示そう。</p>

<iframe width="100%" height="300" src="http://jsfiddle.net/TTUrQ/10/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<h3 id="最後に訳者より">最後に（訳者より）</h3>

<p>原文にはdeferredの面白い使い方、<code class="language-plaintext highlighter-rouge">pipe()</code>も紹介されています。是非こちらも参照してみてください。</p>

<p><a href="http://eng.wealthfront.com/2012/12/jquerydeferred-is-most-important-client.html">jQuery.Deferred is the most important client-side tool you have</a></p>]]></content><author><name>Toshimaru</name></author><category term="jquery" /><category term="翻訳" /><summary type="html"><![CDATA[「jQueryのDeferredを用いたモダンなAjax処理の書き方」が結構読んでもらっているみたいなので、今回はdeferred第二弾として「jQuery.Deferred is the most important client-side tool you have」の翻訳をしました。]]></summary></entry><entry><title type="html">jQueryのDeferredを用いたモダンなAjax処理の書き方</title><link href="https://blog.toshimaru.net/jquery-ajaxdeferredajax/" rel="alternate" type="text/html" title="jQueryのDeferredを用いたモダンなAjax処理の書き方" /><published>2012-12-13T00:00:00+09:00</published><updated>2012-12-13T00:00:00+09:00</updated><id>https://blog.toshimaru.net/jquery-ajaxdeferredajax</id><content type="html" xml:base="https://blog.toshimaru.net/jquery-ajaxdeferredajax/"><![CDATA[<p>本エントリは<a href="http://www.adventar.org/calendars/29">軽めのjQuery Advent Calendar 2012</a>の14日目の記事として書きます。軽めといいながら少し重めになってしまった感がありますが、初めてのAdvent Calendar参加ということでご勘弁を。</p>

<p><strong class="red">※ Twitter API仕様変更によりTwitter APIを使ったコード例は現在動作しなくなっていることにご注意。</strong></p>

<h2 id="jquery-14以前の書き方">jQuery 1.4以前の書き方</h2>

<p>まずは、少し古めのコード、昔のjQueryの本とかでよく見る書き方。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ajax.html</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">success!!</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error!!!</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="jquery-15以上の書き方">jQuery 1.5以上の書き方</h2>

<p>1.5以降だと、<code class="language-plaintext highlighter-rouge">$.ajax()</code> は<a href="http://api.jquery.com/jQuery.ajax/#jqXHR">jqXHRオブジェクト</a>を返すようになります。それを利用した書き方はこう。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ajax.html</span><span class="dl">"</span><span class="p">,</span>
<span class="p">}).</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">success!!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error!!!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>成功時の処理と失敗時の処理が<code class="language-plaintext highlighter-rouge">ajax()</code>と並列に書くことができ、コード全体の見通しがぐっとよくなりましたね。</p>

<h2 id="jquery-18以上の書き方">jQuery 1.8以上の書き方</h2>

<p><a href="http://api.jquery.com/jQuery.ajax/">公式リファレンス</a>いわく、</p>

<blockquote>
  <p>Deprecation Notice: The jqXHR.success(), jqXHR.error(), and jqXHR.complete() callbacks will be deprecated in jQuery 1.8. To prepare your code for their eventual removal, use jqXHR.done(), jqXHR.fail(), and jqXHR.always() instead.</p>
</blockquote>

<p>つまり要約するとjQuery1.8から</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">success()</code> は <code class="language-plaintext highlighter-rouge">done()</code> に、</li>
  <li><code class="language-plaintext highlighter-rouge">error()</code> は <code class="language-plaintext highlighter-rouge">fail()</code> に、</li>
  <li><code class="language-plaintext highlighter-rouge">complete()</code> は <code class="language-plaintext highlighter-rouge">always()</code>を</li>
</ul>

<p>代わりに使ってね、ってことです。ということで、<code class="language-plaintext highlighter-rouge">success()</code>,<code class="language-plaintext highlighter-rouge">error()</code>は使わない。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ajax.html</span><span class="dl">"</span><span class="p">,</span>
<span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">success!!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error!!!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>あるいは<code class="language-plaintext highlighter-rouge">then()</code>を用いてこう書いてもいいでしょう。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ajax.html</span><span class="dl">"</span><span class="p">,</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">success!!</span><span class="dl">'</span><span class="p">);</span> <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">error!!</span><span class="dl">'</span><span class="p">);</span>   <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">then()</code>の一個目の関数が成功時、二個目の関数が失敗時となります。</p>

<h2 id="発展編1deferredを用いた書き方">【発展編1】Deferredを用いた書き方</h2>

<p>上述した例の中でさりげなくDeferredな書き方を使っていましたが、発展編ということでこのDeferredな書き方をさらに突き詰めてみましょう。</p>

<h3 id="deferredとは何か">deferredとは何か？</h3>

<blockquote>
  <p>jQuery.Deferred() introduces several enhancements to the way callbacks are managed and invoked. In particular, jQuery.Deferred() provides flexible ways to provide multiple callbacks, and these callbacks can be invoked regardless of whether the original callback dispatch has already occurred. jQuery Deferred is based on the CommonJS Promises/A design.</p>

  <p>jQuery.Deferred() はコールバック関数の管理、実行に改善をもたらします。具体的には、jQuery.Deferred()は複数のコールバックの実行を柔軟に行うことができ、これらのコールバック関数は、オリジナルのコールバックのディスパッチが発生しているかどうかにかかわらず実行されます。</p>
</blockquote>

<p>要はコールバック関数の実行を延期(deferred)させて、<code class="language-plaintext highlighter-rouge">.then()</code> <code class="language-plaintext highlighter-rouge">.fail()</code> <code class="language-plaintext highlighter-rouge">.always()</code>なんかを使って柔軟にコールバックを管理、実行できるってことです（雑）。</p>

<p>詳しくは下記を読むとよいでしょう。</p>

<ul>
  <li><a href="http://msdn.microsoft.com/en-us/magazine/gg723713.aspx">Creating Responsive Applications Using jQuery Deferred and Promises</a></li>
  <li><a href="https://twitter.com/tokkonopapa">@tokkonoPapa</a>さんによる上記事の翻訳はこちら → <a href="http://tokkono.cute.coocan.jp/blog/slow/index.php/programming/jquery-deferred-for-responsive-applications-basic/">jQueryのDeferredとPromiseで応答性の良いアプリをー基本編</a></li>
</ul>

<p>論より実践。deferredをうまく使ったAjaxコードを見てみましょう。</p>

<p><a href="http://jsfiddle.net/toshimaru/yP58L/1/light/">jsfiddleでの実例はこちら</a></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Twitter</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">search</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">defer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://search.twitter.com/search.json</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">q</span><span class="p">:</span> <span class="nx">query</span><span class="p">,</span>
                <span class="na">rpp</span><span class="p">:</span> <span class="mi">50</span>
            <span class="p">},</span>
            <span class="na">dataType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">jsonp</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">success</span><span class="p">:</span> <span class="nx">defer</span><span class="p">.</span><span class="nx">resolve</span><span class="p">,</span>
            <span class="na">error</span><span class="p">:</span> <span class="nx">defer</span><span class="p">.</span><span class="nx">reject</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">defer</span><span class="p">.</span><span class="nx">promise</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#button</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Twitter</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="dl">'</span><span class="s1">jquery deferred</span><span class="dl">'</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span><span class="nx">v</span><span class="p">){</span>
           <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#tweets</span><span class="dl">'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">text</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&lt;br/&gt;</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>見てわかるとおり、Deferredを使うことでtwitterの検索を行うAjax部分と結果取得時のイベント処理部分が分離できます。</p>

<p>これによりネストが深くならずに済み、コードの可読性が上がります。また、イベント処理部分のほうは</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Twitter</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="dl">'</span><span class="s1">query hoge</span><span class="dl">'</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* ...code... */</span> <span class="p">});</span>
</code></pre></div></div>

<p>と書くだけですから、ajax部分を気にすることなく結果取得後のイベント処理に意識を集中して書くことができます。素晴らしいですネ。</p>

<h2 id="発展編2when-を用いた書き方">【発展編2】$.when() を用いた書き方</h2>

<p><code class="language-plaintext highlighter-rouge">$.when()</code>を用いると複数のdeferredオブジェクトをまとめて管理できます。</p>

<p><a href="http://jsfiddle.net/toshimaru/nNMae/">jsfiddleでの実例はこちら</a></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// `Twitter`のコードは同上</span>
<span class="c1">// var Twitter = { ... }</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#button</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="nx">Twitter</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="dl">'</span><span class="s1">jquery deferred</span><span class="dl">'</span><span class="p">),</span> <span class="nx">Twitter</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="dl">'</span><span class="s1">jquery when</span><span class="dl">'</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data1</span><span class="p">,</span> <span class="nx">data2</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data1</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data2</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>when内のDeferredオブジェクト全ての処理が完了すると、その後の処理が発火します。複数のAJAX結果をまとめて処理したいってときに使えます。</p>

<hr />

<p>いかがだったでしょうか？ Deferredオブジェクトを使うことでより楽しいAjaxライフが送れそうですね。ワクワクしますね。</p>

<p>本日紹介したコードは<a href="https://gist.github.com/4269484">gist</a>にも上げております。</p>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="http://d.hatena.ne.jp/aoe-tk/20110515/1305471586">jQueryのDeferredオブジェクトについて調べてみた</a></li>
  <li><a href="http://tokkono.cute.coocan.jp/blog/slow/index.php/programming/how-happy-with-jquery-deferred-for-your-applications/">jQueryのDeferredとPromiseで応答性の良いアプリをー実践編</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="jquery" /><category term="javascript" /><category term="ajax" /><summary type="html"><![CDATA[jQeuryにおけるDeferredを用いたモダンなAjaxの書き方を目指して、jQueryのバージョン毎にステップ・バイ・ステップでコード付きで解説していきます。]]></summary></entry><entry><title type="html">jQueryで画像を順番にfadeInする</title><link href="https://blog.toshimaru.net/jqueryfadein/" rel="alternate" type="text/html" title="jQueryで画像を順番にfadeInする" /><published>2012-09-30T00:00:00+09:00</published><updated>2012-09-30T00:00:00+09:00</updated><id>https://blog.toshimaru.net/jqueryfadein</id><content type="html" xml:base="https://blog.toshimaru.net/jqueryfadein/"><![CDATA[<p>写真をクールに１枚づつフェードインしていく。画像共有サイトで見たエフェクトです。</p>

<p><a href="http://toshimaru.net/demo/order-fade/">http://toshimaru.net/demo/order-fade/</a></p>

<p><img src="/images/2012/09/images.png"></p>

<p>ポイントは<code>$("img:hidden:first")</code>で画像のhidden状態をセレクトして、再帰的にフェードインかけているところです。下記のコードのような感じ。</span></p>

<p><script src="https://gist.github.com/3747845.js"></script></p>]]></content><author><name>Toshimaru</name></author><category term="jquery" /><summary type="html"><![CDATA[写真をクールに１枚づつフェードインしていく。画像共有サイトで見たエフェクトです。]]></summary></entry><entry><title type="html">Twitter Search API をJSで呼んでみる</title><link href="https://blog.toshimaru.net/twitter-search-api-js/" rel="alternate" type="text/html" title="Twitter Search API をJSで呼んでみる" /><published>2012-09-23T00:00:00+09:00</published><updated>2012-09-23T00:00:00+09:00</updated><id>https://blog.toshimaru.net/twitter-search-api-js</id><content type="html" xml:base="https://blog.toshimaru.net/twitter-search-api-js/"><![CDATA[<p>Twitter search API をJSを使って呼ぶ簡単なサンプルを作ってみました。せっかくなので、Bootstrap &amp; Hogan.js という二つのTwitter製オープンソースフレームワークを使ってみました。</p>

<p><strong>【!追記】現在はTwitter APIの仕様変更にて動かなくなっています。</strong></p>

<p><a href="http://toshimaru.net/demo/gettweet/">http://toshimaru.net/demo/gettweet/</a></p>

<p><img src="/images/2012/09/twitter.png" alt="twitter search api" /></p>

<p>使っている言語など。</p>

<ul>
  <li>HTML: html5</li>
  <li>JS: jQuery, <a href="http://twitter.github.com/hogan.js/">hogan.js(template engine)</a></li>
  <li>CSS: <a href="http://twitter.github.com/bootstrap/">bootstrap</a></li>
</ul>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="https://dev.twitter.com/docs/api/1/get/search">GET search</a></li>
  <li><a href="http://blog.asial.co.jp/659">Twitter-APIを使ってみました</a></li>
</ul>]]></content><author><name>Toshimaru</name></author><category term="css" /><category term="javascript" /><category term="jquery" /><summary type="html"><![CDATA[Twitter search API をJSを使って呼ぶ簡単なサンプルを作ってみました。せっかくなので、Bootstrap & Hogan.js という二つのTwitter製オープンソースフレームワークを使ってみました。]]></summary></entry></feed>